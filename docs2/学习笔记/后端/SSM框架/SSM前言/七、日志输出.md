# 七、日志输出

​	一个好的日志记录技术是可以提供不同的 **输出种类** 和 **选项** 供程序员在不同场合下使用。

​	日志信息根据用途与记录内容的不同，分为**调试日志**、**运行日志**和**日常日志**。

​	日志记录的技术很多，如 JDK 的 logger 技术，apache 的 log4j、log4j2 技术等。

## 7.1 Log4j 基础

### 7.1.1 Log4j 的下载

 log4j 1.2 下载链接 [ http://logging.apache.org/log4j/1.2/download.html ]

::: warning

> End of Life
> On August 5, 2015 the Logging Services Project Management Committee announced that Log4j 1.x had reached end of life. For complete text of the announcement please see the Apache Blog. Users of Log4j 1 are recommended to upgrade to Apache Log4j 2

在2015年的8月5日，Log4j 已经不再更新，Log4j1 的使用者推荐更新到 Log4j2。

:::

### 7.1.2 Log4j 的使用

#### （1）导入 Jar 包

#### （2）导入配置文件

Log4j 的配置文件存放在 classpath 下 ，可以在 src 包下新建 **log4j.properties** 文件，输入以下代码

```properties
##define an appender named console
log4j.appender.console=org.apache.log4j.ConsoleAppender
#The Target value is System.out or System.err
log4j.appender.console.Target=System.out
#set the layout type of the apperder
log4j.appender.console.layout=org.apache.log4j.PatternLayout
#set the layout format pattern
log4j.appender.console.layout.ConversionPattern=[%-5p][%d{yyyy-MM-dd HH:mm:ss}] %c %L %m%n

##define an appender named file
log4j.appender.file=org.apache.log4j.FileAppender
#define the file path and name
log4j.appender.file.File=d:/logfile.txt
#set the layout type of the apperder
log4j.appender.file.layout=org.apache.log4j.PatternLayout
#set the layout format pattern
log4j.appender.file.layout.ConversionPattern=[%-5p][%d{yyyy-MM-dd HH:mm:ss}] %c %L %m%n

##define an appender named rollfile
log4j.appender.rollfile=org.apache.log4j.RollingFileAppender
#define the file path and name
log4j.appender.rollfile.File=d:/logrollfile.txt
#set the log's size
log4j.appender.rollfile.MaxFileSize=10KB
#set the layout type of the apperder
log4j.appender.rollfile.layout=org.apache.log4j.PatternLayout
#set the layout format pattern
log4j.appender.rollfile.layout.ConversionPattern=[%-5p][%d{yyyy-MM-dd HH:mm:ss}] %c %L %m%n

##define a logger
#log4j.rootLogger=debug,console,file,rollfile
log4j.rootLogger=debug,console
```

下面来简单解释下代码

+ 第 4 行，为系统在控制台输出的类型，若是 System.out 则输出语句的颜色为黑色，是 System.err 则为红色。
+ 第 8 行，为系统输出语句的格式
  + " - " 为左对齐，” + “ 为右对齐；” -5 “ 代表左对齐，不足 5 个字符的单词的末尾补充空格；
  + [%d{yyyy-MM-dd HH:mm:ss}]：为日志输出时间以指定格式输出；
  + %c：输出日志的类名；%L：输出日志的代码行号；%m：自定义的输出信息；%n：换行；
+ 第 13 行，为日志在文件输出的文件名；
+ 第 22 行，为日志在滚动文件输出的文件名；
+ 第 24 行，滚动文件的最大大小，超过后会再新建一个滚动文件；
+ 第 32 行，设置日志输出的类型和优先级。输出类型可以选择控制台、文件和滚动文件；优先级按高与低排序为 Fatal 、Error 、Warn 、Info 、Debug 、All，还有 Off 关闭。低优先级的可以显示高优先级，但高优先级不能显示低优先级，所以优先级越高，显示的信息越少。 

## 7.2 Log4j2 基础

### 7.2.1 Log4j2 的下载

Log4j2 的下载地址：[ http://logging.apache.org/log4j/2.x/download.html ]

### 7.2.2 Log4j2 的使用

​	在下载好的安装包中，导入这两个 jar 包【 log4j-api-2.14.0.jar 】 和 【 log4j-core-2.14.0.jar 】

​	在 Log4j2 的配置文件是 **xml** 文件，不再支持 properties 文件。

​	Log4j2 的配置文件存放在 classpath 下， 默认命名为 “ log4j2.xml ” ，然后输入以下代码，若没有设置 log4j2.xml ，则系统会使用默认的日志配置；只会在控制台输出 error 级别的信息。

```xml
<?xml version="1.0" encoding="UTF-8"?>

<configuration status="OFF">
	<appenders>
		<Console name="myConsole" target="SYSTEM_OUT">
			<PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n" />
		</Console>
		<File name="myLogFile" fileName="log/test.log" append="true">
            <PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n"/>
        </File>
        <RollingFile name="myRollingFile" fileName="logs/app.log"
                     filePattern="logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n"/>
            <SizeBasedTriggeringPolicy size="1KB"/>
        </RollingFile>
	</appenders>
	
	<loggers>
		<!-- 
		<logger name="全限定类名或接口名" level="info">
			<appender-ref ref="myConsole" />
		</logger>
		 -->
		<root level="trace">
			<appender-ref ref="myConsole" />
			<!-- <appender-ref ref="myLogFile" />
			<appender-ref ref="myRollingFile" /> -->
		</root>
	</loggers>
	
</configuration>
```

配置文件说明：

1. <configuration//> 标签：该标签的 status 属性用于设置 Log4j2 **自身运行** 的日志显示级别，一般为 OFF ，不显示，当然也可以设置为 ERROR 、DEBUG 等其他级别。

```xml
<configuration status="OFF">
```

2. <Console//> 标签：该标签的 target 属性用于设置输出的 **目标形式** ，其值一般为：SYSTEM_OUT 或 SYSTEM_ERR。

```xml
<Console name="myConsole" target="SYSTEM_OUT">
			<PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n" />
		</Console>
```

3. <File//> 标签： fileName 属性用于设置文件的保存路径及文件名。下面的代码的意思是，日志的文件名为 test.log，并将其存放在当前项目的根目录下的 log 子目录里；append 属性用于设置是否以追加方式将日志写入指定文件。

```xml
<File name="myLogFile" fileName="log/test.log" append="true">
            <PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n"/>
        </File>
```

4. <RollingFile//> 标签：SizeBasedTriggeringPolicy 子标签用于指定每一个日志文件最大文件大小，超过后会再新建一个日志文件；filePattern 指定新创建的日志文件的文件名，可以指定为压缩文件，如下所示。

```xml
<RollingFile name="myRollingFile" fileName="logs/app.log"
                     filePattern="logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="[%-5p][%d{yyyy-MM-dd HH:mm:ss}] [%c %L] %m%n"/>
            <SizeBasedTriggeringPolicy size="1KB"/>
        </RollingFile>
```

5. <loggers//> 标签：用于指定所使用的日志记录器，及显示的级别。

+ 子标签 <root//> 的属性 level 用于指定显示级别；
+  而日志记录器是通过 <root//> 标签的子标签 <appender-ref//> 标签来引用 <appenders//> 中定义好的记录器；
+  注意的是，只要 <appenders//> 中定义了 <File//> 、<RollingFile//> ，且在其中指定了日志存放的目录，那么这些目录就会 **自动创建** 。无论在 <loggers//> 的 <root//> 中是否表示使用它们。

