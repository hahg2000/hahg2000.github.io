<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.7" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.23" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html"><meta property="og:site_name" content="åšå®¢æ¼”ç¤º"><meta property="og:title" content="ç¬¬ 14 ç« ï¼šMonads"><meta property="og:description" content="ç¬¬ 14 ç« ï¼šMonads åœ¨ 7 ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº† IO monadï¼Œé‚£æ—¶æˆ‘ä»¬åˆ»æ„æŠŠç²¾åŠ›é›†ä¸­åœ¨å¦‚ä½•ä¸å¤–ç•Œäº¤äº’ä¸Šï¼Œå¹¶æ²¡æœ‰è®¨è®ºmonadæ˜¯ä»€ä¹ˆã€‚ åœ¨ 7 ä¸­æˆ‘ä»¬çœ‹åˆ° IO Monadç¡®å®å¾ˆå¥½ç”¨ï¼›é™¤äº†åœ¨è¯­æ³•ä¸Šä¸åŒä¹‹å¤–ï¼Œåœ¨ IO monadä¸­å†™ä»£ç è·Ÿå…¶ä»–å‘½ä»¤å¼è¯­è¨€åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨è§£å†³ä¸€äº›å®é™…é—®é¢˜çš„æ—¶å€™å¼•å…¥äº†ä¸€äº›æ•°æ®ç»“æ„ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±ä¼šçŸ¥..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-02-25T04:39:03.000Z"><meta property="article:author" content="hahg"><meta property="article:modified_time" content="2024-02-25T04:39:03.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"ç¬¬ 14 ç« ï¼šMonads","image":[""],"dateModified":"2024-02-25T04:39:03.000Z","author":[{"@type":"Person","name":"hahg"}]}</script><title>ç¬¬ 14 ç« ï¼šMonads | åšå®¢æ¼”ç¤º</title><meta name="description" content="ç¬¬ 14 ç« ï¼šMonads åœ¨ 7 ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº† IO monadï¼Œé‚£æ—¶æˆ‘ä»¬åˆ»æ„æŠŠç²¾åŠ›é›†ä¸­åœ¨å¦‚ä½•ä¸å¤–ç•Œäº¤äº’ä¸Šï¼Œå¹¶æ²¡æœ‰è®¨è®ºmonadæ˜¯ä»€ä¹ˆã€‚ åœ¨ 7 ä¸­æˆ‘ä»¬çœ‹åˆ° IO Monadç¡®å®å¾ˆå¥½ç”¨ï¼›é™¤äº†åœ¨è¯­æ³•ä¸Šä¸åŒä¹‹å¤–ï¼Œåœ¨ IO monadä¸­å†™ä»£ç è·Ÿå…¶ä»–å‘½ä»¤å¼è¯­è¨€åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚ åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨è§£å†³ä¸€äº›å®é™…é—®é¢˜çš„æ—¶å€™å¼•å…¥äº†ä¸€äº›æ•°æ®ç»“æ„ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±ä¼šçŸ¥...">
    <link rel="preload" href="/assets/style-kgjWb58-.css" as="style"><link rel="stylesheet" href="/assets/style-kgjWb58-.css">
    <link rel="modulepreload" href="/assets/app-Chw2KLnS.js"><link rel="modulepreload" href="/assets/14.html-sDwJu6rk.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-D-4333g_.js" as="script"><link rel="prefetch" href="/assets/intro.html-BW3v88yc.js" as="script"><link rel="prefetch" href="/assets/index.html-CCzvQrWt.js" as="script"><link rel="prefetch" href="/assets/disable.html-B3LxCBxh.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-usFtQVss.js" as="script"><link rel="prefetch" href="/assets/layout.html-JcTV-DB0.js" as="script"><link rel="prefetch" href="/assets/markdown.html-DV77HWLq.js" as="script"><link rel="prefetch" href="/assets/page.html-6GRX-Ieq.js" as="script"><link rel="prefetch" href="/assets/cherry.html-rSagyIje.js" as="script"><link rel="prefetch" href="/assets/dragonfruit.html-BBDKfm44.js" as="script"><link rel="prefetch" href="/assets/strawberry.html-BkjUi3OZ.js" as="script"><link rel="prefetch" href="/assets/tomato.html-Et4aoQ3M.js" as="script"><link rel="prefetch" href="/assets/1.html-CDx9MaoB.js" as="script"><link rel="prefetch" href="/assets/2.html-l8teR3Xh.js" as="script"><link rel="prefetch" href="/assets/3.html-BnTuYZwF.js" as="script"><link rel="prefetch" href="/assets/4.html-blZzWWm0.js" as="script"><link rel="prefetch" href="/assets/1.html-Cecp1D8W.js" as="script"><link rel="prefetch" href="/assets/2.html-DZnWmgqa.js" as="script"><link rel="prefetch" href="/assets/3.html-DUqgmkJE.js" as="script"><link rel="prefetch" href="/assets/4.html-B0f_9QRw.js" as="script"><link rel="prefetch" href="/assets/1.html-Bn3aZ8DM.js" as="script"><link rel="prefetch" href="/assets/10.html-C7u8QqEM.js" as="script"><link rel="prefetch" href="/assets/11.html-DeoV8c69.js" as="script"><link rel="prefetch" href="/assets/12-1.html-D_88MDr6.js" as="script"><link rel="prefetch" href="/assets/12-2.html-47m8ef6e.js" as="script"><link rel="prefetch" href="/assets/13.html-7KpsJFDO.js" as="script"><link rel="prefetch" href="/assets/16.html-aJZHLtmd.js" as="script"><link rel="prefetch" href="/assets/18.html-DSyxcTqB.js" as="script"><link rel="prefetch" href="/assets/19.html-BZFZdYcn.js" as="script"><link rel="prefetch" href="/assets/2.html-CVpywZBV.js" as="script"><link rel="prefetch" href="/assets/20.html-C_CD1ziP.js" as="script"><link rel="prefetch" href="/assets/3.html-CERXcBXe.js" as="script"><link rel="prefetch" href="/assets/4.html-D9cayysz.js" as="script"><link rel="prefetch" href="/assets/5.html-CeHIu5OV.js" as="script"><link rel="prefetch" href="/assets/6.html-3HzzJ2Zz.js" as="script"><link rel="prefetch" href="/assets/7.html-Dv855PbD.js" as="script"><link rel="prefetch" href="/assets/8.html-D-kf4ZMy.js" as="script"><link rel="prefetch" href="/assets/9.html-D8e2xhZ4.js" as="script"><link rel="prefetch" href="/assets/index.html-CAjikkuZ.js" as="script"><link rel="prefetch" href="/assets/é‡å­¦CSS-ä¸Š.html-BUQIK-cH.js" as="script"><link rel="prefetch" href="/assets/é‡å­¦CSS-ä¸­.html-Bqci3Tkb.js" as="script"><link rel="prefetch" href="/assets/é‡å­¦HTML-ä¸Š.html-CAkUzXMr.js" as="script"><link rel="prefetch" href="/assets/é‡å­¦HTML-ä¸‹.html-rsUp7lR7.js" as="script"><link rel="prefetch" href="/assets/é”™é¢˜ä¸€.html-CYeGLBHa.js" as="script"><link rel="prefetch" href="/assets/é¢è¯•é¢˜ä¸€.html-D5VyX_0T.js" as="script"><link rel="prefetch" href="/assets/SQLé€Ÿè®°.html-DIXxb7kl.js" as="script"><link rel="prefetch" href="/assets/Gitå­¦ä¹ .html-87VYegNQ.js" as="script"><link rel="prefetch" href="/assets/ç¼–ç¨‹è§„èŒƒ.html-CW39F6t_.js" as="script"><link rel="prefetch" href="/assets/index.html-xdM8EHCo.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•ä¸€-6æœˆ24.html-CHCRNWQy.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•ä¸ƒ.html-DPyLeQk8.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•ä¸‰-7æœˆ28.html-B0HAMHw7.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•äºŒ-7æœˆ11.html-JsuFmA6P.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•äº”-8æœˆ28.html-D71yr5mU.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•å…­-10æœˆ3.html-BFRega6l.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•å››-8æœˆ11-åŠ¨æ€è§„åˆ’åˆé›†.html-B7HP_z34.js" as="script"><link rel="prefetch" href="/assets/Vue-ä¸Š.html-CHGfU6Ov.js" as="script"><link rel="prefetch" href="/assets/Vue-ä¸‹ä¹‹æºç åˆ†æ.html-B4BOMGlR.js" as="script"><link rel="prefetch" href="/assets/Vue-ä¸­ä¹‹é¡¹ç›®å¼€å‘.html-BNKjB66r.js" as="script"><link rel="prefetch" href="/assets/jQuery-ä¸Š.html-BQo6gt90.js" as="script"><link rel="prefetch" href="/assets/jQuery-ä¸‹.html-CnxgA8ZG.js" as="script"><link rel="prefetch" href="/assets/jQuery-ä¸­.html-B35MupEG.js" as="script"><link rel="prefetch" href="/assets/ES6-ä¸Š.html-DQYUI9hP.js" as="script"><link rel="prefetch" href="/assets/ES6-ä¸­.html-DaXVyDBh.js" as="script"><link rel="prefetch" href="/assets/åŸç”ŸJS-ä¸‹.html-xr5zey39.js" as="script"><link rel="prefetch" href="/assets/åŸç”ŸJSé«˜çº§-ä¸Š.html-o-qPI0Gw.js" as="script"><link rel="prefetch" href="/assets/åŸç”ŸJSé«˜çº§-ä¸­.html-CzlCX0C1.js" as="script"><link rel="prefetch" href="/assets/Node-ä¸Šä¹‹åŸºæœ¬çŸ¥è¯†.html-B-ZrL6Mv.js" as="script"><link rel="prefetch" href="/assets/Node-ä¸‹ä¹‹ç»¼åˆWebé¡¹ç›®.html-CC8zlLP7.js" as="script"><link rel="prefetch" href="/assets/Node-ä¸­ä¹‹æ¡†æ¶ä½¿ç”¨.html-BcECM_rl.js" as="script"><link rel="prefetch" href="/assets/ä¸€ã€å…¥é—¨.html-VUgtmP9p.js" as="script"><link rel="prefetch" href="/assets/ä¸€ã€MyBatiså…¥é—¨.html-Byhknz0g.js" as="script"><link rel="prefetch" href="/assets/äºŒã€å•è¡¨çš„ CURD æ“ä½œ.html-DyN9eey7.js" as="script"><link rel="prefetch" href="/assets/äº”ã€Mybatisæ³¨è§£å¼å¼€å‘.html-C1h3c7J6.js" as="script"><link rel="prefetch" href="/assets/å››ã€æŸ¥è¯¢ç¼“å­˜.html-gzd-Xqbd.js" as="script"><link rel="prefetch" href="/assets/ä¸€ã€SSMæ¡†æ¶å‰è¨€-ç³»ç»Ÿæ¶æ„.html-B7fDCYsi.js" as="script"><link rel="prefetch" href="/assets/ä¸‰ã€SSMæ¡†æ¶å‰è¨€-ä»£ç†æ¨¡å¼.html-Bw9gjUVx.js" as="script"><link rel="prefetch" href="/assets/äº”ã€SSMæ¡†æ¶å‰è¨€-æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼.html-DHn5bpes.js" as="script"><link rel="prefetch" href="/assets/å…­ã€JUnitæµ‹è¯•.html-Dm722NS2.js" as="script"><link rel="prefetch" href="/assets/ä¸€ã€Springæ¦‚è¿°.html-CtM1sJKs.js" as="script"><link rel="prefetch" href="/assets/ä¸‰ã€Springä¸AOP.html-m8tQq9V1.js" as="script"><link rel="prefetch" href="/assets/äºŒã€Springä¸IoC.html-CuDnS1dn.js" as="script"><link rel="prefetch" href="/assets/äº”ã€Springä¸MyBatis.html-DULQBmJl.js" as="script"><link rel="prefetch" href="/assets/å…­ã€Springä¸Web.html-B1a5iSLq.js" as="script"><link rel="prefetch" href="/assets/ä¸€ã€SpringMVCæ¦‚è¿°.html-BXm9kL0V.js" as="script"><link rel="prefetch" href="/assets/ä¸‰ã€SpringMVCæ³¨è§£å¼å¼€å‘.html-C-aYCX5-.js" as="script"><link rel="prefetch" href="/assets/äºŒã€SpringMVCé…ç½®å¼å¼€å‘.html-BFuJuuMN.js" as="script"><link rel="prefetch" href="/assets/404.html-MgJ0QEs8.js" as="script"><link rel="prefetch" href="/assets/index.html-BGzazsmI.js" as="script"><link rel="prefetch" href="/assets/index.html-DYswqIrx.js" as="script"><link rel="prefetch" href="/assets/index.html-DSM4F059.js" as="script"><link rel="prefetch" href="/assets/index.html-17WQrSGB.js" as="script"><link rel="prefetch" href="/assets/index.html-CeX6q_bm.js" as="script"><link rel="prefetch" href="/assets/index.html-DffiFuCR.js" as="script"><link rel="prefetch" href="/assets/index.html-B--6UzOZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CrTiSuQ7.js" as="script"><link rel="prefetch" href="/assets/index.html-BReSrJsw.js" as="script"><link rel="prefetch" href="/assets/index.html-C6xK3nPo.js" as="script"><link rel="prefetch" href="/assets/index.html-BjBdy9OO.js" as="script"><link rel="prefetch" href="/assets/index.html-CqvNhq7f.js" as="script"><link rel="prefetch" href="/assets/index.html-CAMDhNfE.js" as="script"><link rel="prefetch" href="/assets/index.html-C9aeeKmO.js" as="script"><link rel="prefetch" href="/assets/index.html-uUqlu4aT.js" as="script"><link rel="prefetch" href="/assets/index.html-DhqSxcFk.js" as="script"><link rel="prefetch" href="/assets/index.html-I3XfMlES.js" as="script"><link rel="prefetch" href="/assets/index.html-7ikIuZTD.js" as="script"><link rel="prefetch" href="/assets/index.html-3c6b-Y2B.js" as="script"><link rel="prefetch" href="/assets/index.html-swJI4354.js" as="script"><link rel="prefetch" href="/assets/index.html-DLtI5QxB.js" as="script"><link rel="prefetch" href="/assets/index.html-B5sImYeg.js" as="script"><link rel="prefetch" href="/assets/index.html-Cdjd08yv.js" as="script"><link rel="prefetch" href="/assets/index.html-uD61HD68.js" as="script"><link rel="prefetch" href="/assets/index.html-DHI1o5HF.js" as="script"><link rel="prefetch" href="/assets/index.html-Cdublov3.js" as="script"><link rel="prefetch" href="/assets/index.html-DiR05JqH.js" as="script"><link rel="prefetch" href="/assets/index.html-C8_3DHu4.js" as="script"><link rel="prefetch" href="/assets/index.html-D_ck-fuL.js" as="script"><link rel="prefetch" href="/assets/index.html-mSQ3NMXy.js" as="script"><link rel="prefetch" href="/assets/index.html-_Qb1lsdR.js" as="script"><link rel="prefetch" href="/assets/index.html-DGWJ4W1Y.js" as="script"><link rel="prefetch" href="/assets/index.html-n41l4Ot4.js" as="script"><link rel="prefetch" href="/assets/index.html-BBMcKcRg.js" as="script"><link rel="prefetch" href="/assets/index.html-zyL2EnzF.js" as="script"><link rel="prefetch" href="/assets/index.html-Cwi8cA9t.js" as="script"><link rel="prefetch" href="/assets/index.html-n4znuEHn.js" as="script"><link rel="prefetch" href="/assets/index.html-DXChDfLd.js" as="script"><link rel="prefetch" href="/assets/index.html-D8zMbI9p.js" as="script"><link rel="prefetch" href="/assets/index.html-OtNIaLb6.js" as="script"><link rel="prefetch" href="/assets/index.html-CJ4cvqBK.js" as="script"><link rel="prefetch" href="/assets/index.html-D2wOD0a3.js" as="script"><link rel="prefetch" href="/assets/index.html-BtYyOFDL.js" as="script"><link rel="prefetch" href="/assets/index.html-bCxqST6l.js" as="script"><link rel="prefetch" href="/assets/index.html-C6m-9gxj.js" as="script"><link rel="prefetch" href="/assets/index.html-usbu1vM_.js" as="script"><link rel="prefetch" href="/assets/index.html-BCfWa0Fp.js" as="script"><link rel="prefetch" href="/assets/index-uOBkQLRT.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://theme-hope-assets.vuejs.press/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">åšå®¢æ¼”ç¤º</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/%E5%AD%A6%E4%B9%A0/" aria-label="å­¦ä¹ "><span class="font-icon icon fa-fw fa-sm fas fa-creative" style=""></span>å­¦ä¹ <!----></a></div><div class="nav-item hide-in-mobile"><a href="https://vuepress-theme-hope.github.io/v2/zh/" rel="noopener noreferrer" target="_blank" aria-label="å…³äºæˆ‘" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-light" style=""></span>å…³äºæˆ‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/timeline/" aria-label="æ—¶é—´è½´"><span class="font-icon icon fa-fw fa-sm fas fa-time" style=""></span>æ—¶é—´è½´<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://vuepress-theme-hope.github.io/v2/zh/" rel="noopener noreferrer" target="_blank" aria-label="å¸¸ç”¨é“¾æ¥" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-network" style=""></span>å¸¸ç”¨é“¾æ¥<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Haskellä¸­æ–‡æ–‡æ¡£</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/12-2.html" aria-label="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/12-2.html"><!---->/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/12-2.html<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/1.html" aria-label="ç¬¬ 1 ç« ï¼šå…¥é—¨"><!---->ç¬¬ 1 ç« ï¼šå…¥é—¨<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/2.html" aria-label="ç¬¬ 2 ç« ï¼šç±»å‹å’Œå‡½æ•°"><!---->ç¬¬ 2 ç« ï¼šç±»å‹å’Œå‡½æ•°<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/3.html" aria-label="ç¬¬ 3 ç« ï¼šå®šä¹‰ç±»å‹å¹¶ç®€åŒ–å‡½æ•°"><!---->ç¬¬ 3 ç« ï¼šå®šä¹‰ç±»å‹å¹¶ç®€åŒ–å‡½æ•°<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/4.html" aria-label="ç¬¬ 4 ç« ï¼šå‡½æ•°å¼ç¼–ç¨‹"><!---->ç¬¬ 4 ç« ï¼šå‡½æ•°å¼ç¼–ç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/5.html" aria-label="ç¬¬ 5 ç« ï¼šç¼–å†™ JSON åº“"><!---->ç¬¬ 5 ç« ï¼šç¼–å†™ JSON åº“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/6.html" aria-label="ç¬¬ 6 ç« ï¼šä½¿ç”¨ç±»å‹ç±»"><!---->ç¬¬ 6 ç« ï¼šä½¿ç”¨ç±»å‹ç±»<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/7.html" aria-label="ç¬¬ 7 ç« ï¼šI/O"><!---->ç¬¬ 7 ç« ï¼šI/O<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/8.html" aria-label="ç¬¬ 8 ç« ï¼šé«˜æ•ˆæ–‡ä»¶å¤„ç†ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ–‡ä»¶ååŒ¹é…"><!---->ç¬¬ 8 ç« ï¼šé«˜æ•ˆæ–‡ä»¶å¤„ç†ã€æ­£åˆ™è¡¨è¾¾å¼ã€æ–‡ä»¶ååŒ¹é…<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/9.html" aria-label="ç¬¬ 9 ç« ï¼šI/Oå­¦ä¹  â€”â€” æ„å»ºä¸€ä¸ªç”¨äºæœç´¢æ–‡ä»¶ç³»ç»Ÿçš„åº“"><!---->ç¬¬ 9 ç« ï¼šI/Oå­¦ä¹  â€”â€” æ„å»ºä¸€ä¸ªç”¨äºæœç´¢æ–‡ä»¶ç³»ç»Ÿçš„åº“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/10.html" aria-label="ç¬¬ 10 ç« ï¼šä»£ç æ¡ˆä¾‹å­¦ä¹ ï¼šè§£æäºŒè¿›åˆ¶æ•°æ®æ ¼å¼"><!---->ç¬¬ 10 ç« ï¼šä»£ç æ¡ˆä¾‹å­¦ä¹ ï¼šè§£æäºŒè¿›åˆ¶æ•°æ®æ ¼å¼<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/11.html" aria-label="ç¬¬ 11 ç« ï¼šæµ‹è¯•å’Œè´¨é‡ä¿éšœ"><!---->ç¬¬ 11 ç« ï¼šæµ‹è¯•å’Œè´¨é‡ä¿éšœ<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/12-1.html" aria-label="ç¬¬ 12 ç« ï¼šæ¡å½¢ç è¯†åˆ«"><!---->ç¬¬ 12 ç« ï¼šæ¡å½¢ç è¯†åˆ«<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/13.html" aria-label="ç¬¬ 13 ç« ï¼šæ•°æ®ç»“æ„"><!---->ç¬¬ 13 ç« ï¼šæ•°æ®ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html" aria-label="ç¬¬ 14 ç« ï¼šMonads"><!---->ç¬¬ 14 ç« ï¼šMonads<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#revisiting-earlier-code-examples" aria-label="å›é¡¾ä¹‹å‰ä»£ç "><!---->å›é¡¾ä¹‹å‰ä»£ç <!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#maybe-chaining" aria-label="Maybeé“¾"><!---->Maybeé“¾<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#implicit-state" aria-label="éšå¼çŠ¶æ€"><!---->éšå¼çŠ¶æ€<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#looking-for-shared-patterns" aria-label="å¯»æ‰¾å…±åŒç‰¹å¾"><!---->å¯»æ‰¾å…±åŒç‰¹å¾<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-monad-typeclass" aria-label="Monad ç±»å‹ç±»"><!---->Monad ç±»å‹ç±»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#and-now-a-jargon-moment" aria-label="æœ¯è¯­è§£é‡Š"><!---->æœ¯è¯­è§£é‡Š<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#using-a-new-monad-show-your-work" aria-label="ä½¿ç”¨æ–°çš„Monad"><!---->ä½¿ç”¨æ–°çš„Monad<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#information-hiding" aria-label="ä¿¡æ¯éšè—"><!---->ä¿¡æ¯éšè—<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#controlled-escape" aria-label="å—æ§çš„Monad"><!---->å—æ§çš„Monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#leaving-a-trace" aria-label="æ—¥å¿—çºªå½•"><!---->æ—¥å¿—çºªå½•<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#using-the-logger-monad" aria-label="ä½¿ç”¨ Logger monad"><!---->ä½¿ç”¨ Logger monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#mixing-pure-and-monadic-code" aria-label="åŒæ—¶ä½¿ç”¨puerå’Œmonadicä»£ç "><!---->åŒæ—¶ä½¿ç”¨puerå’Œmonadicä»£ç <!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#putting-a-few-misconceptions-to-rest" aria-label="å…³äºMonadçš„ä¸€äº›è¯¯è§£"><!---->å…³äºMonadçš„ä¸€äº›è¯¯è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#building-the-logger-monad" aria-label="åˆ›å»ºLogger Monad"><!---->åˆ›å»ºLogger Monad<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#sequential-logging-not-sequential-evaluation" aria-label="é¡ºåºçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯é¡ºåºçš„æ±‚å€¼"><!---->é¡ºåºçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯é¡ºåºçš„æ±‚å€¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-writer-monad" aria-label="Writer monad"><!---->Writer monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-maybe-monad" aria-label="Maybe monad"><!---->Maybe monad<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#executing-the-maybe-monad" aria-label="æ‰§è¡ŒMaybe monad"><!---->æ‰§è¡ŒMaybe monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#maybe-at-work-and-good-api-design" aria-label="ä½¿ç”¨Maybeï¼Œä»¥åŠå¥½çš„APIè®¾è®¡æ–¹å¼"><!---->ä½¿ç”¨Maybeï¼Œä»¥åŠå¥½çš„APIè®¾è®¡æ–¹å¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-list-monad" aria-label="List Monad"><!---->List Monad<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#understanding-the-list-monad" aria-label="ç†è§£List monad"><!---->ç†è§£List monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#putting-the-list-monad-to-work" aria-label="ä½¿ç”¨List Monad"><!---->ä½¿ç”¨List Monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#desugaring-of-do-blocks" aria-label="è¿˜åŸdoçš„æœ¬è´¨"><!---->è¿˜åŸdoçš„æœ¬è´¨<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#monads-as-a-programmable-semicolon" aria-label="Monads: å¯ç¼–ç¨‹åˆ†å·"><!---->Monads: å¯ç¼–ç¨‹åˆ†å·<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#why-go-sugar-free" aria-label="ä¸ºä»€ä¹ˆè¦sugar-free"><!---->ä¸ºä»€ä¹ˆè¦sugar-free<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-state-monad" aria-label="çŠ¶æ€monad"><!---->çŠ¶æ€monad<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#almost-a-state-monad" aria-label="è‡ªå·±å®šä¹‰State monad"><!---->è‡ªå·±å®šä¹‰State monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#reading-and-modifying-the-state" aria-label="è¯»å–å’Œä¿®æ”¹çŠ¶æ€"><!---->è¯»å–å’Œä¿®æ”¹çŠ¶æ€<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#will-the-real-state-monad-please-stand-up" aria-label="çœŸæ­£çš„State monadå®šä¹‰"><!---->çœŸæ­£çš„State monadå®šä¹‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#using-the-state-monad-generating-random-values" aria-label="ä½¿ç”¨State monadç”Ÿæˆéšæœºæ•°"><!---->ä½¿ç”¨State monadç”Ÿæˆéšæœºæ•°<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#a-first-attempt-at-purity" aria-label="å®ç”¨çº¯å‡½æ•°ç”Ÿæˆéšæœºæ•°çš„å°è¯•"><!---->å®ç”¨çº¯å‡½æ•°ç”Ÿæˆéšæœºæ•°çš„å°è¯•<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#random-values-in-the-state-monad" aria-label="state monadé‡Œé¢çš„éšæœºæ•°å€¼"><!---->state monadé‡Œé¢çš„éšæœºæ•°å€¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#running-the-state-monad" aria-label="è¿è¡Œstate monad"><!---->è¿è¡Œstate monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#ç®¡ç†æ›´å¤šçš„çŠ¶æ€" aria-label="ç®¡ç†æ›´å¤šçš„çŠ¶æ€"><!---->ç®¡ç†æ›´å¤šçš„çŠ¶æ€<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#monad-and-functors" aria-label="Monadå’ŒFunctors"><!---->Monadå’ŒFunctors<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#æ¢ä¸ªè§’åº¦çœ‹monad" aria-label="æ¢ä¸ªè§’åº¦çœ‹Monad"><!---->æ¢ä¸ªè§’åº¦çœ‹Monad<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/14.html#the-monad-laws-and-good-coding-style" aria-label="å•å­å¾‹ä»¥åŠä»£ç é£æ ¼"><!---->å•å­å¾‹ä»¥åŠä»£ç é£æ ¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/16.html" aria-label="ç¬¬ 16 ç« ï¼šä½¿ç”¨Parsec"><!---->ç¬¬ 16 ç« ï¼šä½¿ç”¨Parsec<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/18.html" aria-label="ç¬¬ 18 ç« ï¼š Monadå˜æ¢å™¨"><!---->ç¬¬ 18 ç« ï¼š Monadå˜æ¢å™¨<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/19.html" aria-label="ç¬¬ 19 ç« ï¼š é”™è¯¯å¤„ç†"><!---->ç¬¬ 19 ç« ï¼š é”™è¯¯å¤„ç†<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/20.html" aria-label="ç¬¬ 20 ç« ï¼šä½¿ç”¨ Haskell è¿›è¡Œç³»ç»Ÿç¼–ç¨‹"><!---->ç¬¬ 20 ç« ï¼šä½¿ç”¨ Haskell è¿›è¡Œç³»ç»Ÿç¼–ç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å‰ç«¯</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">åç«¯</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å·¥å…·</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ç®—æ³•</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->ç¬¬ 14 ç« ï¼šMonads</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">hahg</span></span><span property="author" content="hahg"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-02-25T04:39:03.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 51 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT51M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#revisiting-earlier-code-examples">å›é¡¾ä¹‹å‰ä»£ç </a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#maybe-chaining">Maybeé“¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#implicit-state">éšå¼çŠ¶æ€</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#looking-for-shared-patterns">å¯»æ‰¾å…±åŒç‰¹å¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#the-monad-typeclass">Monad ç±»å‹ç±»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#and-now-a-jargon-moment">æœ¯è¯­è§£é‡Š</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#using-a-new-monad-show-your-work">ä½¿ç”¨æ–°çš„Monad</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#information-hiding">ä¿¡æ¯éšè—</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#controlled-escape">å—æ§çš„Monad</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#leaving-a-trace">æ—¥å¿—çºªå½•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#using-the-logger-monad">ä½¿ç”¨ Logger monad</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#mixing-pure-and-monadic-code">åŒæ—¶ä½¿ç”¨puerå’Œmonadicä»£ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#putting-a-few-misconceptions-to-rest">å…³äºMonadçš„ä¸€äº›è¯¯è§£</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#building-the-logger-monad">åˆ›å»ºLogger Monad</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#sequential-logging-not-sequential-evaluation">é¡ºåºçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯é¡ºåºçš„æ±‚å€¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#the-writer-monad">Writer monad</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#the-maybe-monad">Maybe monad</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#executing-the-maybe-monad">æ‰§è¡ŒMaybe monad</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#maybe-at-work-and-good-api-design">ä½¿ç”¨Maybeï¼Œä»¥åŠå¥½çš„APIè®¾è®¡æ–¹å¼</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#the-list-monad">List Monad</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#understanding-the-list-monad">ç†è§£List monad</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#putting-the-list-monad-to-work">ä½¿ç”¨List Monad</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#desugaring-of-do-blocks">è¿˜åŸdoçš„æœ¬è´¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#monads-as-a-programmable-semicolon">Monads: å¯ç¼–ç¨‹åˆ†å·</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#why-go-sugar-free">ä¸ºä»€ä¹ˆè¦sugar-free</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#the-state-monad">çŠ¶æ€monad</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#almost-a-state-monad">è‡ªå·±å®šä¹‰State monad</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#reading-and-modifying-the-state">è¯»å–å’Œä¿®æ”¹çŠ¶æ€</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#will-the-real-state-monad-please-stand-up">çœŸæ­£çš„State monadå®šä¹‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#using-the-state-monad-generating-random-values">ä½¿ç”¨State monadç”Ÿæˆéšæœºæ•°</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#a-first-attempt-at-purity">å®ç”¨çº¯å‡½æ•°ç”Ÿæˆéšæœºæ•°çš„å°è¯•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#random-values-in-the-state-monad">state monadé‡Œé¢çš„éšæœºæ•°å€¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#running-the-state-monad">è¿è¡Œstate monad</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#ç®¡ç†æ›´å¤šçš„çŠ¶æ€">ç®¡ç†æ›´å¤šçš„çŠ¶æ€</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#monad-and-functors">Monadå’ŒFunctors</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level3" href="/#æ¢ä¸ªè§’åº¦çœ‹monad">æ¢ä¸ªè§’åº¦çœ‹Monad</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#the-monad-laws-and-good-coding-style">å•å­å¾‹ä»¥åŠä»£ç é£æ ¼</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="ç¬¬-14-ç« -monads" tabindex="-1"><a class="header-anchor" href="#ç¬¬-14-ç« -monads"><span>ç¬¬ 14 ç« ï¼šMonads</span></a></h1><hr><p>åœ¨ <code class="interpreted-text" role="doc">7</code> ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº† <code>IO</code> monadï¼Œé‚£æ—¶æˆ‘ä»¬åˆ»æ„æŠŠç²¾åŠ›é›†ä¸­åœ¨å¦‚ä½•ä¸å¤–ç•Œäº¤äº’ä¸Šï¼Œå¹¶æ²¡æœ‰è®¨è®ºmonadæ˜¯ä»€ä¹ˆã€‚</p><p>åœ¨ <code class="interpreted-text" role="doc">7</code> ä¸­æˆ‘ä»¬çœ‹åˆ° <code>IO</code> Monadç¡®å®å¾ˆå¥½ç”¨ï¼›é™¤äº†åœ¨è¯­æ³•ä¸Šä¸åŒä¹‹å¤–ï¼Œåœ¨ <code>IO</code> monadä¸­å†™ä»£ç è·Ÿå…¶ä»–å‘½ä»¤å¼è¯­è¨€åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>åœ¨å‰é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨è§£å†³ä¸€äº›å®é™…é—®é¢˜çš„æ—¶å€™å¼•å…¥äº†ä¸€äº›æ•°æ®ç»“æ„ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±ä¼šçŸ¥é“å®ƒä»¬å…¶å®å°±æ˜¯monadsã€‚æˆ‘ä»¬æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼Œåœ¨è§£å†³æŸäº›é—®é¢˜çš„æ—¶å€™ï¼Œmonadé€šå¸¸æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‚ä¸”å®ç”¨çš„å·¥å…·ã€‚æœ¬ç« æˆ‘ä»¬å°†å®šä¹‰ä¸€äº›monadså¹¶å‘Šè¯‰ä½ å®ƒæœ‰å¤šä¹ˆç®€å•ã€‚</p><h2 id="revisiting-earlier-code-examples" tabindex="-1"><a class="header-anchor" href="#revisiting-earlier-code-examples"><span>å›é¡¾ä¹‹å‰ä»£ç </span></a></h2><h3 id="maybe-chaining" tabindex="-1"><a class="header-anchor" href="#maybe-chaining"><span>Maybeé“¾</span></a></h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹æˆ‘ä»¬åœ¨ <code class="interpreted-text" role="doc">10</code> å†™çš„ <code>parseP5</code> å‡½æ•°:</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/PNM.hs</span>
<span class="token hvariable">matchHeader</span> <span class="token operator">::</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span> <span class="token operator">-&gt;</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span>

<span class="token comment">-- &quot;nat&quot; here is short for &quot;natural number&quot;</span>
<span class="token hvariable">getNat</span> <span class="token operator">::</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">)</span>

<span class="token hvariable">getBytes</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span>
         <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">,</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">)</span>

<span class="token hvariable">parseP5</span> <span class="token hvariable">s</span> <span class="token operator">=</span>
  <span class="token keyword">case</span> <span class="token hvariable">matchHeader</span> <span class="token punctuation">(</span><span class="token constant">L8</span><span class="token punctuation">.</span><span class="token builtin">pack</span> <span class="token string">&quot;P5&quot;</span><span class="token punctuation">)</span> <span class="token hvariable">s</span> <span class="token keyword">of</span>
    <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
    <span class="token constant">Just</span> <span class="token hvariable">s1</span> <span class="token operator">-&gt;</span>
      <span class="token keyword">case</span> <span class="token hvariable">getNat</span> <span class="token hvariable">s1</span> <span class="token keyword">of</span>
        <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
        <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">width</span><span class="token punctuation">,</span> <span class="token hvariable">s2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
          <span class="token keyword">case</span> <span class="token hvariable">getNat</span> <span class="token punctuation">(</span><span class="token constant">L8</span><span class="token punctuation">.</span><span class="token builtin">dropWhile</span> <span class="token builtin">isSpace</span> <span class="token hvariable">s2</span><span class="token punctuation">)</span> <span class="token keyword">of</span>
            <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
            <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">height</span><span class="token punctuation">,</span> <span class="token hvariable">s3</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
              <span class="token keyword">case</span> <span class="token hvariable">getNat</span> <span class="token punctuation">(</span><span class="token constant">L8</span><span class="token punctuation">.</span><span class="token builtin">dropWhile</span> <span class="token builtin">isSpace</span> <span class="token hvariable">s3</span><span class="token punctuation">)</span> <span class="token keyword">of</span>
                <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
                <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">maxGrey</span><span class="token punctuation">,</span> <span class="token hvariable">s4</span><span class="token punctuation">)</span>
                  <span class="token operator">|</span> <span class="token hvariable">maxGrey</span> <span class="token operator">&gt;</span> <span class="token number">255</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
                  <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">-&gt;</span>
                      <span class="token keyword">case</span> <span class="token hvariable">getBytes</span> <span class="token number">1</span> <span class="token hvariable">s4</span> <span class="token keyword">of</span>
                        <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
                        <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">_</span><span class="token punctuation">,</span> <span class="token hvariable">s5</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                          <span class="token keyword">case</span> <span class="token hvariable">getBytes</span> <span class="token punctuation">(</span><span class="token hvariable">width</span> <span class="token operator">*</span> <span class="token hvariable">height</span><span class="token punctuation">)</span> <span class="token hvariable">s5</span> <span class="token keyword">of</span>
                            <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
                            <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">bitmap</span><span class="token punctuation">,</span> <span class="token hvariable">s6</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                              <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token constant">Greymap</span> <span class="token hvariable">width</span> <span class="token hvariable">height</span> <span class="token hvariable">maxGrey</span> <span class="token hvariable">bitmap</span><span class="token punctuation">,</span> <span class="token hvariable">s6</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°è¦æ˜¯å†å¤æ‚ä¸€ç‚¹ï¼Œå°±è¦è¶…å‡ºå±å¹•çš„å³è¾¹äº†ï¼›å½“æ—¶æˆ‘ä»¬ä½¿ç”¨ <code>(&gt;&gt;?)</code> æ“ä½œç¬¦é¿å…äº†è¿™ç§æƒ…å†µ:</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/PNM.hs</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;?</span><span class="token punctuation">)</span> <span class="token operator">::</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token hvariable">b</span>
<span class="token constant">Nothing</span> <span class="token operator">&gt;&gt;?</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token constant">Nothing</span>
<span class="token constant">Just</span> <span class="token hvariable">v</span>  <span class="token operator">&gt;&gt;?</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">v</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯¹ <code>(&gt;&gt;?)</code> æ“ä½œç¬¦çš„ç±»å‹è¿›è¡Œäº†ç²¾æŒ‘ç»†é€‰ä½¿å¾—å®ƒèƒ½æŠŠä¸€ç³»åˆ—è¿”å›ç±»å‹æ˜¯ <code>Maybe</code> çš„å‡½æ•°ä¸²è”èµ·æ¥ï¼›åªè¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼èƒ½å’Œä¸‹ä¸€ä¸ªå‡½æ•°çš„å‚æ•°ç±»å‹åŒ¹é…ï¼Œæˆ‘ä»¬å°±èƒ½æ— é™ä¸²è”è¿”å›ç±»å‹æ˜¯ <code>Maybe</code> çš„å‡½æ•°ã€‚ <code>(&gt;&gt;?)</code> çš„å‡½æ•°ä½“æŠŠç»†èŠ‚éšè—äº†èµ·æ¥ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æˆ‘ä»¬é€šè¿‡ <code>(&gt;&gt;?)</code> ä¸²è”çš„å‡½æ•°æ˜¯ç”±äºä¸­é—´æŸä¸ªå‡½æ•°è¿”å› <code>Nothing</code> è€Œä¸­æ–­äº†è¿˜æ˜¯æ‰€æœ‰å‡½æ•°å…¨éƒ¨æ‰§è¡Œäº†ã€‚</p><h3 id="implicit-state" tabindex="-1"><a class="header-anchor" href="#implicit-state"><span>éšå¼çŠ¶æ€</span></a></h3><p><code>(&gt;&gt;?)</code> è¢«ç”¨æ¥æ•´ç† <code>parseP5</code> çš„ç»“æ„ï¼Œä½†æ˜¯åœ¨è§£æçš„æ—¶å€™æˆ‘ä»¬è¿˜æ˜¯è¦ä¸€ç‚¹ä¸€ç‚¹åœ°å¤„ç†è¾“å…¥å­—ç¬¦ä¸²ï¼›è¿™ä½¿å¾—æˆ‘ä»¬å¿…é¡»æŠŠå½“å‰å¤„ç†çš„å€¼é€šè¿‡ä¸€ä¸ªå…ƒç»„ä¼ é€’ä¸‹å»[è‹¥å¹²ä¸ªå‡½æ•°ä¸²è”äº†èµ·æ¥ï¼Œéƒ½è¿”å›Maybeï¼Œä½œè€…ç§°ä¹‹ä¸ºMaybeé“¾]ã€‚Maybeé“¾ä¸Šçš„æ¯ä¸€ä¸ªå‡½æ•°æŠŠè‡ªå·±å¤„ç†çš„ç»“æœä»¥åŠè‡ªå·±æ²¡æœ‰è§£æçš„å‰©ä¸‹çš„å­—ç¬¦ä¸²æ”¾åˆ°å…ƒç»„é‡Œé¢ï¼Œå¹¶ä¼ é€’ä¸‹å»ã€‚ :</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/PNM.hs</span>
<span class="token hvariable">parseP5_take2</span> <span class="token operator">::</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token constant">Greymap</span><span class="token punctuation">,</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">)</span>
<span class="token hvariable">parseP5_take2</span> <span class="token hvariable">s</span> <span class="token operator">=</span>
    <span class="token hvariable">matchHeader</span> <span class="token punctuation">(</span><span class="token constant">L8</span><span class="token punctuation">.</span><span class="token builtin">pack</span> <span class="token string">&quot;P5&quot;</span><span class="token punctuation">)</span> <span class="token hvariable">s</span>       <span class="token operator">&gt;&gt;?</span>
    <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token hvariable">skipSpace</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>           <span class="token operator">&gt;&gt;?</span>
    <span class="token punctuation">(</span><span class="token hvariable">getNat</span> <span class="token operator">.</span> <span class="token builtin">snd</span><span class="token punctuation">)</span>                    <span class="token operator">&gt;&gt;?</span>
    <span class="token hvariable">skipSpace</span>                         <span class="token operator">&gt;&gt;?</span>
    <span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">width</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>   <span class="token hvariable">getNat</span> <span class="token hvariable">s</span>         <span class="token operator">&gt;&gt;?</span>
    <span class="token hvariable">skipSpace</span>                         <span class="token operator">&gt;&gt;?</span>
    <span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">height</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>  <span class="token hvariable">getNat</span> <span class="token hvariable">s</span>         <span class="token operator">&gt;&gt;?</span>
    <span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">maxGrey</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">getBytes</span> <span class="token number">1</span> <span class="token hvariable">s</span>     <span class="token operator">&gt;&gt;?</span>
    <span class="token punctuation">(</span><span class="token hvariable">getBytes</span> <span class="token punctuation">(</span><span class="token hvariable">width</span> <span class="token operator">*</span> <span class="token hvariable">height</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token builtin">snd</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;?</span>
    <span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">bitmap</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token constant">Greymap</span> <span class="token hvariable">width</span> <span class="token hvariable">height</span> <span class="token hvariable">maxGrey</span> <span class="token hvariable">bitmap</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>

<span class="token hvariable">skipSpace</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">L<span class="token punctuation">.</span>ByteString</span><span class="token punctuation">)</span>
<span class="token hvariable">skipSpace</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token constant">Just</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">L8</span><span class="token punctuation">.</span><span class="token builtin">dropWhile</span> <span class="token builtin">isSpace</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åˆç¢°åˆ°äº†æœ‰ç€é‡å¤è¡Œä¸ºçš„æ¨¡å¼ï¼šå¤„ç†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼ŒæŸä¸ªå‡½æ•°æ¶ˆè€—éƒ¨åˆ†å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒå¤„ç†çš„ç»“æœï¼ŒåŒæ—¶æŠŠå‰©ä¸‹çš„å­—ç¬¦ä¸²ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ç»§ç»­å¤„ç†ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ¨¡å¼æ¯”ä¹‹å‰çš„æ›´ç³Ÿç³•ï¼šå¦‚æœæˆ‘ä»¬è¦åœ¨å¤„ç†é“¾å¾€ä¸‹ä¼ é€’å¦å¤–ä¸€äº›é¢å¤–ä¿¡æ¯ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠä¼ é€’çš„äºŒå…ƒç»„ä¿®æ”¹ä¸ºä¸‰å…ƒç»„ï¼Œè¿™å‡ ä¹è¦ä¿®æ”¹è¿™ä¸ªå¤„ç†é“¾ä¸Šçš„æ‰€æœ‰å…ƒç´ ï¼</p><p>æˆ‘ä»¬æŠŠç®¡ç†å½“å‰å­—ç¬¦ä¸²çš„ä»»åŠ¡ä»å¤„ç†é“¾ä¸Šçš„å•ä¸ªå‡½æ•°ç§»å‡ºæ¥ï¼Œå°†å®ƒ(ç®¡ç†å­—ç¬¦ä¸²)è½¬äº¤ç»™ä¸²è”è¿™äº›å•ä¸ªå‡½æ•°çš„å‡½æ•°å®Œæˆï¼[è¯‘ï¼šæ¯”å¦‚ä¸Šé¢çš„ <code>(&gt;&gt;?)</code>]</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/Parse.hs</span>
<span class="token punctuation">(</span><span class="token operator">==&gt;</span><span class="token punctuation">)</span> <span class="token operator">::</span> <span class="token constant">Parse</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Parse</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Parse</span> <span class="token hvariable">b</span>

<span class="token hvariable">firstParser</span> <span class="token operator">==&gt;</span> <span class="token hvariable">secondParser</span>  <span class="token operator">=</span>  <span class="token constant">Parse</span> <span class="token hvariable">chainedParser</span>
  <span class="token keyword">where</span> <span class="token hvariable">chainedParser</span> <span class="token hvariable">initState</span>   <span class="token operator">=</span>
          <span class="token keyword">case</span> <span class="token hvariable">runParse</span> <span class="token hvariable">firstParser</span> <span class="token hvariable">initState</span> <span class="token keyword">of</span>
            <span class="token constant">Left</span> <span class="token hvariable">errMessage</span> <span class="token operator">-&gt;</span>
                <span class="token constant">Left</span> <span class="token hvariable">errMessage</span>
            <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">firstResult</span><span class="token punctuation">,</span> <span class="token hvariable">newState</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
                <span class="token hvariable">runParse</span> <span class="token punctuation">(</span><span class="token hvariable">secondParser</span> <span class="token hvariable">firstResult</span><span class="token punctuation">)</span> <span class="token hvariable">newState</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬æŠŠè§£æçŠ¶æ€çš„ç»†èŠ‚éšè—åœ¨ <code>ParseState</code> ç±»å‹ä¸­ï¼Œå°±è¿ <code>getState</code> å’Œ <code>putState</code> éƒ½ä¸ä¼šçª¥è§†è§£æçŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œæ— è®ºå¯¹ <code>ParseState</code> åšæ€æ ·çš„ä¿®æ”¹éƒ½ä¸ä¼šå½±å“å·²æœ‰çš„ä»£ç ã€‚</p><h2 id="looking-for-shared-patterns" tabindex="-1"><a class="header-anchor" href="#looking-for-shared-patterns"><span>å¯»æ‰¾å…±åŒç‰¹å¾</span></a></h2><p>å¦‚æœæˆ‘ä»¬ä»”ç»†åˆ†æä¸Šé¢çš„ä¾‹å­ï¼Œå®ƒä»¬å¥½åƒæ²¡æœ‰ä»€ä¹ˆå…±åŒç‰¹ç‚¹ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹æ¯”è¾ƒæ˜æ˜¾ï¼Œå®ƒä»¬éƒ½æƒ³æŠŠå‡½æ•°ä¸²è”èµ·æ¥å¹¶è¯•å›¾éšè—ç»†èŠ‚ä»¥ä¾¿æˆ‘ä»¬å†™å‡ºæ•´æ´çš„ä»£ç ã€‚ç„¶åï¼Œæˆ‘ä»¬å…ˆä¸ç®¡é‚£äº›ç»†èŠ‚ï¼Œä»æ›´ç²—ç•¥çš„å±‚é¢å»æ€è€ƒä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€çœ‹ç±»å‹å£°æ˜ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token keyword">data</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Nothing</span>
             <span class="token operator">|</span> <span class="token constant">Just</span> <span class="token hvariable">a</span>

<span class="token comment">-- file: ch11/Parse.hs</span>
<span class="token keyword">newtype</span> <span class="token constant">Parse</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Parse</span> <span class="token punctuation">{</span>
      <span class="token hvariable">runParse</span> <span class="token operator">::</span> <span class="token constant">ParseState</span> <span class="token operator">-&gt;</span> <span class="token constant">Either</span> <span class="token constant">String</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">ParseState</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ä¸ªç±»å‹çš„å…±åŒç‰¹ç‚¹æ˜¯å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç±»å‹å‚æ•°ï¼Œå› æ­¤å®ƒä»¬éƒ½æ˜¯èŒƒå‹ï¼Œå¯¹å…·ä½“çš„ç±»å‹ä¸€æ— æ‰€çŸ¥ã€‚</p><p>ç„¶åçœ‹ä¸€çœ‹æˆ‘ä»¬ç»™ä¸¤ä¸ªç±»å‹å†™çš„ä¸²è”å‡½æ•°ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span>?<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span>?<span class="token punctuation">)</span> :: Maybe a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> Maybe b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> Maybe b

ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">==</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> :: Parse a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> Parse b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> Parse b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸¤ä¸ªå‡½æ•°çš„ç±»å‹éå¸¸ç›¸ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒä»¬çš„ç±»å‹æ„é€ å™¨æ›¿æ¢ä¸ºä¸€ä¸ªç±»å‹å˜é‡ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªæ›´åŠ æŠ½è±¡çš„ç±»å‹ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token hvariable">chain</span> <span class="token operator">::</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€ç»ˆï¼Œåœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¾—åˆ°äº†ä¸€ä¸ªè·å–ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œç„¶åæŠŠå®ƒ&quot;æ³¨å…¥&quot;åˆ°ä¸€ä¸ªç›®æ ‡ç±»å‹é‡Œé¢å»çš„å‡½æ•°ã€‚å¯¹äº <code>Maybe</code> ç±»å‹ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯å®ƒçš„ä¸€ä¸ªå€¼æ„é€ å™¨ <code>Just</code> ï¼Œ<code>Parse</code>çš„æ³¨å…¥å‡½æ•°å°±ç•¥å¾®å¤æ‚ä¸€äº›ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/Parse.hs</span>
<span class="token hvariable">identity</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Parse</span> <span class="token hvariable">a</span>
<span class="token hvariable">identity</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Parse</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token constant">Right</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¸ç”¨å…³å¿ƒå®ƒçš„å®ç°ç»†èŠ‚ï¼Œä¹Ÿä¸ç®¡å®ƒæœ‰å¤šä¹ˆå¤æ‚ï¼›é‡è¦çš„æ˜¯ï¼Œè¿™äº›ç±»å‹éƒ½æœ‰ä¸€ä¸ª&quot;æ³¨å…¥å™¨&quot;å‡½æ•°ï¼Œå®ƒå¤§è‡´é•¿è¿™æ ·ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token hvariable">inject</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨Haskellé‡Œé¢ï¼Œæ­£æ˜¯è¿™ä¸‰ä¸ªå±æ€§å’Œä¸€äº›å¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„è§„åˆ™å®šä¹‰äº†monadã€‚æˆ‘ä»¬é›†ä¸­æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li>ä¸€ä¸ªç±»å‹æ„é€ å™¨ <code>m</code></li><li>ä¸€ä¸ªç”¨äºæŠŠæŸä¸ªå‡½æ•°çš„è¾“å‡ºä¸²è”åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°è¾“å…¥ä¸Šçš„å‡½æ•°ï¼Œå®ƒçš„ç±»å‹æ˜¯ <code>m a -&gt; (a -&gt; m b) -&gt; m b</code></li><li>ä¸€ä¸ªç±»å‹æ˜¯ <code>a -&gt; m a</code> ç±»å‹çš„å‡½æ•°ï¼Œå®ƒæŠŠæ™®é€šå€¼æ³¨å…¥åˆ°è°ƒç”¨é“¾é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæŠŠç±»å‹ <code>a</code> ç”¨ç±»å‹æ„é€ å™¨ <code>m</code> åŒ…è£…èµ·æ¥ã€‚</li></ol><p>Maybe ç±»å‹çš„ç±»å‹æ„é€ å™¨ <code>Maybe a</code> ,ä¸²è”å‡½æ•° <code>(&gt;&gt;?)</code> ä»¥åŠæ³¨å…¥å‡½æ•° <code>Just</code> ä½¿Maybeæˆä¸ºä¸€ä¸ªmonadã€‚å¯¹äº <code>Parse</code> ç±»å‹ï¼Œå¯¹åº”çš„æ˜¯ç±»å‹æ„é€ å™¨ <code>Parse a</code> ï¼Œä¸²è”å‡½æ•° <code>Parse a</code> ä»¥åŠæ³¨å…¥å‡½æ•° <code>identify</code> ã€‚</p><p>å¯¹äºMonadçš„ä¸²è”å‡½æ•°å’Œæ³¨å…¥å‡½æ•°å…·ä½“åº”è¯¥å¹²ä»€ä¹ˆæˆ‘ä»¬åˆ»æ„åªå­—æœªæï¼Œå› ä¸ºå®ƒå‡ ä¹ä¸é‡è¦ã€‚äº‹å®ä¸Šï¼Œæ­£æ˜¯å› ä¸ºMonadå¦‚æ­¤ç®€å•ï¼Œå®ƒåœ¨Haskellé‡Œé¢æ— å¤„ä¸åœ¨ã€‚è®¸å¤šå¸¸è§çš„ç¼–ç¨‹æ¨¡å¼éƒ½ç”¨åˆ°äº†monadç»“æ„ï¼šä¼ é€’éšå¼æ•°æ®ï¼Œæˆ–æ˜¯çŸ­è·¯æ±‚å€¼é“¾ã€‚</p><h2 id="the-monad-typeclass" tabindex="-1"><a class="header-anchor" href="#the-monad-typeclass"><span>Monad ç±»å‹ç±»</span></a></h2><p>åœ¨ Haskell é‡Œé¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç±»å‹ç±»(typeclass)æ¥è¡¨ç¤º&quot;ä¸²è”&quot;ä»¥åŠ&quot;æ³¨å…¥&quot;çš„æ¦‚å¿µä»¥åŠå®ƒä»¬çš„ç±»å‹ã€‚æ ‡å‡†åº“çš„Preduleæ¨¡å—å·²ç»åŒ…å«äº†è¿™æ ·ä¸€ä¸ªç±»å‹ç±»ï¼Œä¹Ÿå°±æ˜¯ <code>Monad</code> ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token keyword">class</span> <span class="token constant">Monad</span> <span class="token hvariable">m</span> <span class="token keyword">where</span>
    <span class="token comment">-- chain</span>
    <span class="token punctuation">(</span><span class="token operator">&gt;&gt;=</span><span class="token punctuation">)</span>  <span class="token operator">::</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span>
    <span class="token comment">-- inject</span>
    <span class="token builtin">return</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œ<code>(&gt;&gt;=)</code> å°±æ˜¯æˆ‘ä»¬çš„ä¸²è”å‡½æ•°ã€‚ åœ¨ <code class="interpreted-text" role="ref">sequencing</code> ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†å®ƒã€‚é€šå¸¸å°†è¿™ä¸ªæ“ä½œç¬¦ç§°å‘¼ä¸º&quot;ç»‘å®š&quot;ï¼Œå› ä¸ºå®ƒæŠŠå·¦ä¾§è¿ç®—çš„ç»“æœç»‘å®šåˆ°å³ä¾§è¿ç®—çš„å‚æ•°ä¸Šã€‚</p><p>æˆ‘ä»¬çš„æ³¨å…¥å‡½æ•°æ˜¯ <code>return</code> ,åœ¨ <code class="interpreted-text" role="ref">the-nature-of-return</code> ä¸­è®²è¿‡ï¼Œé€‰ç”¨ <code>return</code> è¿™ä¸ªåå­—æœ‰ç‚¹å€’éœ‰ã€‚è¿™ä¸ªå…³é”®å­—åœ¨å‘½ä»¤å¼è¯­è¨€ä¸­è¢«å¹¿æ³›ä½¿ç”¨å¹¶ä¸”æœ‰ä¸€ä¸ªéå¸¸å®¹æ˜“ç†è§£çš„å«ä¹‰ã€‚ä½†æ˜¯åœ¨Haskellé‡Œé¢å®ƒçš„å«ä¹‰å®Œå…¨ä¸åŒï¼›å…·ä½“æ¥è¯´ï¼Œåœ¨å‡½æ•°è°ƒç”¨é“¾ä¸­é—´ä½¿ç”¨ <code>return</code> å¹¶ä¸ä¼šå¯¼è‡´è°ƒç”¨é“¾æå‰ä¸­æ­¢ï¼›æˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£å®ƒï¼šå®ƒæŠŠçº¯å€¼( <code>a</code> ç±»å‹)æ”¾è¿›(returns)monads( <code>m a</code> ç±»å‹)é‡Œã€‚</p><p><code>(&gt;&gt;=)</code> å’Œ <code>return</code> æ˜¯ <code>Monad</code> è¿™ä¸ªç±»å‹ç±»çš„æ ¸å¿ƒå‡½æ•°ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜å®šä¹‰äº†å¦å¤–ä¸¤ä¸ªå‡½æ•°ã€‚ä¸€ä¸ªå‡½æ•°æ˜¯ <code>(&gt;&gt;)</code> ï¼Œç±»ä¼¼äº <code>(&gt;&gt;=)</code> ï¼Œå®ƒçš„ä½œç”¨ä¹Ÿæ˜¯ä¸²è”ï¼Œä½†æ˜¯å®ƒå¿½ç•¥å·¦ä¾§çš„å€¼ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
    <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span> <span class="token operator">::</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span>
        <span class="token hvariable">a</span> <span class="token operator">&gt;&gt;</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">_</span> <span class="token operator">-&gt;</span> <span class="token hvariable">f</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬éœ€è¦æŒ‰é¡ºåºæ‰§è¡Œä¸€ç³»åˆ—æ“ä½œçš„ï¼Œå¹¶ä¸”ä¸å…³å¿ƒå…ˆå‰çš„è®¡ç®—ç»“æœçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™æ“ä½œç¬¦ã€‚è¿™æ ·ä¹Ÿè®¸çœ‹èµ·æ¥è®©äººè§‰å¾—è´¹è§£ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šå¿½ç•¥ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼å‘¢ï¼Œè¿™æ ·æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿå›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰äº†ä¸€ä¸ª <code>(==&gt;&amp;)</code> ç»„åˆå­æ¥ä¸“é—¨è¡¨è¾¾è¿™ä¸ªæ¦‚å¿µã€‚å¦å¤–ï¼Œè€ƒè™‘ä¸€ä¸‹ <code>print</code> è¿™æ ·çš„å‡½æ•°ï¼Œå®ƒçš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦å…³å¿ƒå®ƒè¿”å›å€¼æ˜¯ä»€ä¹ˆã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type print <span class="token string">&quot;foo&quot;</span>
print <span class="token string">&quot;foo&quot;</span> :: IO <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ™®é€šçš„ <code>(&gt;&gt;=)</code> æ¥ä¸²è”è°ƒç”¨ï¼Œæˆ‘ä»¬å¿…é¡»æä¾›ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥å¿½ç•¥å‚æ•°ï¼ˆè¿™ä¸ªå‚æ•°æ˜¯å‰ä¸€ä¸ª <code>print</code> çš„è¿”å›å€¼ã€‚)</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> print <span class="token string">&quot;foo&quot;</span> <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token punctuation">\</span>_ -<span class="token operator">&gt;</span> print <span class="token string">&quot;bar&quot;</span>
<span class="token string">&quot;foo&quot;</span>
<span class="token string">&quot;bar&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>(&gt;&gt;)</code> æ“ä½œç¬¦ï¼Œé‚£ä¹ˆå°±å¯ä»¥å»æ‰é‚£ä¸ªæ²¡ä»€ä¹ˆç”¨çš„å‡½æ•°äº†ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> print <span class="token string">&quot;baz&quot;</span> <span class="token operator">&gt;&gt;</span> print <span class="token string">&quot;quux&quot;</span>
<span class="token string">&quot;baz&quot;</span>
<span class="token string">&quot;quux&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¦‚æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„ä¸€æ ·ï¼Œ <code>(&gt;&gt;)</code> çš„é»˜è®¤å®ç°æ˜¯é€šè¿‡ <code>(&gt;&gt;=)</code> å®Œæˆçš„ã€‚</p><p>Monadç±»å‹ç±»å¦å¤–ä¸€ä¸ªéæ ¸å¿ƒå‡½æ•°æ˜¯ <code>fail</code> ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ç„¶åè®©å‡½æ•°è°ƒç”¨é“¾å¤±è´¥ã€‚</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>è®¸å¤šMonadå®ç°å¹¶æ²¡æœ‰é‡å†™ <code>fail</code>å‡½æ•°çš„é»˜è®¤å®ç°ï¼Œå› æ­¤åœ¨è¿™äº›Monadé‡Œé¢ï¼Œ<code>fail</code> å°†ç”± <code>error</code> å‡½æ•°å®ç°ã€‚ä½†æ˜¯ç”±äº <code>error</code> å‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸å¯¹äºè°ƒç”¨è€…æ¥è¯´è¦ä¹ˆå°±æ˜¯æ— æ³•æ•è·çš„ï¼Œè¦ä¹ˆå°±æ˜¯æ— æ³•é¢„æœŸçš„ï¼Œæ‰€ä»¥è°ƒç”¨ <code>error</code> å¹¶ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚ å°±ç®—ä½ å¾ˆæ¸…æ¥šåœ¨Monadä½¿ç”¨ <code>fail</code> åœ¨å½“å‰åœºæ™¯ä¸‹æ˜¯ä¸ªæ˜æ™ºä¹‹é€‰ï¼Œä½†æ˜¯ä¾ç„¶éå¸¸ä¸æ¨èä½¿ç”¨å®ƒã€‚å½“ä½ ä»¥åé‡æ„ä»£ç çš„æ—¶å€™ï¼Œå¾ˆæœ‰å¯èƒ½è¿™ä¸ª <code>fail</code> å‡½æ•°åœ¨æ–°çš„è¯­å¢ƒä¸‹æ— æ³•å·¥ä½œä»è€Œå¯¼è‡´éå¸¸å¤æ‚çš„é—®é¢˜ï¼Œè¿™ç§æƒ…å†µå¤ªå®¹æ˜“å‘ç”Ÿäº†ã€‚</p></div><p>å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨ <code class="interpreted-text" role="doc">10</code> å†™çš„parseï¼Œé‡Œé¢æœ‰ä¸€ä¸ª <code>Monad</code> çš„å®ä¾‹ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch10/Parse.hs</span>
<span class="token keyword">instance</span> <span class="token constant">Monad</span> <span class="token constant">Parse</span> <span class="token keyword">where</span>
    <span class="token builtin">return</span> <span class="token operator">=</span> <span class="token hvariable">identity</span>
    <span class="token punctuation">(</span><span class="token operator">&gt;&gt;=</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">==&gt;</span><span class="token punctuation">)</span>
    <span class="token builtin">fail</span> <span class="token operator">=</span> <span class="token hvariable">bail</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="and-now-a-jargon-moment" tabindex="-1"><a class="header-anchor" href="#and-now-a-jargon-moment"><span>æœ¯è¯­è§£é‡Š</span></a></h2><p>å¯èƒ½ä½ å¯¹monadçš„æŸäº›æƒ¯ç”¨è¯­å¹¶ä¸ç†Ÿæ‚‰ï¼Œè™½ç„¶ä»–ä»¬ä¸æ˜¯æ­£å¼æœ¯è¯­ï¼Œä½†æ˜¯å¾ˆå¸¸è§ï¼›å› æ­¤æœ‰å¿…è¦äº†è§£ä¸€ä¸‹ã€‚</p><ul><li>&quot;Monadic&quot;ä»…ä»…è¡¨ç¤º&quot;å’ŒMonadç›¸å…³çš„&quot;ã€‚ä¸€ä¸ªmonadic ç±»å‹å°±æ˜¯ä¸€ä¸ªMonad ç±»å‹ç±»çš„å®ä¾‹ï¼›ä¸€ä¸ªmonadicå€¼å°±æ˜¯ä¸€ä¸ªå…·æœ‰monadicç±»å‹çš„å€¼ã€‚</li><li>å½“æˆ‘ä»¬è¯´æŸä¸ªä¸œè¥¿&quot;æ˜¯ä¸€ä¸ªmonad&quot;çš„æ—¶å€™ï¼Œæˆ‘ä»¬å…¶å®è¡¨è¾¾çš„æ„æ€æ˜¯&quot;è¿™ä¸ªç±»å‹æ˜¯Monadè¿™ä¸ªç±»å‹ç±»çš„å®ä¾‹&quot;ï¼›ä½œä¸ºMonadçš„å®ä¾‹å°±æœ‰ä¸‰è¦ç´ ï¼šç±»å‹æ„é€ å™¨ï¼Œæ³¨å…¥å‡½æ•°ï¼Œä¸²è”å‡½æ•°ã€‚</li><li>åŒæ ·ï¼Œå½“æˆ‘ä»¬è°ˆåˆ°&quot;Fooè¿™ä¸ªmonad&quot;çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸ŠæŒ‡çš„æ˜¯Fooè¿™ä¸ªç±»å‹ï¼Œåªä¸è¿‡Fooæ˜¯Monadè¿™ä¸ªç±»å‹ç±»çš„å®ä¾‹ã€‚</li><li>Monadicå€¼çš„ä¸€ä¸ªåˆ«ç§°æ˜¯&quot;åŠ¨ä½œ&quot;ï¼›è¿™ä¸ªè¯´æ³•å¯èƒ½æºè‡ª <code>I/O Monad</code> çš„å¼•å…¥ï¼Œ<code>print &quot;foo&quot;</code> è¿™æ ·çš„monadå€¼ä¼šå¯¼è‡´å‰¯ä½œç”¨ã€‚è¿”å›ç±»å‹æ˜¯monadicå€¼çš„å‡½æ•°æœ‰æ—¶å€™ä¹Ÿè¢«ç§°ä¹‹ä¸ºåŠ¨ä½œï¼Œè™½ç„¶è¿™æ ·å¹¶ä¸å¤ªå¸¸è§ã€‚</li></ul><h2 id="using-a-new-monad-show-your-work" tabindex="-1"><a class="header-anchor" href="#using-a-new-monad-show-your-work"><span>ä½¿ç”¨æ–°çš„Monad</span></a></h2><p>æˆ‘ä»¬åœ¨ä»‹ç»Monadçš„æ—¶å€™ï¼Œå±•ç¤ºäº†ä¸€äº›ä¹‹å‰çš„ä»£ç ï¼Œå¹¶è¯´æ˜å®ƒä»¬å…¶å®å°±æ˜¯Monadã€‚æ—¢ç„¶æˆ‘ä»¬æ…¢æ…¢çŸ¥é“monadæ˜¯ä»€ä¹ˆï¼Œè€Œä¸”å·²ç»è§è¯†è¿‡ <code>Monad</code> è¿™ä¸ªç±»å‹ç±»ï¼›ç°åœ¨å°±è®©æˆ‘ä»¬ç”¨å­¦åˆ°çš„çŸ¥è¯†æ¥å†™ä¸€ä¸ªMonadå§ã€‚æˆ‘ä»¬å…ˆå®šä¹‰å®ƒçš„æ¥å£ï¼Œç„¶åä½¿ç”¨å®ƒï¼›ä¸€æ—¦å®Œæˆäº†è¿™äº›ï¼Œæˆ‘ä»¬å°±å†™å‡ºäº†è‡ªå·±çš„Monadï¼</p><p>çº¯ç²¹çš„Haskellä»£ç å†™èµ·æ¥éå¸¸ç®€æ´ï¼Œä½†æ˜¯å®ƒä¸èƒ½æ‰§è¡ŒIOæ“ä½œï¼›æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è®°ä¸‹æˆ‘ä»¬ç¨‹åºçš„ä¸€äº›æ“ä½œï¼Œä½†æ˜¯åˆä¸æƒ³ç›´æ¥æŠŠæ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶ï¼›å°±è¿™äº›éœ€æ±‚ï¼Œæˆ‘ä»¬å¼€å‘ä¸€ä¸ªå°å‹åº“ã€‚</p><p>å›å¿†ä¸€ä¸‹æˆ‘ä»¬åœ¨ <code class="interpreted-text" role="ref">translate-a-glob-pattern-into-a-regular-expression</code> ä¸­å®šä¹‰çš„ <code>globToRegex</code> å‡½æ•°ï¼›æˆ‘ä»¬ä¿®æ”¹å®ƒè®©å®ƒèƒ½å¤Ÿè®°ä½æ¯æ¬¡å®ƒç¿»è¯‘è¿‡çš„å¥å­ã€‚æˆ‘ä»¬åˆå›åˆ°äº†ç†Ÿæ‚‰çš„ææ€–åœºæ™¯ï¼šæ¯”è¾ƒåŒä¸€ä»½ä»£ç çš„Monadicç‰ˆæœ¬å’ŒéMonadicç‰ˆã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>Logger</code> ç±»å‹ç±»æŠŠå¤„ç†ç»“æœçš„ç±»å‹åŒ…è£…èµ·æ¥ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Logger</span> <span class="token constant">String</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="information-hiding" tabindex="-1"><a class="header-anchor" href="#information-hiding"><span>ä¿¡æ¯éšè—</span></a></h3><p>æˆ‘ä»¬å°†åˆ»æ„éšè— <code>Logger</code> æ¨¡å—çš„å®ç°ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token keyword">module</span> <span class="token constant">Logger</span>
    <span class="token punctuation">(</span>
      <span class="token constant">Logger</span>
    <span class="token punctuation">,</span> <span class="token constant">Log</span>
    <span class="token punctuation">,</span> <span class="token hvariable">runLogger</span>
    <span class="token punctuation">,</span> <span class="token hvariable">record</span>
    <span class="token punctuation">)</span> <span class="token keyword">where</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åƒè¿™æ ·éšè—å®ç°æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šå®ƒå¾ˆå¤§ç¨‹åº¦å‡ºä¸Šä¿è¯äº†æˆ‘ä»¬å¯¹äºMonadå®ç°çš„çµæ´»æ€§ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œè¿™æ ·æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„æ¥å£ã€‚</p><p><code>Logger</code> ç±»å‹å°±æ˜¯å•çº¯çš„ä¸€ä¸ªç±»å‹æ„é€ å™¨ã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰å°†å®ƒçš„å€¼æ„é€ å™¨å¯¼å‡ºï¼Œå› æ­¤ <code>Logger</code> æ¨¡å—çš„ä½¿ç”¨è€…æ²¡æœ‰åŠæ³•è‡ªå·±åˆ›å»ºä¸€ä¸ª <code>Logger</code> ç±»å‹çš„å€¼ï¼Œå®ƒä»¬å¯¹äº <code>Logger</code> ç±»å‹èƒ½åšçš„å°±æ˜¯æŠŠå®ƒå†™åœ¨ç±»å‹ç­¾åä¸Šã€‚</p><p><code>Log</code> ç±»å‹å°±æ˜¯ä¸€ä¸²å­—ç¬¦ä¸²çš„åˆ«åï¼Œè¿™æ ·å†™æ˜¯ä¸ºäº†è®©å®ƒå¯è¯»æ€§æ›´å¥½ã€‚åŒæ—¶æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸²å­—ç¬¦ä¸²æ¥ä¿æŒå®ç°çš„ç®€å•ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token keyword">type</span> <span class="token constant">Log</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">String</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ç»™æ¥å£çš„ä½¿ç”¨è€…æä¾›äº†ä¸€ä¸ª <code>runLogger</code> å‡½æ•°æ¥æ‰§è¡ŒæŸä¸ªæ—¥å¿—æ“ä½œï¼Œè€Œä¸æ˜¯ç›´æ¥ç»™ä»–ä»¬ä¸€ä¸ªå€¼æ„é€ å™¨ã€‚è¿™ä¸ªå‡½æ•°æ—¢å›ä¼ äº†æ—¥å¿—çºªå½•è¿™ä¸ªæ“ä½œï¼ŒåŒæ—¶ä¹Ÿå›ä¼ äº†æ—¥å¿—ä¿¡æ¯æœ¬èº«ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">runLogger</span> <span class="token operator">::</span> <span class="token constant">Logger</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">Log</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="controlled-escape" tabindex="-1"><a class="header-anchor" href="#controlled-escape"><span>å—æ§çš„Monad</span></a></h3><p>Monadç±»å‹ç±»æ²¡æœ‰æä¾›ä»»ä½•æ–¹æ³•ä½¿ä¸€ä¸ªmonadicçš„å€¼æˆä¸ºä¸€ä¸ªæ™®é€šçš„å€¼ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>return</code> å‡½æ•°æŠŠä¸€ä¸ªæ™®é€šçš„å€¼&quot;æ³¨å…¥&quot;åˆ°monadé‡Œé¢ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ <code>(&gt;&gt;=)</code> æ“ä½œç¬¦æŠŠä¸€ä¸ªmonadicçš„å€¼æå–å‡ºæ¥ï¼Œä½†æ˜¯ç»è¿‡æ“ä½œç¬¦å¤„ç†ä¹‹åè¿˜æ˜¯å›ä¼ ä¸€ä¸ªmonadicçš„å€¼ã€‚</p><p>å¾ˆå¤šmonadséƒ½æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªç±»ä¼¼ <code>runLogger</code> çš„å‡½æ•°ï¼› <code>IO</code> monadæ˜¯ä¸ªä¾‹å¤–ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬åªèƒ½é€€å‡ºæ•´ä¸ªç¨‹åºæ¥è„±ç¦»è¿™ä¸ªmonadã€‚</p><p>ä¸€ä¸ªMonadå‡½æ•°åœ¨monadå†…éƒ¨æ‰§è¡Œç„¶åå‘å¤–è¿”å›ç»“æœï¼›ä¸€èˆ¬æ¥è¯´è¿™äº›å‡½æ•°æ˜¯æŠŠä¸€ä¸ªMonadicçš„å€¼è„±ç¦»Monadæˆä¸ºä¸€ä¸ªæ™®é€šå€¼çš„å”¯ä¸€æ–¹æ³•ã€‚å› æ­¤ï¼ŒMonadçš„åˆ›å»ºè€…å¯¹äºå¦‚ä½•å¤„ç†è¿™ä¸ªè¿‡ç¨‹æœ‰ç€å®Œå…¨çš„æ§åˆ¶æƒã€‚</p><p>æœ‰çš„Monadæœ‰å¥½å‡ ä¸ªæ‰§è¡Œå‡½æ•°ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªLoggerçš„ä¾‹å­é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æœ‰ä¸€äº› <code>runLogger</code> çš„æ›¿ä»£æ–¹æ³•ï¼šä¸€ä¸ªä»…ä»…è¿”å›æ—¥å¿—ä¿¡æ¯ï¼Œå¦å¤–ä¸€ä¸ªå¯èƒ½è¿”å›æ—¥å¿—æ“ä½œï¼Œç„¶åæŠŠæ—¥å¿—ä¿¡æ¯æœ¬èº«ä¸¢æ‰ã€‚</p><h3 id="leaving-a-trace" tabindex="-1"><a class="header-anchor" href="#leaving-a-trace"><span>æ—¥å¿—çºªå½•</span></a></h3><p>å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ª <code>Logger</code> åŠ¨ä½œçš„æ—¶å€™ï¼Œä»£ç å°†è°ƒç”¨ <code>record</code> å‡½æ•°æ¥çºªå½•æŸäº›ä¸œè¥¿ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">record</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Logger</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äºæ—¥å¿—çºªå½•çš„è¿‡ç¨‹å‘ç”Ÿåœ¨Monadçš„å†…éƒ¨ï¼Œå› æ­¤ <code>record</code> è¿™ä¸ªåŠ¨ä½œå¹¶ä¸è¿”å›ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ï¼ˆ <code>()</code> )</p><p>é€šå¸¸Monadä¼šæä¾›ä¸€äº›ç±»ä¼¼ <code>record</code> è¿™æ ·çš„è¾…åŠ©å‡½æ•°ï¼›è¿™äº›å‡½æ•°ä¹Ÿæ˜¯æˆ‘ä»¬è®¿é—®è¿™ä¸ªMonadæŸäº›ç‰¹å®šè¡Œä¸ºçš„æ–¹å¼ã€‚</p><p>æˆ‘ä»¬çš„æ¨¡å—ä¹ŸæŠŠ <code>Logger</code> å®šä¹‰ä¸ºäº† <code>Monad</code> çš„å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹é‡Œé¢çš„å®šä¹‰å°±æ˜¯ä½¿ç”¨ <code>Logger</code> ç±»å‹æ‰€éœ€è¦çš„å…¨éƒ¨ä¸œè¥¿ã€‚</p><p>ä¸‹é¢å°±æ˜¯ä½¿ç”¨æˆ‘ä»¬çš„ <code>Logger</code> ç±»çš„ä¸€ä¸ªä¾‹å­ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> <span class="token builtin class-name">let</span> simple <span class="token operator">=</span> <span class="token builtin class-name">return</span> True :: Logger Bool
ghci<span class="token operator">&gt;</span> runLogger simple
<span class="token punctuation">(</span>True,<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>runLogger</code> å‡½æ•°æ‰§è¡Œè¢«è®°å½•çš„æ“ä½œä¹‹åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªäºŒå…ƒç»„ã€‚äºŒå…ƒç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æˆ‘ä»¬ä»£ç çš„æ‰§è¡Œç»“æœï¼›ç¬¬äºŒä¸ªå…ƒç´ æ˜¯æˆ‘ä»¬çš„æ—¥å¿—åŠ¨ä½œæ‰§è¡Œçš„æ—¶å€™çºªå½•ä¿¡æ¯çš„åˆ—è¡¨ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰çºªå½•ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥è¿”å›çš„åˆ—è¡¨æ˜¯ç©ºï¼›æ¥ä¸ªæœ‰æ—¥å¿—ä¿¡æ¯çš„ä¾‹å­ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> runLogger <span class="token punctuation">(</span>record <span class="token string">&quot;hi mom!&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token builtin class-name">return</span> <span class="token number">3.1337</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3.1337</span>,<span class="token punctuation">[</span><span class="token string">&quot;hi mom!&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="using-the-logger-monad" tabindex="-1"><a class="header-anchor" href="#using-the-logger-monad"><span>ä½¿ç”¨ Logger monad</span></a></h3><p>åœ¨ <code>Logger</code> monadé‡Œé¢æˆ‘ä»¬å¯ä»¥å‰”é™¤é€šé…ç¬¦åˆ°æ­£åˆ™è¡¨è¾¾å¼çš„è½¬æ¢ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex</span> <span class="token hvariable">cs</span> <span class="token operator">=</span>
    <span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token char string">&#39;^&#39;</span><span class="token operator">:</span><span class="token hvariable">ds</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ä¸€äº›å€¼å¾—æ³¨æ„çš„ä»£ç é£æ ¼ã€‚æˆ‘ä»¬å‡½æ•°ä½“åœ¨å‡½æ•°åå­—ä¸‹é¢ä¸€è¡Œï¼Œè¦è¿™ä¹ˆåšï¼Œéœ€è¦æ·»åŠ ä¸€äº›æ°´å¹³çš„ç©ºæ ¼ï¼›å¯¹äºåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬æŠŠå®ƒçš„å‚æ•°æ”¾åœ¨å¦èµ·çš„ä¸€è¡Œï¼Œè¿™æ˜¯monadicä»£ç é€šå¸¸çš„ç»„ç»‡æ–¹å¼ã€‚</p><p>å›å¿†ä¸€ä¸‹ <code>(&gt;&gt;=)</code> çš„ç±»å‹ï¼šå®ƒä» <code>Logger</code> åŒ…è£…å™¨ä¸­ä¸­æå–å‡ºæ“ä½œç¬¦ <code>(&gt;&gt;=)</code> å·¦è¾¹çš„å€¼ï¼Œç„¶åæŠŠå–å‡ºæ¥çš„å€¼ä¼ é€’ç»™å³è¾¹çš„å‡½æ•°ã€‚å³è¾¹çš„æ“ä½œæ•°å‡½æ•°å¿…é¡»æŠŠè¿™ä¸ªå–å‡ºæ¥çš„å€¼ç”¨ <code>Logger</code> åŒ…è£…èµ·æ¥ç„¶åå›ä¼ å‡ºå»ã€‚è¿™ä¸ªæ“ä½œæ­£å¦‚æ­£å¦‚ <code>return</code> ä¸€æ ·ï¼šæ¥å—ä¸€ä¸ªçº¯å€¼ï¼Œç„¶åç”¨Monadçš„ç±»å‹æ„é€ å™¨åŒ…è£…ä¸€ä¸‹è¿”å›ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> m a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> m b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m b
ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span>globToRegex <span class="token string">&quot;&quot;</span> <span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span>globToRegex <span class="token string">&quot;&quot;</span> <span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>String -<span class="token operator">&gt;</span> Logger b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> Logger b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°±ç®—æˆ‘ä»¬å†™ä¸€ä¸ªä»€ä¹ˆéƒ½ä¸åšçš„å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»ä½¿ç”¨ <code>return</code> å»åŒ…è£…å…·æœ‰æ­£ç¡®ç±»å‹çš„å€¼ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token operator">::</span> <span class="token constant">String</span> <span class="token operator">-&gt;</span> <span class="token constant">Logger</span> <span class="token constant">String</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token string">&quot;&quot;</span> <span class="token operator">=</span> <span class="token builtin">return</span> <span class="token string">&quot;$&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬è¦ä½¿ç”¨ <code>record</code> å‡½æ•°çºªå½•æŸäº›æ—¥å¿—çš„æ—¶å€™ï¼Œæˆ‘ä»¬é‡‡ç”¨ <code>(&gt;&gt;)</code> è€Œä¸æ˜¯ <code>(&gt;&gt;=)</code> æ¥ä¸²è”ä¸€ç³»åˆ—çš„æ—¥å¿—æ“ä½œã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token char string">&#39;?&#39;</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">record</span> <span class="token string">&quot;any&quot;</span> <span class="token operator">&gt;&gt;</span>
    <span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token char string">&#39;.&#39;</span><span class="token operator">:</span><span class="token hvariable">ds</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>(&gt;&gt;)</code> å°±æ˜¯ <code>(&gt;&gt;=)</code> çš„ä¸€ä¸ªå˜ç§ï¼Œåªä¸è¿‡å®ƒä¼šå¿½ç•¥å·¦è¾¹æ“ä½œçš„ç»“æœï¼›ç”±äº <code>record</code> å‡½æ•°çš„è¿”å›å€¼æ°¸è¿œéƒ½æ˜¯ <code>()</code> å› æ­¤è·å–å®ƒçš„è¿”å›å€¼æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œç›´æ¥ä½¿ç”¨ <code>&gt;&gt;</code> æ›´ç®€æ´ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åœ¨ <code class="interpreted-text" role="ref">sequencing</code> å¼•å…¥çš„ <code>do</code> è¡¨ç¤ºæ³•æ¥æ•´ç†ä»£ç ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token char string">&#39;*&#39;</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token hvariable">record</span> <span class="token string">&quot;kleene star&quot;</span>
    <span class="token hvariable">ds</span> <span class="token operator">&lt;-</span> <span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token string">&quot;.*&quot;</span> <span class="token operator">++</span> <span class="token hvariable">ds</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€‰æ‹©ä½¿ç”¨ <code>do</code> è¡¨ç¤ºæ³•è¿˜æ˜¯æ˜¾å¼ä½¿ç”¨ <code>(&gt;&gt;=)</code> ç»“åˆåŒ¿åå‡½æ•°å®Œå…¨å–å†³äºä¸ªäººçˆ±å¥½ï¼Œä½†æ˜¯å¯¹äºé•¿åº¦è¶…è¿‡ä¸¤è¡Œçš„ä»£ç æ¥è¯´ï¼Œå‡ ä¹æ‰€æœ‰äººéƒ½ä¼šé€‰æ‹©ä½¿ç”¨ <code>do</code>. è¿™ä¸¤ç§é£æ ¼æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ <code class="interpreted-text" role="ref">desugaring-of-do-blocks</code> é‡Œé¢ä»‹ç»ã€‚</p><p>å¯¹äºè§£æå•ä¸ªå­—ç¬¦çš„æƒ…å†µï¼Œmonadicçš„ä»£ç å‡ ä¹å’Œæ™®é€šçš„ä¸€æ ·ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token char string">&#39;[&#39;</span><span class="token operator">:</span><span class="token char string">&#39;!&#39;</span><span class="token operator">:</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">record</span> <span class="token string">&quot;character class, negative&quot;</span> <span class="token operator">&gt;&gt;</span>
    <span class="token hvariable">charClass</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token string">&quot;[^&quot;</span> <span class="token operator">++</span> <span class="token hvariable">c</span> <span class="token operator">:</span> <span class="token hvariable">ds</span><span class="token punctuation">)</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token char string">&#39;[&#39;</span><span class="token operator">:</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">record</span> <span class="token string">&quot;character class&quot;</span> <span class="token operator">&gt;&gt;</span>
    <span class="token hvariable">charClass</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token string">&quot;[&quot;</span> <span class="token operator">++</span> <span class="token hvariable">c</span> <span class="token operator">:</span> <span class="token hvariable">ds</span><span class="token punctuation">)</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token char string">&#39;[&#39;</span><span class="token operator">:</span><span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token builtin">fail</span> <span class="token string">&quot;unterminated character class&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mixing-pure-and-monadic-code" tabindex="-1"><a class="header-anchor" href="#mixing-pure-and-monadic-code"><span>åŒæ—¶ä½¿ç”¨puerå’Œmonadicä»£ç </span></a></h2><p>è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„Monadå¥½åƒæœ‰ä¸€ä¸ªéå¸¸æ˜æ˜¾çš„ç¼ºé™·ï¼šMonadçš„ç±»å‹æ„é€ å™¨æŠŠä¸€ä¸ªå€¼åŒ…è£…æˆä¸€ä¸ªmonadicçš„å€¼ï¼Œè¿™æ ·å¯¼è‡´åœ¨monadé‡Œé¢ä½¿ç”¨æ™®é€šçš„çº¯å‡½æ•°æœ‰ç‚¹å›°éš¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€æ®µè¿è¡Œåœ¨monadé‡Œé¢çš„ä»£ç ï¼Œå®ƒæ‰€åšçš„å°±æ˜¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> <span class="token builtin class-name">let</span> m <span class="token operator">=</span> <span class="token builtin class-name">return</span> <span class="token string">&quot;foo&quot;</span> :: Logger String
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ <code>length</code> å‡½æ•°ï¼šå› ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²è¢« <code>Logger</code> è¿™ä¸ªmonadåŒ…è£…èµ·æ¥äº†ï¼Œå› æ­¤ç±»å‹å¹¶ä¸åŒ¹é…ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> length m

<span class="token operator">&lt;</span>interactive<span class="token operator">&gt;</span>:1:7:
    Couldn<span class="token string">&#39;t match expected type `[a]&#39;</span>
           against inferred <span class="token builtin class-name">type</span> <span class="token variable"><span class="token variable">`</span>Logger String&#39;
    In the first argument of <span class="token variable">`</span></span>length<span class="token string">&#39;, namely `m&#39;</span>
    In the expression: length m
    In the definition of `it&#39;: it <span class="token operator">=</span> length m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬èƒ½åšçš„äº‹æƒ…å°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type   m <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token punctuation">\</span>s -<span class="token operator">&gt;</span> <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>length s<span class="token punctuation">)</span>
m <span class="token operator">&gt;&gt;</span><span class="token operator">=</span> <span class="token punctuation">\</span>s -<span class="token operator">&gt;</span> <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>length s<span class="token punctuation">)</span> :: Logger Int
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä½¿ç”¨ <code>(&gt;&gt;=)</code> æŠŠå­—ç¬¦ä¸²ä»monadé‡Œé¢å–å‡ºæ¥ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°è°ƒç”¨ <code>length</code> æ¥ç€ç”¨ <code>return</code> æŠŠè¿™ä¸ªå­—ç¬¦ä¸²é‡æ–°åŒ…è£…æˆ <code>Logger</code> ã€‚</p><p>ç”±äºè¿™ç§å½¢å¼çš„ä»£ç ç»å¸¸åœ¨Haskellé‡Œé¢å‡ºç°ï¼Œå› æ­¤å·²ç»æœ‰ä¸€ä¸ªç±»ä¼¼çš„æ“ä½œç¬¦å­˜åœ¨äº†ã€‚åœ¨ <code class="interpreted-text" role="ref">introducing-functors</code> é‡Œé¢æˆ‘ä»¬ä»‹ç»äº† <em>lifting</em> è¿™ç§æŠ€æœ¯ï¼›æŠŠä¸€ä¸ªçº¯å‡½æ•° Lift ä¸ºä¸€ä¸ªå‡½å­é€šå¸¸æ„å‘³ç€ä»ä¸€ä¸ªå¸¦æœ‰ä¸Šä¸‹æ–‡çš„ç‰¹æ®Šå€¼é‡Œé¢å–å‡ºé‚£ä¸ªå€¼ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ™®é€šçš„å€¼è°ƒç”¨çº¯å‡½æ•°ï¼Œå¾—åˆ°ç»“æœä¹‹åç”¨ç‰¹å®šçš„ç±»å‹æ„é€ å™¨åŒ…è£…æˆåŸæ¥æœ‰ç€ä¸Šä¸‹æ–‡çš„ç‰¹æ®Šå€¼ã€‚</p><p>åœ¨monadé‡Œé¢ï¼Œæˆ‘ä»¬éœ€è¦å¹²åŒæ ·çš„ä¸€ä»¶äº‹ã€‚ç”±äº <code>Monad</code> è¿™ä¸ªç±»å‹ç±»å·²ç»æä¾›äº† <code>(&gt;&gt;=)</code> å’Œ <code>return</code> è¿™ä¸¤ä¸ªå‡½æ•°å¤„ç†monadicçš„å€¼å’Œæ™®é€šå€¼ä¹‹é—´çš„è½¬æ¢ï¼Œå› æ­¤ <code>liftM</code> å‡½æ•°ä¸éœ€è¦çŸ¥é“monadçš„ä»»ä½•å®ç°ç»†èŠ‚ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">liftM</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Monad</span> <span class="token hvariable">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span>
<span class="token hvariable">liftM</span> <span class="token hvariable">f</span> <span class="token hvariable">m</span> <span class="token operator">=</span> <span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">i</span> <span class="token operator">-&gt;</span>
            <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token hvariable">i</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬æŠŠä¸€ä¸ªç±»å‹å£°æ˜ä¸º <code>Functor</code> è¿™ä¸ªç±»å‹ç±»çš„å®ä¾‹ä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»æ ¹æ®è¿™ä¸ªç‰¹å®šçš„ç±»å‹å®ç°å¯¹åº”çš„ <code>fmap</code> å‡½æ•°ï¼›ä½†æ˜¯ï¼Œ ç”±äº <code>(&gt;&gt;=)</code> å’Œ <code>return</code> å¯¹monadçš„è¿›è¡Œäº†æŠ½è±¡ï¼Œå› æ­¤<code>liftM</code> ä¸éœ€è¦çŸ¥é“ä»»ä½•monadçš„ä»»ä½•å®ç°ç»†èŠ‚ã€‚æˆ‘ä»¬åªéœ€è¦å®ç°ä¸€æ¬¡å¹¶é…ä¸Šåˆé€‚çš„ç±»å‹ç­¾åå³å¯ã€‚</p><p>åœ¨æ ‡å‡†åº“çš„ <code>Control.Monad</code> æ¨¡å—é‡Œé¢å·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰å¥½äº† <code>liftM</code> å‡½æ•°ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹ä½¿ç”¨ <code>liftM</code> å¯¹äºæå‡æˆ‘ä»¬ä»£ç å¯è¯»æ€§æœ‰ä»€ä¹ˆä½œç”¨ï¼›å…ˆçœ‹çœ‹æ²¡æœ‰ä½¿ç”¨ <code>liftM</code> çš„ä»£ç ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">charClass_wordy</span> <span class="token punctuation">(</span><span class="token char string">&#39;]&#39;</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token char string">&#39;]&#39;</span><span class="token operator">:</span><span class="token hvariable">ds</span><span class="token punctuation">)</span>
<span class="token hvariable">charClass_wordy</span> <span class="token punctuation">(</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
    <span class="token hvariable">charClass_wordy</span> <span class="token hvariable">cs</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">ds</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">ds</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬ç”¨ <code>liftM</code> å»æ‰é‚£äº› <code>(&gt;&gt;=))</code> å’ŒåŒ¿åå‡½æ•°ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">charClass</span> <span class="token punctuation">(</span><span class="token char string">&#39;]&#39;</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token char string">&#39;]&#39;</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">`liftM`</span> <span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span>
<span class="token hvariable">charClass</span> <span class="token punctuation">(</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token punctuation">)</span> <span class="token operator">`liftM`</span> <span class="token hvariable">charClass</span> <span class="token hvariable">cs</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£å¦‚ <code>fmap</code> ä¸€æ ·ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ä¸­ç¼€çš„æ–¹å¼è°ƒç”¨ <code>liftM</code> ã€‚å¯ä»¥ç”¨è¿™ç§æ–¹å¼æ¥é˜…è¯»è¿™ä¸ªè¡¨è¾¾å¼ï¼šæŠŠå³è¾¹æ“ä½œå¾—åˆ°çš„monadicçš„å€¼åº”ç”¨åˆ°å·¦è¾¹çš„çº¯å‡½æ•°ä¸Šã€‚</p><p><code>liftM</code> å‡½æ•°å®åœ¨æ˜¯å¤ªæœ‰ç”¨äº†ï¼Œå› æ­¤ <code>Control.Monad</code> å®šä¹‰äº†å®ƒçš„å‡ ä¸ªå˜ç§ï¼Œè¿™äº›å˜ç§å¯ä»¥å¤„ç†æ›´é•¿çš„å‚æ•°ï¼›æˆ‘ä»¬å¯ä»¥çœ‹ä¸€çœ‹ <code>globToRegex</code> è¿™ä¸ªå‡½æ•°çš„æœ€åä¸€ä¸ªåˆ†å¥ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">globToRegex&#39;</span> <span class="token punctuation">(</span><span class="token hvariable">c</span><span class="token operator">:</span><span class="token hvariable">cs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">liftM2</span> <span class="token punctuation">(</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">escape</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">globToRegex&#39;</span> <span class="token hvariable">cs</span><span class="token punctuation">)</span>

<span class="token hvariable">escape</span> <span class="token operator">::</span> <span class="token constant">Char</span> <span class="token operator">-&gt;</span> <span class="token constant">Logger</span> <span class="token constant">String</span>
<span class="token hvariable">escape</span> <span class="token hvariable">c</span>
    <span class="token operator">|</span> <span class="token hvariable">c</span> <span class="token operator">`elem`</span> <span class="token hvariable">regexChars</span> <span class="token operator">=</span> <span class="token hvariable">record</span> <span class="token string">&quot;escape&quot;</span> <span class="token operator">&gt;&gt;</span> <span class="token builtin">return</span> <span class="token punctuation">[</span><span class="token char string">&#39;\\&#39;</span><span class="token punctuation">,</span><span class="token hvariable">c</span><span class="token punctuation">]</span>
    <span class="token operator">|</span> <span class="token builtin">otherwise</span>           <span class="token operator">=</span> <span class="token builtin">return</span> <span class="token punctuation">[</span><span class="token hvariable">c</span><span class="token punctuation">]</span>
  <span class="token keyword">where</span> <span class="token hvariable">regexChars</span> <span class="token operator">=</span> <span class="token string">&quot;\\+()^$.{}]|&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢è¿™æ®µä»£ç ç”¨åˆ°çš„ <code>liftM2</code> å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">liftM2</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Monad</span> <span class="token hvariable">m</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">c</span>
<span class="token hvariable">liftM2</span> <span class="token hvariable">f</span> <span class="token hvariable">m1</span> <span class="token hvariable">m2</span> <span class="token operator">=</span>
    <span class="token hvariable">m1</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span>
    <span class="token hvariable">m2</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">b</span> <span class="token operator">-&gt;</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token hvariable">a</span> <span class="token hvariable">b</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒé¦–å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œæ¥ç€æ‰§è¡Œç¬¬äºŒä¸ªæ“ä½œï¼Œç„¶åæŠŠè¿™ä¸¤ä¸ªæ“ä½œçš„ç»“æœç»„åˆèµ·æ¥åº”ç”¨åˆ°é‚£ä¸ªçº¯å‡½æ•°ä¸Šå¹¶åŒ…è£…è¿”å›çš„ç»“æœã€‚<code>Control.Monad</code> é‡Œé¢å®šä¹‰äº† <code>liftM</code> <code>liftM2</code> ç›´åˆ° <code>liftM5</code> ã€‚</p><h2 id="putting-a-few-misconceptions-to-rest" tabindex="-1"><a class="header-anchor" href="#putting-a-few-misconceptions-to-rest"><span>å…³äºMonadçš„ä¸€äº›è¯¯è§£</span></a></h2><p>æˆ‘ä»¬å·²ç»è§è¯†è¿‡å¾ˆå¤šMonadçš„ä¾‹å­å¹¶ä¸”å¯¹monadä¹Ÿæœ‰ä¸€äº›æ„Ÿè§‰äº†ï¼›åœ¨ç»§ç»­æ¢è®¨monadä¹‹å‰ï¼Œæœ‰ä¸€äº›å¹¿ä¸ºæµä¼ çš„å…³äºmonadçš„è§‚å¿µéœ€è¦æ¾„æ¸…ã€‚ä½ è‚¯å®šç»å¸¸å¬åˆ°è¿™äº›è¯´æ³•ï¼Œå› æ­¤ä½ å¯èƒ½å·²ç»æœ‰ä¸€äº›å¾ˆå¥½çš„ç†ç”±æ¥åé©³è¿™äº›è°¬è®ºäº†ã€‚</p><ul><li><em>Monadså¾ˆéš¾ç†è§£</em> æˆ‘ä»¬å·²ç»ä»å¥½å‡ ä¸ªå®ä¾‹çš„é—®é¢˜æ¥è¯´æ˜Monadæ˜¯å¦‚ä½•å·¥ä½œçš„äº†ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»çŸ¥é“ç†è§£monadæœ€å¥½çš„æ–¹å¼å°±æ˜¯å…ˆé€šè¿‡ä¸€äº›å…·ä½“çš„ä¾‹å­æ¥è¿›è¡Œè§£é‡Šï¼Œç„¶åæŠ½è±¡å‡ºè¿™äº›è¿™äº›ä¾‹å­å…±åŒçš„ä¸œè¥¿ã€‚</li><li><em>Monadsä»…ä»…ç”¨äº I/O æ“ä½œå’Œå‘½ä»¤å¼ä»£ç </em> è™½ç„¶æˆ‘ä»¬åœ¨Haskellçš„IOé‡Œé¢ä½¿ç”¨Monadï¼Œä½†æ˜¯Monadåœ¨å…¶ä»–çš„åœ°æ–¹ä¹Ÿéå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å·²ç»é€šè¿‡monadä¸²è”ç®€å•çš„è®¡ç®—ï¼Œéšè—å¤æ‚çš„çŠ¶æ€ä»¥åŠçºªå½•æ—¥å¿—äº†ï¼›ç„¶è€Œï¼ŒMonadçš„ä½œç”¨æˆ‘ä»¬è¿˜åªçœ‹åˆ°å†°å±±ä¸€è§’ã€‚</li><li><em>åªæœ‰Haskellæ‰æœ‰Monad</em> Haskellæœ‰å¯èƒ½æ˜¯æ˜¾å¼ä½¿ç”¨Monadæœ€å¤šçš„è¯­è¨€ï¼Œä½†æ˜¯åœ¨åˆ«çš„è¯­è¨€é‡Œé¢ä¹Ÿå­˜åœ¨ï¼Œä»C++åˆ°OCamlã€‚ç”±äºHaskellçš„ <code>do</code> è¡¨ç¤ºæ³•ï¼Œå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿä»¥åŠè¯­è¨€çš„è¯­æ³•ä½¿å¾—Monadåœ¨Haskellé‡Œé¢éå¸¸å®¹æ˜“å¤„ç†ã€‚</li><li><em>Monadsä½¿ç”¨æ¥æ§åˆ¶æ±‚å€¼é¡ºåºçš„</em></li></ul><h2 id="building-the-logger-monad" tabindex="-1"><a class="header-anchor" href="#building-the-logger-monad"><span>åˆ›å»ºLogger Monad</span></a></h2><p><code>Logger</code> ç±»çš„å®šä¹‰éå¸¸ç®€å•ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token keyword">newtype</span> <span class="token constant">Logger</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Logger</span> <span class="token punctuation">{</span> <span class="token hvariable">execLogger</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token constant">Log</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ‰§è¡ŒåŠ¨ä½œçš„ç»“æœï¼Œç¬¬äºŒå…ƒç´ æ˜¯æˆ‘ä»¬æ‰§è¡ŒåŠ¨ä½œçš„æ—¶å€™çºªå½•çš„æ—¥å¿—ä¿¡æ¯åˆ—è¡¨ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ <code>newtype</code> å…³é”®å­—æŠŠäºŒå…ƒç»„è¿›è¡Œäº†åŒ…è£…ä½¿å®ƒçš„ç±»å‹æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚<code>runLogger</code> å‡½æ•°å¯ä»¥ä»è¿™ä¸ªMonadé‡Œé¢å–å‡ºè¿™ä¸ªå…ƒç»„é‡Œé¢çš„å€¼ï¼›è¿™ä¸ªå‡½æ•°å…¶å®æ˜¯ <code>execLogger</code> çš„ä¸€ä¸ªåˆ«åã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">runLogger</span> <span class="token operator">=</span> <span class="token hvariable">execLogger</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>record</code> è¿™ä¸ªå‡½æ•°å°†ä¸ºæ¥æ”¶åˆ°çš„æ—¥å¿—ä¿¡æ¯åˆ›å»ºä¸€ä¸ªåªåŒ…å«å•ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token hvariable">record</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token constant">Logger</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token hvariable">s</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªåŠ¨ä½œçš„ç»“æœæ˜¯ <code>()</code> ã€‚</p><p>è®©æˆ‘ä»¬ä»¥ <code>return</code> å¼€å§‹ï¼Œæ„å»º <code>Monad</code> å®ä¾‹ï¼›å…ˆå°è¯•ä¸€ä¸‹ï¼šå®ƒä»€ä¹ˆéƒ½ä¸è®°å½•ï¼Œç„¶åæŠŠç»“æœå­˜æ”¾åœ¨äºŒå…ƒç»„é‡Œé¢ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
<span class="token keyword">instance</span> <span class="token constant">Monad</span> <span class="token constant">Logger</span> <span class="token keyword">where</span>
    <span class="token builtin">return</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Logger</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>(&gt;&gt;=)</code> çš„å®šä¹‰æ›´æœ‰è¶£ï¼Œå½“ç„¶å®ƒä¹Ÿæ˜¯monadçš„æ ¸å¿ƒã€‚ <code>(&gt;&gt;=)</code> æŠŠä¸€ä¸ªæ™®é€šçš„å€¼å’Œä¸€ä¸ªmonadicçš„å‡½æ•°ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°æ–°çš„è¿ç®—ç»“æœå’Œä¸€ä¸ªæ–°çš„æ—¥å¿—ä¿¡æ¯ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Logger.hs</span>
    <span class="token comment">-- (&gt;&gt;=) :: Logger a -&gt; (a -&gt; Logger b) -&gt; Logger b</span>
    <span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">k</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">w</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">execLogger</span> <span class="token hvariable">m</span>
                  <span class="token hvariable">n</span>      <span class="token operator">=</span> <span class="token hvariable">k</span> <span class="token hvariable">a</span>
                  <span class="token punctuation">(</span><span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">execLogger</span> <span class="token hvariable">n</span>
              <span class="token keyword">in</span> <span class="token constant">Logger</span> <span class="token punctuation">(</span><span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token hvariable">w</span> <span class="token operator">++</span> <span class="token hvariable">x</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çœ‹çœ‹è¿™æ®µä»£ç é‡Œé¢å‘ç”Ÿäº†ä»€ä¹ˆã€‚é¦–å…ˆä½¿ç”¨ <code>runLogger</code> å‡½æ•°ä»åŠ¨ä½œ <code>m</code> å–å‡ºç»“æœ <code>a</code> ,ç„¶åæŠŠå®ƒä¼ é€’ç»™monadicå‡½æ•° <code>k</code>; æ¥ç€æˆ‘ä»¬åˆå–å‡º <code>b</code> ï¼›æœ€åæŠŠ <code>w</code> å’Œ <code>x</code> æ‹¼æ¥å¾—åˆ°ä¸€ä¸ªæ–°çš„æ—¥å¿—ã€‚</p><h3 id="sequential-logging-not-sequential-evaluation" tabindex="-1"><a class="header-anchor" href="#sequential-logging-not-sequential-evaluation"><span>é¡ºåºçš„æ—¥å¿—ï¼Œè€Œä¸æ˜¯é¡ºåºçš„æ±‚å€¼</span></a></h3><p>æˆ‘ä»¬å®šä¹‰çš„ <code>(&gt;&gt;=)</code> ä¿è¯äº†æ–°è¾“å‡ºçš„æ—¥å¿—ä¸€å®šåœ¨ä¹‹å‰çš„è¾“å‡ºçš„æ—¥å¿—ä¹‹åã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€ <code>a</code> å’Œ <code>b</code> çš„æ±‚å€¼æ˜¯é¡ºåºçš„ï¼š<code>(&gt;&gt;=)</code> æ“ä½œç¬¦æ˜¯æƒ°æ€§æ±‚å€¼çš„ã€‚</p><p>æ­£å¦‚Monadçš„å¾ˆå¤šå…¶ä»–è¡Œä¸ºä¸€æ ·ï¼Œæ±‚å€¼çš„ä¸¥æ ¼æ€§æ˜¯ç”±Monadçš„å®ç°è€…æ§åˆ¶çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰Monadçš„å…±åŒæ€§è´¨ã€‚äº‹å®ä¸Šï¼Œæœ‰ä¸€äº›MonadåŒæ—¶æœ‰å‡ ç§ç‰¹æ€§ï¼Œæ¯ä¸€ç§éƒ½æœ‰ç€ä¸åŒç¨‹åº¦çš„ä¸¥æ ¼æ€§ï¼ˆæ±‚å€¼ï¼‰ã€‚</p><h3 id="the-writer-monad" tabindex="-1"><a class="header-anchor" href="#the-writer-monad"><span>Writer monad</span></a></h3><p>æˆ‘ä»¬åˆ›å»ºçš„ <code>Logger</code> monadå®é™…ä¸Šæ˜¯æ ‡å‡†åº“é‡Œé¢ <code>Writer</code> Monadçš„ä¸€ä¸ªç‰¹ä¾‹ï¼›<code>Writer</code> Monadå¯ä»¥åœ¨ <code>mtl</code> åŒ…é‡Œé¢çš„ <code>Control.Monad.Writer</code> æ¨¡å—æ‰¾åˆ°ã€‚æˆ‘ä»¬ä¼šåœ¨ <code class="interpreted-text" role="ref">using-typeclasses</code> é‡Œé¢ä»‹ç» <code>Writer</code> çš„ç”¨æ³•ã€‚</p><h2 id="the-maybe-monad" tabindex="-1"><a class="header-anchor" href="#the-maybe-monad"><span>Maybe monad</span></a></h2><p><code>Maybe</code> åº”è¯¥æ˜¯æœ€ç®€å•çš„Monadäº†ã€‚å®ƒä»£è¡¨äº†ä¸€ç§å¯èƒ½ä¸ä¼šäº§ç”Ÿè®¡ç®—ç»“æœçš„è®¡ç®—è¿‡ç¨‹ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token keyword">instance</span> <span class="token constant">Monad</span> <span class="token constant">Maybe</span> <span class="token keyword">where</span>
    <span class="token constant">Just</span> <span class="token hvariable">x</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">k</span>  <span class="token operator">=</span>  <span class="token hvariable">k</span> <span class="token hvariable">x</span>
    <span class="token constant">Nothing</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">_</span> <span class="token operator">=</span>  <span class="token constant">Nothing</span>

    <span class="token constant">Just</span> <span class="token hvariable">_</span> <span class="token operator">&gt;&gt;</span> <span class="token hvariable">k</span>   <span class="token operator">=</span>  <span class="token hvariable">k</span>
    <span class="token constant">Nothing</span> <span class="token operator">&gt;&gt;</span> <span class="token hvariable">_</span>  <span class="token operator">=</span>  <span class="token constant">Nothing</span>

    <span class="token builtin">return</span> <span class="token hvariable">x</span>      <span class="token operator">=</span>  <span class="token constant">Just</span> <span class="token hvariable">x</span>

    <span class="token builtin">fail</span> <span class="token hvariable">_</span>        <span class="token operator">=</span>  <span class="token constant">Nothing</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>(&gt;&gt;=)</code> æˆ–è€… <code>(&gt;&gt;)</code> ä¸²è”ä¸€äº› <code>Maybe</code> è®¡ç®—çš„æ—¶å€™ï¼Œå¦‚æœè¿™äº›è®¡ç®—ä¸­çš„ä»»ä½•ä¸€ä¸ªè¿”å›äº† <code>Nothing</code> ï¼Œ <code>(&gt;&gt;=)</code> å’Œ <code>(&gt;&gt;)</code> å°±ä¸ä¼šå¯¹ä½™ä¸‹çš„ä»»ä½•è®¡ç®—è¿›è¡Œæ±‚å€¼ã€‚</p><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ•´ä¸ªè°ƒç”¨é“¾å¹¶ä¸æ˜¯å®Œå…¨çŸ­è·¯çš„ã€‚æ¯ä¸€ä¸ª <code>(&gt;&gt;=)</code> æˆ–è€… <code>(&gt;&gt;)</code> ä»ç„¶ä¼šåŒ¹é…å®ƒå·¦è¾¹çš„ <code>Nothing</code> ç„¶åç»™å³è¾¹çš„å‡½æ•°ä¸€ä¸ª <code>Nothing</code> ï¼Œç›´åˆ°è¾¾åˆ°è°ƒç”¨é“¾çš„æœ«ç«¯ã€‚è¿™ä¸€ç‚¹å¾ˆå®¹æ˜“è¢«é—å¿˜ï¼šå½“è°ƒç”¨é“¾ä¸­æŸä¸ªè®¡ç®—å¤±è´¥çš„æ—¶å€™ï¼Œä¹‹å‰è®¡ç®—çš„ç»“æœï¼Œä½™ä¸‹çš„è°ƒç”¨é“¾ä»¥åŠä½¿ç”¨çš„ <code>Nothing</code> å€¼åœ¨è¿è¡Œæ—¶çš„å¼€é”€æ˜¯å»‰ä»·çš„ï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨æ²¡æœ‰å¼€é”€ã€‚</p><h3 id="executing-the-maybe-monad" tabindex="-1"><a class="header-anchor" href="#executing-the-maybe-monad"><span>æ‰§è¡ŒMaybe monad</span></a></h3><p>é€‚åˆæ‰§è¡Œ <code>Maybe</code> Monadçš„å‡½æ•°æ˜¯ <code>maybe</code> ï¼ˆ&quot;æ‰§è¡Œ&quot;ä¸€ä¸ªmonadæ„å‘³ç€å–å‡ºMonadé‡Œé¢åŒ…å«çš„å€¼ï¼Œç§»é™¤Monadç±»çš„åŒ…è£…ï¼‰</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Maybe.hs</span>
<span class="token builtin">maybe</span> <span class="token operator">::</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span>
<span class="token builtin">maybe</span> <span class="token hvariable">n</span> <span class="token hvariable">_</span> <span class="token constant">Nothing</span>  <span class="token operator">=</span> <span class="token hvariable">n</span>
<span class="token builtin">maybe</span> <span class="token hvariable">_</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token constant">Just</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ <code>Nothing</code> ï¼Œ <code>maybe</code> å°†ä½¿ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºè¿”å›å€¼ï¼›è€Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯åœ¨ <code>Just</code> å€¼æ„é€ å™¨é‡Œé¢è¿›è¡ŒåŒ…è£…å€¼çš„å‡½æ•°ã€‚</p><p>ç”±äº <code>Maybe</code> ç±»å‹éå¸¸ç®€å•ï¼Œç›´æ¥å¯¹å®ƒè¿›è¡Œæ¨¡å¼åŒ¹é…å’Œè°ƒç”¨ <code>maybe</code> å‡½æ•°ä½¿ç”¨èµ·æ¥å·®ä¸å¤šï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œä¸¤ç§æ–¹å¼éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹ã€‚</p><h3 id="maybe-at-work-and-good-api-design" tabindex="-1"><a class="header-anchor" href="#maybe-at-work-and-good-api-design"><span>ä½¿ç”¨Maybeï¼Œä»¥åŠå¥½çš„APIè®¾è®¡æ–¹å¼</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Maybe</code> çš„ä¾‹å­ã€‚ç»™å‡ºä¸€ä¸ªé¡¾å®¢çš„åå­—ï¼Œæ‰¾å‡ºå®ƒä»¬æ‰‹æœºå·å¯¹åº”çš„è´¦å•åœ°å€ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Carrier.hs</span>
<span class="token import-statement"><span class="token keyword">import</span> <span class="token keyword">qualified</span> Data<span class="token punctuation">.</span>Map <span class="token keyword">as</span> M</span>

<span class="token keyword">type</span> <span class="token constant">PersonName</span> <span class="token operator">=</span> <span class="token constant">String</span>
<span class="token keyword">type</span> <span class="token constant">PhoneNumber</span> <span class="token operator">=</span> <span class="token constant">String</span>
<span class="token keyword">type</span> <span class="token constant">BillingAddress</span> <span class="token operator">=</span> <span class="token constant">String</span>
<span class="token keyword">data</span> <span class="token constant">MobileCarrier</span> <span class="token operator">=</span> <span class="token constant">Honest_Bobs_Phone_Network</span>
                   <span class="token operator">|</span> <span class="token constant">Morrisas_Marvelous_Mobiles</span>
                   <span class="token operator">|</span> <span class="token constant">Petes_Plutocratic_Phones</span>
                     <span class="token keyword">deriving</span> <span class="token punctuation">(</span><span class="token constant">Eq</span><span class="token punctuation">,</span> <span class="token constant">Ord</span><span class="token punctuation">)</span>

<span class="token hvariable">findCarrierBillingAddress</span> <span class="token operator">::</span> <span class="token constant">PersonName</span>
                          <span class="token operator">-&gt;</span> <span class="token constant">M<span class="token punctuation">.</span>Map</span> <span class="token constant">PersonName</span> <span class="token constant">PhoneNumber</span>
                          <span class="token operator">-&gt;</span> <span class="token constant">M<span class="token punctuation">.</span>Map</span> <span class="token constant">PhoneNumber</span> <span class="token constant">MobileCarrier</span>
                          <span class="token operator">-&gt;</span> <span class="token constant">M<span class="token punctuation">.</span>Map</span> <span class="token constant">MobileCarrier</span> <span class="token constant">BillingAddress</span>
                          <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token constant">BillingAddress</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå®ç°ä½¿ç”¨ <code>case</code> è¡¨è¾¾å¼ï¼Œç”¨å®ƒå®Œæˆçš„ä»£ç ç›¸å½“éš¾çœ‹ï¼Œå·®ä¸å¤šè¶…å‡ºäº†å±å¹•çš„å³è¾¹ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Carrier.hs</span>
<span class="token hvariable">variation1</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span> <span class="token hvariable">carrierMap</span> <span class="token hvariable">addressMap</span> <span class="token operator">=</span>
    <span class="token keyword">case</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span> <span class="token keyword">of</span>
      <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
      <span class="token constant">Just</span> <span class="token hvariable">number</span> <span class="token operator">-&gt;</span>
          <span class="token keyword">case</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">number</span> <span class="token hvariable">carrierMap</span> <span class="token keyword">of</span>
            <span class="token constant">Nothing</span> <span class="token operator">-&gt;</span> <span class="token constant">Nothing</span>
            <span class="token constant">Just</span> <span class="token hvariable">carrier</span> <span class="token operator">-&gt;</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">carrier</span> <span class="token hvariable">addressMap</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¨¡å— <code>Data.Map</code> çš„å‡½æ•° <code>lookup</code> è¿”å›ä¸€ä¸ª monadicçš„å€¼ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :module +Data.Map
ghci<span class="token operator">&gt;</span> :type Data.Map.lookup
Data.Map.lookup :: <span class="token punctuation">(</span>Ord k, Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> k -<span class="token operator">&gt;</span> Map k a -<span class="token operator">&gt;</span> m a
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœç»™å®šçš„keyåœ¨mapé‡Œé¢å­˜åœ¨ï¼Œé‚£ä¹ˆ <code>lookup</code> å‡½æ•°ä½¿ç”¨ <code>return</code> æŠŠè¿™ä¸ªå€¼æ³¨å…¥åˆ°monadé‡Œé¢å»ï¼›å¦åˆ™å°±ä¼šè°ƒç”¨ <code>fail</code> å‡½æ•°ã€‚è¿™æ˜¯è¿™ä¸ªAPIä¸€ä¸ªæœ‰è¶£çš„å®ç°ï¼Œè™½ç„¶æœ‰äººè§‰å¾—å®ƒå¾ˆç³Ÿç³•ã€‚</p><ul><li>è¿™æ ·è®¾è®¡å¥½çš„ä¸€æ–¹å¼æ˜¯ï¼Œæ ¹æ®å…·ä½“Monadå®ç°çš„ä¸åŒï¼ŒæŸ¥æ‰¾æˆåŠŸå’Œå¤±è´¥çš„ç»“æœæ˜¯å¯ä»¥æ ¹æ®ä¸åŒéœ€æ±‚å®šåˆ¶çš„ï¼›è€Œä¸”ï¼Œ <code>lookup</code> å‡½æ•°æœ¬èº«å¯¹äºå…·ä½“çš„è¿™äº›è¡Œä¸ºå®Œå…¨ä¸ç”¨å…³å¿ƒã€‚</li><li>åå¤„å°±æ˜¯ï¼Œåœ¨æœ‰äº›Monadé‡Œé¢è°ƒç”¨ <code>fail</code> ä¼šç›´æ¥æŠ›å‡ºè®©äººæ¼ç«çš„å¼‚å¸¸ï¼›ä¹‹å‰æˆ‘ä»¬å°±è­¦å‘Šè¿‡æœ€å¥½ä¸è¦ä½¿ç”¨ <code>fail</code> å‡½æ•°ï¼Œè¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚</li></ul><p>å®é™…ä¸Šï¼Œæ¯ä¸ªäººéƒ½ä½¿ç”¨ <code>Maybe</code> ç±»å‹ä½œä¸º <code>lookup</code> å‡½æ•°çš„è¿”å›ç»“æœï¼›è¿™æ ·ä¸€ä¸ªç®€å•çš„å‡½æ•°å¯¹äºå®ƒçš„è¿”å›ç»“æœæä¾›äº†å®ƒå¹¶ä¸éœ€è¦çš„é€šç”¨æ€§ï¼šå…¶å® <code>lookup</code> åº”è¯¥ç›´æ¥è¿”å› <code>Maybe</code> ã€‚</p><p>å…ˆæ”¾ä¸‹APIè®¾è®¡çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥å¤„ç†ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰ç”¨ <code>case</code> ç¼–å†™çš„ä¸‘é™‹ä»£ç ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Carrier.hs</span>
<span class="token hvariable">variation2</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span> <span class="token hvariable">carrierMap</span> <span class="token hvariable">addressMap</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">number</span> <span class="token operator">&lt;-</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span>
  <span class="token hvariable">carrier</span> <span class="token operator">&lt;-</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">number</span> <span class="token hvariable">carrierMap</span>
  <span class="token hvariable">address</span> <span class="token operator">&lt;-</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">carrier</span> <span class="token hvariable">addressMap</span>
  <span class="token builtin">return</span> <span class="token hvariable">address</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¿™å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæŸ¥æ‰¾å¤±è´¥ï¼Œ <code>(&gt;&gt;=)</code> å’Œ <code>(&gt;&gt;)</code> çš„å®šä¹‰å‘Šè¯‰æˆ‘ä»¬æ•´ä¸ªè¿ç®—çš„ç»“æœå°†ä¼šæ˜¯ <code>Nothing</code>; å°±å’Œæˆ‘ä»¬æ˜¾å¼ä½¿ç”¨ <code>case</code> è¡¨è¾¾å¼ç»“æœä¸€æ ·ã€‚</p><p>ä½¿ç”¨Monadçš„ç‰ˆæœ¬çš„ä»£ç æ›´åŠ æ•´æ´ï¼Œä½†æ˜¯å…¶å® <code>return</code> æ˜¯ä¸å¿…è¦çš„ï¼›ä»é£æ ¼ä¸Šè¯´ï¼Œä½¿ç”¨ <code>return</code> è®©ä»£ç çœ‹èµ·æ¥æ›´åŠ æœ‰è§„å¾‹ï¼Œå¦å¤–ç†Ÿæ‚‰å‘½ä»¤å¼ç¼–ç¨‹çš„ç¨‹åºå‘˜å¯èƒ½å¯¹å®ƒæ„Ÿè§‰æ›´ç†Ÿæ‚‰ï¼›ä½†å…¶å®ä¸Šå®ƒæ˜¯å¤šä½™çš„ï¼›ä¸‹é¢æ˜¯ä¸å®ƒç­‰ä»·çš„ç‰ˆæœ¬ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Carrier.hs</span>
<span class="token hvariable">variation2a</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span> <span class="token hvariable">carrierMap</span> <span class="token hvariable">addressMap</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">number</span> <span class="token operator">&lt;-</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">person</span> <span class="token hvariable">phoneMap</span>
  <span class="token hvariable">carrier</span> <span class="token operator">&lt;-</span> <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">number</span> <span class="token hvariable">carrierMap</span>
  <span class="token constant">M</span><span class="token punctuation">.</span><span class="token builtin">lookup</span> <span class="token hvariable">carrier</span> <span class="token hvariable">addressMap</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="the-list-monad" tabindex="-1"><a class="header-anchor" href="#the-list-monad"><span>List Monad</span></a></h2><p><code>Maybe</code> ç±»å‹ä»£è¡¨æœ‰å¯èƒ½æœ‰å€¼ä¹Ÿå¯èƒ½æ²¡æœ‰å€¼çš„è®¡ç®—ï¼›ä¹Ÿæœ‰çš„æƒ…å†µä¸‹å¸Œæœ›è®¡ç®—ä¼šè¿”å›ä¸€ç³»åˆ—çš„ç»“æœï¼Œæ˜¾ç„¶ï¼ŒListæ­£é€‚åˆè¿™ä¸ªç›®çš„ã€‚Listçš„ç±»å‹å¸¦æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¿™æš—ç¤ºå®ƒæœ‰å¯èƒ½èƒ½ä½œä¸ºä¸€ä¸ªmonadä½¿ç”¨ï¼›äº‹å®ä¸Šï¼Œæˆ‘ä»¬ç¡®å®èƒ½æŠŠå®ƒå½“ä½œmonadä½¿ç”¨ã€‚</p><p>å…ˆä¸çœ‹æ ‡å‡†åº“çš„ <code>Prelude</code> å¯¹äºList monadçš„å®ç°ï¼Œæˆ‘ä»¬è‡ªå·±æ¥çœ‹çœ‹ä¸€ä¸ª List çš„monadåº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆç®€å•ï¼šé¦–å…ˆçœ‹ <code>(&gt;&gt;=)</code> å’Œ <code>return</code> çš„ç±»å‹ï¼Œç„¶åè¿›è¡Œä¸€äº›æ›¿æ¢æ“ä½œï¼Œçœ‹çœ‹æˆ‘ä»¬èƒ½ä¸èƒ½ä½¿ç”¨ä¸€äº›ç†Ÿæ‚‰çš„listå‡½æ•°ã€‚</p><p><code>return</code> å’Œ <code>(&gt;&gt;=)</code> è¿™ä¸¤ä¸ªå‡½æ•°é‡Œé¢æ˜¾ç„¶ <code>return</code> æ¯”è¾ƒç®€å•ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“ <code>return</code> å‡½æ•°æ¥å—ä¸€ä¸ªç±»å‹ï¼Œç„¶åæŠŠå®ƒç”¨ç±»å‹æ„é€ å™¨ <code>m</code> åŒ…è£…ä¸€ä¸‹ç„¶åäº§ç”Ÿä¸€ä¸ªæ–°çš„ç±»å‹ <code>m a</code>. åœ¨Listè¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªç±»å‹æ„é€ å™¨å°±æ˜¯ <code>[]</code>. æŠŠè¿™ä¸ªç±»å‹æ„é€ å™¨ä½¿ç”¨Listçš„ç±»å‹æ„é€ å™¨æ›¿æ¢æ‰æˆ‘ä»¬å°±å¾—åˆ°äº†ç±»å‹ <code>[] a</code> ï¼ˆå½“ç„¶ï¼Œè¿™æ ·å†™æ˜¯éæ³•çš„ï¼ï¼‰ï¼›å¯ä»¥æŠŠå®ƒå†™æˆæ›´åŠ ç†Ÿæ‚‰çš„å½¢å¼ <code>[a]</code>.</p><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“listçš„ <code>return</code> å‡½æ•°çš„ç±»å‹åº”è¯¥æ˜¯ <code>a -&gt; [a]</code> ã€‚å¯¹äºè¿™ç§ç±»å‹çš„å‡½æ•°ï¼Œåªæœ‰å°‘æ•°é‚£ä¹ˆå‡ ç§å®ç°çš„å¯èƒ½ï¼šè¦ä¹ˆå®ƒè¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ï¼Œè¦ä¹ˆè¿”å›ä¸€ä¸ªå•ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œæˆ–è€…ä¸€ä¸ªæ— ç©·é•¿åº¦çš„åˆ—è¡¨ã€‚åŸºäºæˆ‘ä»¬ç°åœ¨å¯¹äºMonadçš„ç†è§£ï¼Œæœ€æœ‰å¯èƒ½çš„å®ç°æ–¹å¼åº”è¯¥æ˜¯è¿”å›å•ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼šå®ƒä¸ä¼šä¸¢å¤±å·²æœ‰ä¿¡æ¯ï¼Œä¹Ÿä¸ä¼šæ— é™é‡å¤ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/ListMonad.hs</span>
<span class="token hvariable">returnSingleton</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">returnSingleton</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬å¯¹ <code>(&gt;&gt;=)</code> çš„ç±»å‹ç­¾åè¿›è¡Œå’Œ <code>return</code> ç±»ä¼¼çš„æ›¿æ¢ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ï¼š<code>[a] -&gt; (a -&gt; [b]) -&gt; [b]</code> . è¿™çœ‹èµ·æ¥å’Œ <code>map</code> éå¸¸ç›¸ä¼¼ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> m a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> m b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m b
ghci<span class="token operator">&gt;</span> :type map
map :: <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span> -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>map</code> å‡½æ•°çš„å‚æ•°é¡ºåºå’Œå®ƒæœ‰ç‚¹ä¸å¯¹åº”ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> m a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> m b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m b
ghci<span class="token operator">&gt;</span> :type flip map
flip map :: <span class="token punctuation">[</span>a<span class="token punctuation">]</span> -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>b<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ç‚¹å°é—®é¢˜ï¼š <code>flip map</code> çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹æ˜¯ <code>a -&gt; b</code> ï¼Œä½†æ˜¯ <code>(&gt;&gt;=)</code> çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹æ˜¯ <code>a -&gt; [b]</code> ,åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯¹ç±»å‹è¿›è¡Œæ›´å¤šçš„æ›¿æ¢ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ <code>flip map</code> è¿™ä¸ªå‡½æ•°èƒ½æŠŠä»»ä½•ç±»å‹ <code>b</code> ä½œä¸ºè¿”å›ç»“æœï¼›å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>[b]</code> æ¥æ›¿æ¢ <code>b</code> ï¼Œè¿™ä¸ªå‡½æ•°çš„ç±»å‹å°±æˆäº† <code>a -&gt; (a -&gt; [n]) -&gt; [[b]]</code> ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>map</code> ï¼Œå°†ä¸€ä¸ªåˆ—è¡¨ä¸ä¸€ä¸ªè¿”å›åˆ—è¡¨çš„å‡½æ•°è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªåŒ…å«åˆ—è¡¨çš„åˆ—è¡¨ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> flip map <span class="token punctuation">[</span><span class="token number">1,2</span>,3<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">\</span>a -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>a,a+100<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1,101</span><span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">2,102</span><span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">3,103</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬è¿™ä¹ˆåšå¹¶æ²¡æœ‰è®© <code>flip map</code> å’Œ <code>(&gt;&gt;=)</code> çš„ç±»å‹æ›´åŠ åŒ¹é…ä¸€ç‚¹ï¼›<code>(&gt;&gt;=)</code> çš„ç±»å‹æ˜¯ <code>[a] -&gt; (a -&gt; [b]) -&gt; [b]</code> ï¼›ç„¶è€Œï¼Œ<code>flip map</code> å¦‚æœå¯¹è¿”å›åˆ—è¡¨çš„å‡½æ•°è¿›è¡Œmapé‚£ä¹ˆå®ƒçš„ç±»å‹ç­¾åæ˜¯ <code>[a] -&gt; (a -&gt; [b]) -&gt; [[b]]</code> ã€‚åœ¨ç±»å‹ä¸Šä¾ç„¶æ˜¯ä¸åŒ¹é…çš„ï¼Œæˆ‘ä»¬ä»…ä»…æ˜¯æŠŠä¸åŒ¹é…çš„ç±»å‹ä»ä¸­é—´è½¬ç§»åˆ°äº†æœ«å°¾ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„åŠªåŠ›å¹¶æ²¡æœ‰ç™½è´¹ï¼šæˆ‘ä»¬ç°åœ¨å…¶å®åªéœ€è¦ä¸€ä¸ªèƒ½æŠŠ <code>[[b]]</code> è½¬åŒ–æˆ <code>[b]</code> çš„å‡½æ•°å°±å¥½äº†ã€‚å¾ˆæ˜æ˜¾ <code>concat</code> ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type concat
concat :: <span class="token punctuation">[</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>a<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>(&gt;&gt;=)</code> çš„ç±»å‹å‘Šè¯‰æˆ‘ä»¬åº”è¯¥æŠŠ <code>map</code> çš„å‚æ•°è¿›è¡Œç¿»è½¬ï¼Œç„¶åä½¿ç”¨ <code>concat</code> è¿›è¡Œå¤„ç†å¾—åˆ°å•ä¸ªåˆ—è¡¨ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">\</span>xs f -<span class="token operator">&gt;</span> concat <span class="token punctuation">(</span>map f xs<span class="token punctuation">)</span>
<span class="token punctuation">\</span>xs f -<span class="token operator">&gt;</span> concat <span class="token punctuation">(</span>map f xs<span class="token punctuation">)</span> :: <span class="token punctuation">[</span>a<span class="token punctuation">]</span> -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>a1<span class="token punctuation">]</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token punctuation">[</span>a1<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>äº‹å®ä¸Šlistsçš„ <code>(&gt;&gt;=)</code> å®šä¹‰å°±æ˜¯è¿™æ ·ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/ListMonad.hs</span>
<span class="token keyword">instance</span> <span class="token constant">Monad</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">where</span>
    <span class="token builtin">return</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">]</span>
        <span class="token hvariable">xs</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token builtin">concat</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ƒä½¿ç”¨å‡½æ•° <code>f</code> å¯¹åˆ—è¡¨ <code>xs</code> çš„æ¯ä¸€ä¸ªå…ƒç´  <code>x</code> è¿›è¡Œå¤„ç†ï¼Œç„¶åæŠŠå¾—åˆ°çš„ç»“æœæ‹¼æ¥èµ·æ¥å¾—åˆ°å•ä¸ªåˆ—è¡¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æå®šäº†Listè¿™ä¸ªMonadçš„ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°ï¼Œå¦å¤–ä¸¤ä¸ªéæ ¸å¿ƒå‡½æ•°å®ç°èµ·æ¥å°±å¾ˆå®¹æ˜“äº†ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/ListMonad.hs</span>
    <span class="token hvariable">xs</span> <span class="token operator">&gt;&gt;</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token builtin">concat</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">_</span> <span class="token operator">-&gt;</span> <span class="token hvariable">f</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
    <span class="token builtin">fail</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="understanding-the-list-monad" tabindex="-1"><a class="header-anchor" href="#understanding-the-list-monad"><span>ç†è§£List monad</span></a></h3><p>List monadä¸Haskellçš„å¦å¤–ä¸€ä¸ªå·¥å…·------åˆ—è¡¨æ¨å¯¼éå¸¸ç›¸ä¼¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—ä¸¤ä¸ªåˆ—è¡¨çš„ç¬›å¡å°”é›†æ¥è¯´æ˜å®ƒä»¬ä¹‹é—´çš„ç›¸ä¼¼æ€§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªåˆ—è¡¨æ¨å¯¼ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/CartesianProduct.hs</span>
<span class="token hvariable">comprehensive</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span><span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token hvariable">x</span> <span class="token operator">&lt;-</span> <span class="token hvariable">xs</span><span class="token punctuation">,</span> <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token hvariable">ys</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤§æ‹¬å·è¯­æ³•æ¥è¡¨ç¤ºmonadicä»£ç ï¼Œè¿™æ ·ä¼šå‘Šè¯‰æˆ‘ä»¬monadicä»£ç å’Œåˆ—è¡¨æ¨å¯¼è¯¥æœ‰å¤šä¹ˆç›¸ä¼¼ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/CartesianProduct.hs</span>
<span class="token hvariable">monadic</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span> <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token hvariable">x</span> <span class="token operator">&lt;-</span> <span class="token hvariable">xs</span><span class="token punctuation">;</span> <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token hvariable">ys</span><span class="token punctuation">;</span> <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span><span class="token hvariable">y</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å”¯ä¸€çš„ä¸€ä¸ªä¸åŒç‚¹æ˜¯ä½¿ç”¨monadicä»£ç è®¡ç®—çš„ç»“æœåœ¨ä¸€ç³»åˆ—è¡¨è¾¾å¼çš„æœ«å°¾å¾—åˆ°ï¼›è€Œåˆ—è¡¨æ¨å¯¼çš„ç»“æœè¡¨ç¤ºåœ¨æœ€å¼€å§‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ä¸ªå‡½æ•°è®¡ç®—çš„ç»“æœæ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> comprehensive <span class="token punctuation">[</span><span class="token number">1,2</span><span class="token punctuation">]</span> <span class="token string">&quot;bar&quot;</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">2</span>,<span class="token string">&#39;r&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
ghci<span class="token operator">&gt;</span> comprehensive <span class="token punctuation">[</span><span class="token number">1,2</span><span class="token punctuation">]</span> <span class="token string">&quot;bar&quot;</span> <span class="token operator">==</span> monadic <span class="token punctuation">[</span><span class="token number">1,2</span><span class="token punctuation">]</span> <span class="token string">&quot;bar&quot;</span>
True
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€å¼€å§‹è‚¯å®šå¯¹åˆ—è¡¨monadéå¸¸è¿·æƒ‘ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹monadicä»£ç è®¡ç®—ç¬›å¡å°”é›†çš„è¿‡ç¨‹ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/CartesianProduct.hs</span>
<span class="token hvariable">blockyDo</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span> <span class="token operator">=</span> <span class="token keyword">do</span>
    <span class="token hvariable">x</span> <span class="token operator">&lt;-</span> <span class="token hvariable">xs</span>
    <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token hvariable">ys</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>x</code> æ¯æ¬¡å–åˆ—è¡¨ <code>xs</code> çš„ä¸€ä¸ªå€¼ï¼Œ <code>y</code> æ¯æ¬¡å–åˆ—è¡¨ <code>ys</code> çš„ä¸€ä¸ªå€¼ï¼Œç„¶åç»„åˆåœ¨ä¸€èµ·å¾—åˆ°æœ€ç»ˆç»“æœï¼›äº‹å®ä¸Šï¼Œè¿™å°±æ˜¯ä¸¤å±‚åµŒå¥—å¾ªç¯ï¼è¿™ä¹Ÿè¯´æ˜äº†å…³äºmonadçš„ä¸€ä¸ªå¾ˆé‡è¦çš„äº‹å®ï¼šé™¤éä½ çŸ¥é“monadå†…éƒ¨æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œå¦åˆ™ä½ å°†æ— æ³•é¢„æœŸmonadicä»£ç çš„è¡Œä¸ºã€‚</p><p>æˆ‘ä»¬å†è¿›ä¸€æ­¥è§‚å¯Ÿè¿™ä¸ªä»£ç ï¼›é¦–å…ˆå»æ‰ <code>do</code> è¡¨ç¤ºæ³•ï¼›ç¨å¾®æ”¹å˜ä¸€ä¸‹ä»£ç çš„ç»“æ„è®©å®ƒçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªåµŒå¥—å¾ªç¯ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/CartesianProduct.hs</span>
<span class="token hvariable">blockyPlain</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span> <span class="token operator">=</span>
    <span class="token hvariable">xs</span> <span class="token operator">&gt;&gt;=</span>
    <span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">ys</span> <span class="token operator">&gt;&gt;=</span>
    <span class="token operator">\</span><span class="token hvariable">y</span> <span class="token operator">-&gt;</span> <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>

<span class="token hvariable">blockyPlain_reloaded</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span> <span class="token operator">=</span>
    <span class="token builtin">concat</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span>
                 <span class="token builtin">concat</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">y</span> <span class="token operator">-&gt;</span>
                              <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                         <span class="token hvariable">ys</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token hvariable">xs</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœ <code>xs</code> çš„å€¼æ˜¯ <code>[1, 2, 3]</code> ï¼Œé‚£ä¹ˆå‡½æ•°ä½“çš„å‰ä¸¤è¡Œä¼šä¾æ¬¡æŠŠxå€¼ç»‘å®šä¸º <code>1</code> ï¼Œ<code>2</code> å’Œ <code>3</code> ï¼›å¦‚æœ <code>ys</code> çš„å€¼æ˜¯ <code>[True, False]</code> ï¼›é‚£ä¹ˆæœ€åä¸€è¡Œä¼šè¢«æ±‚å€¼å…­æ¬¡ï¼šä¸€æ¬¡æ˜¯ <code>x</code> ä¸º <code>1</code> , <code>y</code> å€¼ä¸º <code>True</code> ï¼›ç„¶åæ˜¯ <code>x</code> å€¼ä¸º <code>1</code> , <code>y</code> çš„å€¼ä¸º <code>False</code> ï¼›ä¸€ç›´ç»§ç»­ä¸‹å»ã€‚ <code>return</code> è¡¨è¾¾å¼æŠŠæ¯ä¸ªå…ƒç»„åŒ…è£…æˆä¸€ä¸ªå•ä¸ªåˆ—è¡¨çš„å…ƒç´ ã€‚</p><h3 id="putting-the-list-monad-to-work" tabindex="-1"><a class="header-anchor" href="#putting-the-list-monad-to-work"><span>ä½¿ç”¨List Monad</span></a></h3><p>ç»™å®šä¸€ä¸ªæ•´æ•°ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„æ­£æ•´æ•°å¯¹ï¼Œä½¿å¾—å®ƒä»¬ä¸¤ä¸ªç§¯ç­‰äºè¿™ä¸ªæ•´æ•°ï¼›ä¸‹é¢æ˜¯è¿™ä¸ªé—®é¢˜çš„ç®€å•è§£æ³•ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MultiplyTo.hs</span>
<span class="token hvariable">guarded</span> <span class="token operator">::</span> <span class="token constant">Bool</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">guarded</span> <span class="token constant">True</span>  <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token hvariable">xs</span>
<span class="token hvariable">guarded</span> <span class="token constant">False</span> <span class="token hvariable">_</span>  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token hvariable">multiplyTo</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token hvariable">multiplyTo</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">x</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token hvariable">n</span><span class="token punctuation">]</span>
  <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token operator">..</span><span class="token hvariable">n</span><span class="token punctuation">]</span>
  <span class="token hvariable">guarded</span> <span class="token punctuation">(</span><span class="token hvariable">x</span> <span class="token operator">*</span> <span class="token hvariable">y</span> <span class="token operator">==</span> <span class="token hvariable">n</span><span class="token punctuation">)</span> <span class="token operator">$</span>
    <span class="token builtin">return</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token punctuation">,</span> <span class="token hvariable">y</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ <strong>ghci</strong> éªŒè¯ç»“æœï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> multiplyTo <span class="token number">8</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1,8</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">2,4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
ghci<span class="token operator">&gt;</span> multiplyTo <span class="token number">100</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1,100</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">2,50</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">4,25</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">5,20</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">10,10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
ghci<span class="token operator">&gt;</span> multiplyTo <span class="token number">891</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1,891</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">3,297</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">9,99</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">11,81</span><span class="token punctuation">)</span>,<span class="token punctuation">(</span><span class="token number">27,33</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="desugaring-of-do-blocks" tabindex="-1"><a class="header-anchor" href="#desugaring-of-do-blocks"><span>è¿˜åŸdoçš„æœ¬è´¨</span></a></h2><p>Haskellçš„ <code>do</code> è¡¨ç¤ºæ³•å®é™…ä¸Šæ˜¯ä¸ªè¯­æ³•ç³–ï¼šå®ƒç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§ä¸ä½¿ç”¨ <code>(&gt;&gt;=)</code> å’ŒåŒ¿åå‡½æ•°æ¥å†™monadicä»£ç çš„æ–¹å¼ã€‚å»é™¤doè¯­æ³•ç³–çš„è¿‡ç¨‹å°±æ˜¯æŠŠå®ƒç¿»è¯‘ä¸º <code>(&gt;&gt;=)</code> å’ŒåŒ¿åå‡½æ•°ã€‚</p><p>å»é™¤doè¯­æ³•ç³–çš„è§„åˆ™éå¸¸ç®€å•ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„æŠŠç¼–è¯‘å™¨æƒ³è±¡ä¸ºæœºæ¢°é‡å¤åœ°å¯¹è¿™äº›doè¯­å¥å—æ‰§è¡Œè¿™äº›è§„åˆ™ç›´åˆ°æ²¡æœ‰ä»»ä½•doå…³é”®å­—ä¸ºæ­¢ã€‚</p><p><code>do</code> å…³é”®å­—åé¢æ¥å•ä¸ªåŠ¨ä½œï¼ˆactionï¼‰ç›´æ¥ç¿»è¯‘ä¸ºåŠ¨ä½œæœ¬èº«ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">doNotation1</span> <span class="token operator">=</span>
    <span class="token keyword">do</span> <span class="token hvariable">act</span>

<span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">translated1</span> <span class="token operator">=</span>
    <span class="token hvariable">act</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>do</code> åé¢åŒ…å«å¤šä¸ªåŠ¨ä½œï¼ˆactionï¼‰çš„è¡¨ç¤ºæ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆæ˜¯ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œä½†æ˜¯æ¥ä¸€ä¸ª <code>(&gt;&gt;)</code> æ“ä½œç¬¦ï¼Œç„¶åä¸€ä¸ª <code>do</code> å…³é”®å­—ï¼›æœ€åæ¥å‰©ä¸‹çš„åŠ¨ä½œã€‚å½“æˆ‘ä»¬å¯¹doè¯­å¥å—é‡å¤åº”ç”¨è¿™æ¡è§„åˆ™çš„æ—¶å€™ï¼Œæ•´ä¸ªdoè¯­å¥å¿«å°±ä¼šè¢« <code>(&gt;&gt;)</code> ä¸²è”èµ·æ¥ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">doNotation2</span> <span class="token operator">=</span>
    <span class="token keyword">do</span> <span class="token hvariable">act1</span>
       <span class="token hvariable">act2</span>
       <span class="token comment">{- ... etc. -}</span>
       <span class="token hvariable">actN</span>

<span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">translated2</span> <span class="token operator">=</span>
    <span class="token hvariable">act1</span> <span class="token operator">&gt;&gt;</span>
    <span class="token keyword">do</span> <span class="token hvariable">act2</span>
       <span class="token comment">{- ... etc. -}</span>
       <span class="token hvariable">actN</span>

<span class="token hvariable">finalTranslation2</span> <span class="token operator">=</span>
    <span class="token hvariable">act1</span> <span class="token operator">&gt;&gt;</span>
    <span class="token hvariable">act2</span> <span class="token operator">&gt;&gt;</span>
    <span class="token comment">{- ... etc. -}</span>
    <span class="token hvariable">actN</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>&lt;-</code> æ ‡è®°éœ€è¦é¢å¤–æ³¨æ„ã€‚åœ¨ <code>&lt;-</code> çš„å·¦è¾¹æ˜¯ä¸€ä¸ªæ­£å¸¸çš„Haskellæ¨¡å¼ï¼Œå¯ä»¥æ˜¯å•ä¸ªå˜é‡æˆ–è€…æ›´å¤æ‚çš„ä¸œè¥¿ï¼›ä½†æ˜¯è¿™é‡Œä¸å…è®¸ä½¿ç”¨æ¨¡å¼åŒ¹é…çš„å®ˆå«(guards):</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">doNotation3</span> <span class="token operator">=</span>
    <span class="token keyword">do</span> <span class="token hvariable">pattern</span> <span class="token operator">&lt;-</span> <span class="token hvariable">act1</span>
       <span class="token hvariable">act2</span>
       <span class="token comment">{- ... etc. -}</span>
       <span class="token hvariable">actN</span>

<span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">translated3</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">f</span> <span class="token hvariable">pattern</span> <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token hvariable">act2</span>
                       <span class="token comment">{- ... etc. -}</span>
                       <span class="token hvariable">actN</span>
        <span class="token hvariable">f</span> <span class="token hvariable">_</span>     <span class="token operator">=</span> <span class="token builtin">fail</span> <span class="token string">&quot;...&quot;</span>
    <span class="token keyword">in</span> <span class="token hvariable">act1</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ç§æƒ…å†µä¼šè¢«ç¿»è¯‘ä¸ºå£°æ˜äº†ä¸€ä¸ªåå­—å”¯ä¸€çš„å±€éƒ¨å‡½æ•°(ä¸Šé¢çš„ä¾‹å­é‡Œé¢æˆ‘ä»¬ä»…ä»…ä½¿ç”¨äº† <code>f</code> è¿™ä¸ªåå­—)çš„ <code>let</code> è¡¨è¾¾å¼ï¼› <code>&lt;-</code> å³è¾¹çš„åŠ¨ä½œä¼šç”¨ <code>(&gt;&gt;=)</code> å’Œè¿™ä¸ªå±€éƒ¨å‡½æ•°ä¸²è”èµ·æ¥ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ¨¡å¼åŒ¹é…å¤±è´¥ï¼Œ <code>let</code> è¡¨è¾¾å¼ä¼šè°ƒç”¨Monadçš„ <code>fail</code> å‡½æ•°ï¼›ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Maybe</code> monadçš„ä¾‹å­ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">robust</span> <span class="token operator">::</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token constant">Maybe</span> <span class="token hvariable">a</span>
<span class="token hvariable">robust</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token keyword">do</span> <span class="token punctuation">(</span><span class="token hvariable">_</span><span class="token operator">:</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">_</span><span class="token punctuation">)</span> <span class="token operator">&lt;-</span> <span class="token constant">Just</span> <span class="token hvariable">xs</span>
               <span class="token builtin">return</span> <span class="token hvariable">x</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Maybe</code> monadé‡Œé¢ <code>fail</code> çš„å®ç°æ˜¯è¿”å›ä¸€ä¸ª <code>Nothing</code> ã€‚å¦‚æœä¸Šé¢çš„ä»£ç æ¨¡å¼åŒ¹é…å¤±è´¥ï¼Œé‚£ä¹ˆæ•´ä¸ªè®¡ç®—ç»“æœå°±ä¼šæ˜¯ <code>Nothing</code> .</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> robust <span class="token punctuation">[</span><span class="token number">1,2</span>,3<span class="token punctuation">]</span>
Just <span class="token number">2</span>
ghci<span class="token operator">&gt;</span> robust <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
Nothing
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å½“æˆ‘ä»¬åœ¨ <code>do</code> å—é‡Œé¢ä½¿ç”¨ <code>let</code> è¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¯ä»¥çœç•¥æ‰ <code>in</code> å…³é”®å­—ï¼›ä½†æ˜¯ <code>let</code> åé¢çš„è¯­å¥å¿…é¡»å’Œå®ƒå¯¹é½ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">doNotation4</span> <span class="token operator">=</span>
    <span class="token keyword">do</span> <span class="token keyword">let</span> <span class="token hvariable">val1</span> <span class="token operator">=</span> <span class="token hvariable">expr1</span>
           <span class="token hvariable">val2</span> <span class="token operator">=</span> <span class="token hvariable">expr2</span>
           <span class="token comment">{- ... etc. -}</span>
           <span class="token hvariable">valN</span> <span class="token operator">=</span> <span class="token hvariable">exprN</span>
       <span class="token hvariable">act1</span>
       <span class="token hvariable">act2</span>
       <span class="token comment">{- ... etc. -}</span>
       <span class="token hvariable">actN</span>

<span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">translated4</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">val1</span> <span class="token operator">=</span> <span class="token hvariable">expr1</span>
        <span class="token hvariable">val2</span> <span class="token operator">=</span> <span class="token hvariable">expr2</span>
        <span class="token hvariable">valN</span> <span class="token operator">=</span> <span class="token hvariable">exprN</span>
    <span class="token keyword">in</span> <span class="token keyword">do</span> <span class="token hvariable">act1</span>
          <span class="token hvariable">act2</span>
          <span class="token comment">{- ... etc. -}</span>
          <span class="token hvariable">actN</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="monads-as-a-programmable-semicolon" tabindex="-1"><a class="header-anchor" href="#monads-as-a-programmable-semicolon"><span>Monads: å¯ç¼–ç¨‹åˆ†å·</span></a></h3><p>åœ¨<code class="interpreted-text" role="ref">the-offside-rule-is-not-mandatory</code> é‡Œé¢æåˆ°è¿‡ç¼©è¿›æ’ç‰ˆæ˜¯Haskellçš„æ ‡å‡†ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯å¿…è¦çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>do</code> è¡¨ç¤ºæ³•æ¥æ›¿ä»£ç¼©è¿›æ’ç‰ˆã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">semicolon</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token punctuation">{</span>
    <span class="token hvariable">act1</span><span class="token punctuation">;</span>
    <span class="token hvariable">val1</span> <span class="token operator">&lt;-</span> <span class="token hvariable">act2</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span> <span class="token hvariable">val2</span> <span class="token operator">=</span> <span class="token hvariable">expr1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token hvariable">actN</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token comment">-- file: ch14/Do.hs</span>
<span class="token hvariable">semicolonTranslated</span> <span class="token operator">=</span>
    <span class="token hvariable">act1</span> <span class="token operator">&gt;&gt;</span>
    <span class="token keyword">let</span> <span class="token hvariable">f</span> <span class="token hvariable">val1</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token hvariable">val2</span> <span class="token operator">=</span> <span class="token hvariable">expr1</span>
                 <span class="token keyword">in</span> <span class="token hvariable">actN</span>
        <span class="token hvariable">f</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token builtin">fail</span> <span class="token string">&quot;...&quot;</span>
    <span class="token keyword">in</span> <span class="token hvariable">act2</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶å¾ˆå°‘äººæœ‰è¿™ä¹ˆç”¨ï¼Œä½†æ˜¯åœ¨å•ä¸ªè¡¨è¾¾å¼é‡Œé¢æ˜¾å¼åœ°ä½¿ç”¨åˆ†å·å®¹æ˜“è®©äººäº§ç”Ÿè¿™ç§æ„Ÿè§‰ï¼šmonadsæ˜¯ä¸€ç§&quot;å¯ç¼–ç¨‹çš„åˆ†å·&quot;ï¼Œå› ä¸ºåœ¨æ¯ä¸ªmonadé‡Œé¢ <code>(&gt;&gt;=)</code> å’Œ <code>(&gt;&gt;)</code> çš„è¡Œä¸ºéƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><h3 id="why-go-sugar-free" tabindex="-1"><a class="header-anchor" href="#why-go-sugar-free"><span>ä¸ºä»€ä¹ˆè¦sugar-free</span></a></h3><p>å½“æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢æ˜¾å¼ä½¿ç”¨ <code>(&gt;&gt;=)</code> çš„æ—¶å€™ï¼Œå®ƒæé†’æˆ‘ä»¬åœ¨ä½¿ç”¨ç»„åˆå­ç»„åˆå‡½æ•°è€Œä¸æ˜¯ç®€å•çš„åºåˆ—åŒ–åŠ¨ä½œã€‚</p><p>å¦‚æœä½ å¯¹monadæ„Ÿè§‰è¿˜å¾ˆé™Œç”Ÿï¼Œé‚£ä¹ˆæˆ‘å»ºè®®ä½ å¤šæ˜¾å¼åœ°ä½¿ç”¨ <code>(&gt;&gt;=)</code> è€Œä¸æ˜¯ <code>do</code> è¯­æ³•æ¥å†™monadicçš„ä»£ç ã€‚è¿™äº›é‡å¤å¯¹äºå¤§å¤šæ•°çš„ç¨‹åºå‘˜æ¥è¯´éƒ½èƒ½å¸®åŠ©ç†è§£ã€‚</p><p>å½“ç†Ÿæ‚‰äº†monadçš„æ—¶å€™ï¼Œä½ å¯ä»¥æŒ‰ç…§éœ€è¦é€‰æ‹©ä½ è‡ªå·±çš„é£æ ¼ï¼›ä½†æ˜¯æ°¸è¿œä¸è¦å†åŒä¸€ä¸ªå‡½æ•°é‡Œé¢æ··ç”¨ <code>do</code> å’Œ <code>(&gt;&gt;=)</code> ã€‚</p><p>ä¸ç®¡ä½ ç”¨ä¸ç”¨doè¡¨ç¤ºæ³•ï¼Œ <code>(=&lt;&lt;)</code> å‡½æ•°ç»å¸¸è¢«ä½¿ç”¨ï¼›å®ƒå°±æ˜¯ <code>(&gt;&gt;=)</code> çš„å‚æ•°ç¿»è½¬ç‰ˆæœ¬ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&gt;&gt;</span><span class="token operator">=</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> m a -<span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> m b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m b
ghci<span class="token operator">&gt;</span> :type <span class="token punctuation">(</span><span class="token operator">=</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">=</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">)</span> :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> m b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m a -<span class="token operator">&gt;</span> m b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæƒ³æŠŠmonadicå‡½æ•°æŒ‰ç…§é€šå¸¸Haskellä»å³å¾€å·¦ç»“åˆèµ·æ¥çš„è¯ï¼Œé‚£ä¹ˆ <code>(=&lt;&lt;)</code> éå¸¸æœ‰ç”¨ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/CartesianProduct.hs</span>
<span class="token hvariable">wordCount</span> <span class="token operator">=</span> <span class="token builtin">print</span> <span class="token operator">.</span> <span class="token builtin">length</span> <span class="token operator">.</span> <span class="token builtin">words</span> <span class="token operator">=&lt;&lt;</span> <span class="token builtin">getContents</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="the-state-monad" tabindex="-1"><a class="header-anchor" href="#the-state-monad"><span>çŠ¶æ€monad</span></a></h2><p>åœ¨ <code class="interpreted-text" role="doc">10</code> é‡Œé¢æˆ‘ä»¬è¯´ <code>Parse</code> æ˜¯ä¸€ä¸ªmonadã€‚<code>Parser</code> æœ‰ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„è§’åº¦åƒMonadï¼Œå…¶ä¸€æ˜¯å®ƒåœ¨è§£æå¤±è´¥æ—¶å€™çš„è¡Œä¸º------æˆ‘ä»¬ä½¿ç”¨ <code>Either</code> è¡¨è¾¾ï¼›å…¶äºŒæ˜¯å®ƒæºå¸¦è¿™ä¸€äº›éšå¼çš„çŠ¶æ€ä¿¡æ¯ï¼ˆæ¯æ¬¡è¢«éƒ¨åˆ†æ¶ˆè€—çš„ <code>ByteString</code> .</p><p>åœ¨Haskellé‡Œé¢è¯»å†™çŠ¶æ€è¿™ç§åœºæ™¯å¤ªå¸¸è§äº†ï¼Œå› æ­¤æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ªå«åš <code>State</code> çš„monadè§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨ <code>Control.Monad.State</code> è¿™ä¸ªæ¨¡å—å¯ä»¥æ‰¾åˆ°å®ƒã€‚</p><p>æˆ‘ä»¬çš„ <code>Parse</code> ç±»å‹èƒ½æºå¸¦ä¸€ä¸ª <code>ByteString</code> ç±»å‹çš„çŠ¶æ€ï¼Œ <code>State</code> monadå¯ä»¥æºå¸¦ä»»æ„ç±»å‹çš„çŠ¶æ€ã€‚å§‘ä¸”æŠŠè¿™ä¸ªæœªçŸ¥çŠ¶æ€çš„ç±»å‹è®°ä¸º <code>s</code> .</p><p>æˆ‘ä»¬èƒ½å¯¹ä¸€ä¸ªçŠ¶æ€åšä»€ä¹ˆï¼Ÿç»™å®šä¸€ä¸ªçŠ¶æ€çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹è¿™ä¸ªçŠ¶æ€ï¼Œäº§ç”Ÿä¸€ä¸ªç»“æœç„¶åè¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚å‡è®¾è®¡ç®—çš„ç»“æœç±»å‹æ˜¯ <code>a</code> . é‚£ä¹ˆè¡¨è¾¾è¿™ä¸ªè¿‡ç¨‹çš„ç±»å‹å°±æ˜¯ <code>s -&gt; (a, s)</code> : æ¥å—ä¸€ä¸ªçŠ¶æ€ <code>s</code> å¯¹å®ƒè¿›è¡ŒæŸäº›æ“ä½œï¼Œè¿”å›ç»“æœ <code>a</code> å’Œæ–°çŠ¶æ€ <code>s</code> .</p><h3 id="almost-a-state-monad" tabindex="-1"><a class="header-anchor" href="#almost-a-state-monad"><span>è‡ªå·±å®šä¹‰State monad</span></a></h3><p>æˆ‘ä»¬å…ˆè‡ªå·±å®ç°ä¸€ä¸ªState monadï¼Œç„¶åçœ‹çœ‹æ ‡å‡†åº“çš„å®ç°æ˜¯ä»€ä¹ˆæ ·çš„ã€‚é¦–å…ˆæˆ‘ä»¬ä»ç±»å‹å®šä¹‰å¼€å§‹ï¼Œæ­£å¦‚ä¸Šé¢æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡çš„ï¼ŒStateçš„ç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token keyword">type</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å®šä¹‰çš„monadæ˜¯æŠŠä¸€ä¸ªçŠ¶æ€è½¬æ¢ä¸ºå¦å¤–ä¸€ä¸ªçŠ¶æ€çš„å‡½æ•°ï¼Œåœ¨è½¬åŒ–çš„è¿‡ç¨‹ä¸­äº§ç”Ÿä¸€ä¸ªè®¡ç®—ç»“æœã€‚å› æ­¤ï¼Œstate monadä¹Ÿç»å¸¸è¢«ç§°ä¸ºçŠ¶æ€è½¬æ¢monadã€‚</p><p>åœ¨è¿™ä¸€ç« çš„å¼€å§‹ï¼Œæˆ‘ä»¬è¯´è¿‡monadæœ‰ä¸€ä¸ªå¸¦å•ä¸ªç±»å‹å‚æ•°çš„ç±»å‹æ„é€ å™¨ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»å‹å‚æ•°ã€‚ç†è§£è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç±»å‹æ„é€ å™¨åƒä½¿ç”¨å‡½æ•°ä¸€æ ·éƒ¨åˆ†åº”ç”¨ï¼ˆpartially applyï¼‰ï¼›ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token keyword">type</span> <span class="token constant">StringState</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">SimpleState</span> <span class="token constant">String</span> <span class="token hvariable">a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæˆ‘ä»¬æŠŠç±»å‹å˜é‡ <code>s</code> å›ºå®šä¸ºäº† <code>String</code> ç±»å‹ã€‚ <code>StringState</code> è¿˜å¸¦æœ‰ä¸€ä¸ªç±»å‹å‚æ•° <code>a</code> ï¼›è¿™æ ·å°±èƒ½æ¯”è¾ƒæ˜æ˜¾çš„çœ‹å‡ºæ¥è¿™ä¸ªç±»å‹ä¸Monadç±»å‹æ„é€ å™¨æ¯”è¾ƒåŒ¹é…äº†ã€‚æ¢å¥è¯è¯´ï¼Œç°åœ¨monadçš„ç±»å‹æ„é€ å™¨æ˜¯ <code>SimpleState s</code> ,è€Œä¸æ˜¯å•ç‹¬çš„ <code>SimpleState</code> .</p><p>å®ç°è¿™ä¸ªState monadæ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯å®šä¹‰ <code>return</code> å‡½æ•°ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token hvariable">returnSt</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span>
<span class="token hvariable">returnSt</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œ <code>return</code> å‡½æ•°æ‰€åšçš„å°±æ˜¯æ¥å—ä¸€ä¸ªç»“æœå’Œå½“å‰çŠ¶æ€ï¼ŒæŠŠå®ƒåŒ…è£…æˆä¸€ä¸ªäºŒå…ƒç»„ï¼Œç„¶åè¿”å›ã€‚ä½ ç°åœ¨åº”è¯¥å·²ç»ä¹ æƒ¯äº†HaskellæŠŠå¸¦æœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°å½“æˆä¸€ç³»åˆ—å•ä¸ªå‚æ•°å‡½æ•°çš„ä¸²è”è°ƒç”¨ï¼Œä»¥ä¸‹æ˜¯å¦ä¸€ç§æ›´ç›´è§‚çš„å†™æ³•ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token hvariable">returnAlt</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span>
<span class="token hvariable">returnAlt</span> <span class="token hvariable">a</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ç°è‡ªå®šä¹‰çš„State monadæœ€åä¸€æ­¥å°±æ˜¯å®šä¹‰ <code>(&gt;&gt;=)</code> ã€‚ä¸‹é¢æ˜¯æ ‡å‡†åº“çš„ <code>State</code> monadå¯¹äº <code>(&gt;&gt;=)</code> çš„å®ç°ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token hvariable">bindSt</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">b</span>
<span class="token hvariable">bindSt</span> <span class="token hvariable">m</span> <span class="token hvariable">k</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">m</span> <span class="token hvariable">s</span>
                   <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token hvariable">k</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">s&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›å•ä¸ªå‚æ•°çš„å˜é‡ä¸å¤ªå®¹æ˜“æ‡‚ï¼Œå…ˆæŠŠå®ƒä»¬æ¢æˆä¸€äº›æ›´å¯è¯»çš„åå­—ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token comment">-- m == step</span>
<span class="token comment">-- k == makeStep</span>
<span class="token comment">-- s == oldState</span>

<span class="token hvariable">bindAlt</span> <span class="token hvariable">step</span> <span class="token hvariable">makeStep</span> <span class="token hvariable">oldState</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">result</span><span class="token punctuation">,</span> <span class="token hvariable">newState</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">step</span> <span class="token hvariable">oldState</span>
    <span class="token keyword">in</span>  <span class="token punctuation">(</span><span class="token hvariable">makeStep</span> <span class="token hvariable">result</span><span class="token punctuation">)</span> <span class="token hvariable">newState</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="reading-and-modifying-the-state" tabindex="-1"><a class="header-anchor" href="#reading-and-modifying-the-state"><span>è¯»å–å’Œä¿®æ”¹çŠ¶æ€</span></a></h3><p><code>(&gt;&gt;=)</code> å’Œ <code>return</code> çš„å®šä¹‰ä»…ä»…è½¬ç§»çŠ¶æ€ï¼Œä½†æ˜¯å¹¶ä¸å¯¹çŠ¶æ€å†…éƒ¨åšä»»ä½•äº‹æƒ…ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€äº›ç®€å•çš„è¾…åŠ©å‡½æ•°æ¥å¯¹çŠ¶æ€è¿›è¡Œæ“ä½œã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/SimpleState.hs</span>
<span class="token hvariable">getSt</span> <span class="token operator">::</span> <span class="token constant">SimpleState</span> <span class="token hvariable">s</span> <span class="token hvariable">s</span>
<span class="token hvariable">getSt</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">s</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>

<span class="token comment">-- ``getSt`` å‡½æ•°å°±æ˜¯æ¥å—å½“å‰çŠ¶æ€å¹¶æŠŠå®ƒä½œä¸ºè®¡ç®—ç»“æœå’ŒçŠ¶æ€ä¸€å¹¶è¿”å›ï¼› ``putSt`` å‡½æ•°å¿½ç•¥å½“å‰çŠ¶æ€å¹¶ä½¿ç”¨ä¸€ä¸ªæ–°çš„çŠ¶æ€å–ä»£å®ƒã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="will-the-real-state-monad-please-stand-up" tabindex="-1"><a class="header-anchor" href="#will-the-real-state-monad-please-stand-up"><span>çœŸæ­£çš„State monadå®šä¹‰</span></a></h3><p>æˆ‘ä»¬ä¹‹å‰å®ç°çš„ <code>SimpleState</code> ä»…ä»…ä½¿ç”¨äº†ç±»å‹åˆ«åè€Œä¸æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„ç±»å‹ï¼›å¦‚æœæˆ‘ä»¬å½“æ—¶å°±ä½¿ç”¨ <code>newtype</code> åŒ…è£…ä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªç±»å‹çš„å¤„ç†ä¼šä½¿æˆ‘ä»¬çš„ä»£ç ä¸å¤ªå®¹æ˜“æ‡‚ã€‚</p><p>è¦å®šä¹‰ä¸€ä¸ªMonadçš„å®ä¾‹ï¼Œé™¤äº†å®ç° <code>(&gt;&gt;=)</code> å’Œ <code>return</code> è¿˜è¦æä¾›ä¸€ä¸ªåˆé€‚çš„ç±»å‹æ„é€ å™¨ã€‚è¿™æ­£æ˜¯æ ‡å‡†åº“çš„ <code>State</code> Monadçš„åšæ³•ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/State.hs</span>
<span class="token keyword">newtype</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token punctuation">{</span>
      <span class="token hvariable">runState</span> <span class="token operator">::</span> <span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œæ‰€åšçš„å°±æ˜¯æŠŠ <code>s -&gt; (a, s)</code> ç±»å‹ç”¨ <code>State</code> æ„é€ å™¨åŒ…è£…èµ·æ¥ã€‚é€šè¿‡ä½¿ç”¨Haskellçš„çºªå½•è¯­æ³•æ¥å®šä¹‰æ–°ç±»å‹ï¼Œæˆ‘ä»¬è‡ªåŠ¨è·å¾—äº†ä¸€ä¸ª <code>runState</code> å‡½æ•°æ¥ä»ç±»å‹æ„é€ å™¨é‡Œé¢æå–çŠ¶æ€å€¼ã€‚ <code>runState</code> çš„ç±»å‹æ˜¯ <code>State s a -&gt; s -&gt; (a, s)</code></p><p>æ ‡å‡†åº“çš„State monadä¸­ <code>return</code> çš„å®šä¹‰å’Œæˆ‘ä»¬çš„ <code>SimpleState</code> çš„ <code>return</code> å®šä¹‰åŸºæœ¬ç›¸åŒï¼Œåªä¸è¿‡è¿™é‡Œä½¿ç”¨ <code>State</code> æ„é€ å™¨åŒ…è£…äº†ä¸€ä¸‹çŠ¶æ€å‡½æ•°ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/State.hs</span>
<span class="token hvariable">returnState</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span>
<span class="token hvariable">returnState</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº <code>(&gt;&gt;=)</code> è¦ä½¿ç”¨ <code>runState</code> å‡½æ•°æ¥æå– <code>State</code> çš„å€¼ï¼Œå› æ­¤å®ƒçš„çš„å®šä¹‰ç•¥å¾®å¤æ‚ä¸€äº›ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/State.hs</span>
<span class="token hvariable">bindState</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">b</span>
<span class="token hvariable">bindState</span> <span class="token hvariable">m</span> <span class="token hvariable">k</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">s&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">runState</span> <span class="token hvariable">m</span> <span class="token hvariable">s</span>
                              <span class="token keyword">in</span> <span class="token hvariable">runState</span> <span class="token punctuation">(</span><span class="token hvariable">k</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token hvariable">s&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå‡½æ•°ä¸æˆ‘ä»¬ä¹‹å‰åœ¨ <code>SimpleState</code> é‡Œé¢å®šä¹‰çš„ <code>bindSt</code> å‡½æ•°å”¯ä¸€çš„ä¸åŒæ˜¯å®ƒæœ‰æå–å’ŒåŒ…è£…ä¸€äº›å€¼çš„æ“ä½œã€‚</p><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿä¿®æ”¹äº†è¯»å–å’Œä¿®æ”¹çŠ¶æ€çš„å‡½æ•°ï¼ˆæå–å’ŒåŒ…è£…äº†ä¸€äº›å€¼ï¼‰ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/State.hs</span>
<span class="token hvariable">get</span> <span class="token operator">::</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token hvariable">s</span>
<span class="token hvariable">get</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">s</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>

<span class="token hvariable">put</span> <span class="token operator">::</span> <span class="token hvariable">s</span> <span class="token operator">-&gt;</span> <span class="token constant">State</span> <span class="token hvariable">s</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">put</span> <span class="token hvariable">s</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">_</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">s</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="using-the-state-monad-generating-random-values" tabindex="-1"><a class="header-anchor" href="#using-the-state-monad-generating-random-values"><span>ä½¿ç”¨State monadç”Ÿæˆéšæœºæ•°</span></a></h3><p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨ <code>Parse</code> è§£æäºŒè¿›åˆ¶æ•°æ®ï¼Œå½“æ—¶æˆ‘ä»¬æŠŠè¦ç®¡ç†çš„çŠ¶æ€ç›´æ¥æ”¾åœ¨äº† <code>Parse</code> ç±»å‹é‡Œé¢ã€‚</p><p>å…¶å® <code>State</code> monadå¯ä»¥æ¥å—ä»»æ„çš„ç±»å‹ä½œä¸ºçŠ¶æ€å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›è¿™ä¸ªçŠ¶æ€ç±»å‹ï¼Œæ¯”å¦‚ <code>State ByteString</code>.</p><p>å¦‚æœä½ æœ‰å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€çš„èƒŒæ™¯çš„è¯ï¼Œç›¸å¯¹äºåˆ«çš„å¾ˆå¤šmonadï¼Œä½ å¯èƒ½å¯¹ <code>State</code> è¿™ä¸ªmonadæ›´åŠ ç†Ÿæ‚‰ã€‚æ¯•ç«Ÿå‘½ä»¤å¼è¯­è¨€æ‰€åšçš„å°±æ˜¯æºå¸¦å’Œè½¬ç§»ä¸€äº›éšå¼çš„çŠ¶æ€ï¼Œæ¯”å¦‚è¯»å†™æŸäº›éƒ¨åˆ†ï¼Œé€šè¿‡èµ‹å€¼ä¿®æ”¹ä¸€äº›ä¸œè¥¿ï¼›è¿™æ­£æ˜¯State monadæ‰€åšçš„ã€‚</p><p>æ—¢ç„¶è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ç”¨è´¹åŠ›åœ°è§£é‡Šæ€ä¹ˆä½¿ç”¨State monadäº†ï¼Œç›´æ¥æ¥ä¸ªå®é™…çš„ä¾‹å­å°±å¥½ï¼šç”Ÿæˆä¼ªéšæœºæ•°ã€‚åœ¨å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€é‡Œé¢ï¼Œé€šå¸¸æœ‰ä¸€äº›å¾ˆæ–¹ä¾¿ä½¿ç”¨çš„å‡åŒ€åˆ†å¸ƒçš„ä¼ªéšæœºæ•°æºï¼›æ¯”å¦‚åœ¨Cè¯­è¨€æ ‡å‡†åº“é‡Œé¢ï¼Œæœ‰ä¸€ä¸ª <code>rand</code> å‡½æ•°ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„çŠ¶æ€ç”Ÿæˆä¼ªéšæœºæ•°ã€‚</p><p>Haskellæ ‡å‡†åº“é‡Œé¢ç”Ÿæˆä¼ªéšæœºæ•°çš„æ¨¡å—å«åš <code>System.Random</code> ï¼Œå®ƒå¯ä»¥ç”Ÿæˆä»»æ„ç±»å‹çš„éšæœºæ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯æ•°å€¼ç±»å‹ã€‚è¿™ä¸ªæ¨¡å—æä¾›äº†ä¸€äº›éå¸¸å®ç”¨çš„å‡½æ•°ã€‚æ¯”å¦‚ä¸Cè¯­è¨€é‡Œé¢ <code>rand</code> ç­‰ä»·çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token import-statement"><span class="token keyword">import</span> System<span class="token punctuation">.</span>Random</span>

<span class="token hvariable">rand</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token constant">Int</span>
<span class="token hvariable">rand</span> <span class="token operator">=</span> <span class="token hvariable">getStdRandom</span> <span class="token punctuation">(</span><span class="token hvariable">randomR</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">maxBound</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ï¼ˆ <code>randomR</code> å‡½æ•°æ¥å—ä¸€ä¸ªå¸Œæœ›ç”Ÿæˆçš„éšæœºæ•°æ‰€åœ¨èŒƒå›´çš„é—­åŒºé—´ã€‚ï¼‰</p><p><code>System.Random</code> æ¨¡å—æä¾›äº†ä¸€ä¸ª <code>RandomGen</code> ç±»å‹ç±»ï¼Œå®ƒå…è®¸æˆ‘ä»¬è‡ªè¡Œå®šä¹‰ä¸€ä¸ªæ–°çš„éšæœºæ•´æ•°æºã€‚ <code>StdGen</code> ç±»å‹æ˜¯æ ‡å‡†çš„ <code>RandomGen</code> çš„å®ä¾‹ï¼Œå®ƒå¯ä»¥ç”Ÿæˆä¼ªéšæœºæ•°å€¼ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨çš„çœŸå®å¯é çš„éšæœºæ•°æºï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>RandomGen</code> çš„å®ä¾‹æ¥åˆ›å»ºçœŸå®çš„éšæœºæ•°ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¼ªéšæœºæ•°ã€‚</p><p><code>Random</code> è¿™ä¸ªç±»å‹ç±»å±•ç¤ºäº†å¦‚ä½•ç»™ç‰¹å®šçš„ç±»å‹ç”Ÿæˆéšæœºæ•°å€¼ã€‚è¿™ä¸ªæ¨¡å—ç»™æ‰€æœ‰å¸¸è§çš„ç®€å•ç±»å‹åˆ›å»ºäº† <code>Random</code> çš„å®ä¾‹ã€‚</p><p>é¡ºä¾¿è¯´ä¸‹ï¼Œå‰é¢å®šä¹‰çš„ <code>rand</code> å‡½æ•°ä¹Ÿä¼šè¯»å–å’Œä¿®æ”¹ <code>IO</code> monadä¸­å†…ç½®çš„å…¨å±€éšæœºæ•°ç”Ÿæˆå™¨ã€‚</p><h3 id="a-first-attempt-at-purity" tabindex="-1"><a class="header-anchor" href="#a-first-attempt-at-purity"><span>å®ç”¨çº¯å‡½æ•°ç”Ÿæˆéšæœºæ•°çš„å°è¯•</span></a></h3><p>æˆ‘ä»¬ä¸€ç›´å°½é‡é¿å…ä½¿ç”¨ <code>IO</code> monadï¼Œå¦‚æœä»…ä»…æ˜¯ä¸ºäº†ç”Ÿæˆéšæœºæ•°å°±è¦æ‰“ç ´è¿™ä¸€ç‚¹å°±æœ‰ç‚¹ä¸å¥½æ„æ€äº†ã€‚å®é™…ä¸Šï¼Œ <code>System.Random</code> æ¨¡å—é‡Œé¢æä¾›äº†ä¸€äº›çº¯å‡½æ•°æ¥ç”Ÿæˆéšæœºæ•°ã€‚</p><p>ä½¿ç”¨ä¼ ç»Ÿçº¯å‡½æ•°çš„ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬å¾—è·å–æˆ–è€…æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ï¼Œç„¶åæŠŠå®ƒä¼ é€’åˆ°éœ€è¦å¾—åœ°æ–¹ï¼Œæœ€ç»ˆè°ƒç”¨è¿™ä¸ªçº¯å‡½æ•°çš„æ—¶å€™å›ä¼ ä¸€ä¸ªæ–°çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼šè¦è®°ä½çš„æ˜¯ï¼Œæˆ‘ä»¬æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥ä¸èƒ½ä¿®æ”¹å·²ç»å­˜åœ¨çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸ç®¡ä¸å˜æ€§è€Œæ˜¯ç›´æ¥å¤ç”¨åŸæ¥çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œé‚£ä¹ˆæ¯æ¬¡æˆ‘ä»¬è°ƒç”¨è¿™ä¸ªå‡½æ•°éƒ½ä¼šå¾—åˆ°å®Œå…¨ä¸€æ ·çš„&quot;éšæœºæ•°&quot;ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">twoBadRandoms</span> <span class="token operator">::</span> <span class="token constant">RandomGen</span> <span class="token hvariable">g</span> <span class="token operator">=&gt;</span> <span class="token hvariable">g</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span>
<span class="token hvariable">twoBadRandoms</span> <span class="token hvariable">gen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">fst</span> <span class="token operator">$</span> <span class="token hvariable">random</span> <span class="token hvariable">gen</span><span class="token punctuation">,</span> <span class="token builtin">fst</span> <span class="token operator">$</span> <span class="token hvariable">random</span> <span class="token hvariable">gen</span><span class="token punctuation">)</span>

<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token hvariable">twoBadRandoms</span> <span class="token operator">`fmap`</span> <span class="token hvariable">getStdGen</span>
<span class="token constant">Loading</span> <span class="token hvariable">package</span> <span class="token hvariable">old</span><span class="token operator">-</span><span class="token hvariable">locale</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">.</span><span class="token number">0.0</span> <span class="token operator">...</span> <span class="token hvariable">linking</span> <span class="token operator">...</span> <span class="token hvariable">done</span><span class="token punctuation">.</span>
<span class="token constant">Loading</span> <span class="token hvariable">package</span> <span class="token hvariable">old</span><span class="token operator">-</span><span class="token hvariable">time</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">.</span><span class="token number">0.0</span> <span class="token operator">...</span> <span class="token hvariable">linking</span> <span class="token operator">...</span> <span class="token hvariable">done</span><span class="token punctuation">.</span>
<span class="token constant">Loading</span> <span class="token hvariable">package</span> <span class="token hvariable">random</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">.</span><span class="token number">0.0</span> <span class="token operator">...</span> <span class="token hvariable">linking</span> <span class="token operator">...</span> <span class="token hvariable">done</span><span class="token punctuation">.</span>
<span class="token constant">Loading</span> <span class="token hvariable">package</span> <span class="token hvariable">mtl</span><span class="token operator">-</span><span class="token number">1.1</span><span class="token punctuation">.</span><span class="token number">0.0</span> <span class="token operator">...</span> <span class="token hvariable">linking</span> <span class="token operator">...</span> <span class="token hvariable">done</span><span class="token punctuation">.</span>
<span class="token punctuation">(</span><span class="token number">945769311181683171</span><span class="token punctuation">,</span><span class="token number">945769311181683171</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ <code>random</code> å‡½æ•°æœ‰ä¸€ä¸ªé»˜è®¤çš„éšæœºæ•°ç”ŸæˆèŒƒå›´ï¼Œè€Œä¸æ˜¯åƒ <code>randomR</code> ä¸€æ ·æ¥å—ç”¨æˆ·ä¼ é€’çš„å‚æ•°èŒƒå›´ï¼› <code>getStdGen</code> å‡½æ•°ä» <code>IO</code> monadé‡Œé¢è·å–å…¨å±€çš„æ ‡å‡†æ•°æ®ç”Ÿæˆå™¨çš„å€¼ã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆä¹‹åæ–°çš„ç”Ÿæˆå™¨çš„å€¼æ­£ç¡®åœ°ä¼ é€’ç»™ç¬¬äºŒä¸ªéšæœºæ•°çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä»£ç å°±ä¸å¤ªå¯è¯»äº†ï¼Œä¸‹é¢æ˜¯ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">twoGoodRandoms</span> <span class="token operator">::</span> <span class="token constant">RandomGen</span> <span class="token hvariable">g</span> <span class="token operator">=&gt;</span> <span class="token hvariable">g</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">g</span><span class="token punctuation">)</span>
<span class="token hvariable">twoGoodRandoms</span> <span class="token hvariable">gen</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">gen&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">random</span> <span class="token hvariable">gen</span>
                         <span class="token punctuation">(</span><span class="token hvariable">b</span><span class="token punctuation">,</span> <span class="token hvariable">gen&#39;&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">random</span> <span class="token hvariable">gen&#39;</span>
                     <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">b</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token hvariable">gen&#39;&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å­¦åˆ°äº† <code>State</code> monad, å®ƒå¥½åƒæ˜¯ä¸ªæ¯”è¾ƒå¥½çš„è§£å†³åŠæ³•ã€‚ state monad å…è®¸æˆ‘ä»¬æ•´æ´åœ°ç®¡ç†å¯å˜çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¿è¯è¿™éƒ¨åˆ†ä»£ç ä¸ä»»ä½•è¯¸å¦‚ä¿®æ”¹æ–‡ä»¶ï¼Œè¿æ¥ç½‘ç»œç­‰å‰¯ä½œç”¨æ“ä½œåˆ†ç¦»å¼€æ¥ï¼›è¿™æ ·è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ å®¹æ˜“åœ°æ€è€ƒä»£ç çš„è¡Œä¸ºã€‚</p><h3 id="random-values-in-the-state-monad" tabindex="-1"><a class="header-anchor" href="#random-values-in-the-state-monad"><span>state monadé‡Œé¢çš„éšæœºæ•°å€¼</span></a></h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>StdGen</code> ä½œä¸ºçŠ¶æ€çš„state monadï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token keyword">type</span> <span class="token constant">RandomState</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token constant">StdGen</span> <span class="token hvariable">a</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç±»å‹åˆ«åä¸æ˜¯å¿…è¦çš„ï¼Œä½†æ˜¯å¾ˆæœ‰ç”¨ï¼›å…¶ä¸€å®ƒå¯ä»¥è®©æˆ‘ä»¬å°‘æ•²å‡ ä¸ªå­—ç¬¦ï¼Œå…¶äºŒï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨åˆ«çš„éšæœºæ•°ç”Ÿæˆå™¨è€Œä¸æ˜¯ <code>StdGen</code> ï¼Œæˆ‘ä»¬å¯ä»¥å°‘ä¿®æ”¹ä¸€äº›ç±»å‹ç­¾åã€‚</p><p>æœ‰äº† <code>RandomState</code> ï¼Œç”Ÿæˆéšæœºæ•°å€¼å°±æ˜¯è·å–å½“å‰çš„éšæœºæ•°ç”Ÿæˆå™¨ï¼Œä½¿ç”¨å®ƒç„¶åç”¨æ–°çš„éšæœºæ•°ç”Ÿæˆå™¨ä¿®æ”¹å½“å‰çŠ¶æ€å°±è¡Œäº†ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">getRandom</span> <span class="token operator">::</span> <span class="token constant">Random</span> <span class="token hvariable">a</span> <span class="token operator">=&gt;</span> <span class="token constant">RandomState</span> <span class="token hvariable">a</span>
<span class="token hvariable">getRandom</span> <span class="token operator">=</span>
  <span class="token hvariable">get</span> <span class="token operator">&gt;&gt;=</span> <span class="token operator">\</span><span class="token hvariable">gen</span> <span class="token operator">-&gt;</span>
  <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">val</span><span class="token punctuation">,</span> <span class="token hvariable">gen&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">random</span> <span class="token hvariable">gen</span> <span class="token keyword">in</span>
  <span class="token hvariable">put</span> <span class="token hvariable">gen&#39;</span> <span class="token operator">&gt;&gt;</span>
  <span class="token builtin">return</span> <span class="token hvariable">val</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨ä¹‹å‰å­¦åˆ°çš„çŸ¥è¯†å†™ä¸€äº›monadicçš„ä»£ç æ¥ç”Ÿæˆä¸€å¯¹éšæœºæ•°ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">getTwoRandoms</span> <span class="token operator">::</span> <span class="token constant">Random</span> <span class="token hvariable">a</span> <span class="token operator">=&gt;</span> <span class="token constant">RandomState</span> <span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span> <span class="token hvariable">a</span><span class="token punctuation">)</span>
<span class="token hvariable">getTwoRandoms</span> <span class="token operator">=</span> <span class="token hvariable">liftM2</span> <span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">)</span> <span class="token hvariable">getRandom</span> <span class="token hvariable">getRandom</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>^^^^ 1. ç”¨ <code>do</code> é‡å†™ <code>getRandom</code> å‡½æ•°</p><h3 id="running-the-state-monad" tabindex="-1"><a class="header-anchor" href="#running-the-state-monad"><span>è¿è¡Œstate monad</span></a></h3><p>ä¹‹å‰æåˆ°è¿‡ï¼Œæ¯ä¸ªmonadéƒ½æœ‰ä»–è‡ªå·±çš„æ±‚å€¼å‡½æ•°ï¼›åœ¨state monadé‡Œé¢ï¼Œæœ‰å‡ ä¸ªæ±‚å€¼å‡½æ•°å¯ä¾›é€‰æ‹©ã€‚</p><ol><li><code>runState</code> è¿”å›æ±‚å€¼ç»“æœå’Œæœ€ç»ˆçŠ¶æ€</li><li><code>evalState</code> åªè¿”å›ç»“æœ</li><li><code>execState</code> åªè¿”å›æœ€ç»ˆçŠ¶æ€</li></ol><blockquote><p><code>evalState</code> å’Œ <code>execState</code> å‡½æ•°å…¶å®å°±æ˜¯ <code>runState</code> å’Œ <code>fst</code> , <code>snd</code> å‡½æ•°çš„ç®€å•ç»„åˆã€‚æ‰€ä»¥ä¸‰ä¸ªé‡Œé¢æœ€é‡è¦çš„æ˜¯è¦è®°ä½ <code>runState</code> .</p></blockquote><p>ä¸‹é¢æ˜¯å®ç° <code>getTwoRandoms</code> ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">runTwoRandoms</span> <span class="token operator">::</span> <span class="token constant">IO</span> <span class="token punctuation">(</span><span class="token constant">Int</span><span class="token punctuation">,</span> <span class="token constant">Int</span><span class="token punctuation">)</span>
<span class="token hvariable">runTwoRandoms</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">oldState</span> <span class="token operator">&lt;-</span> <span class="token hvariable">getStdGen</span>
  <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">result</span><span class="token punctuation">,</span> <span class="token hvariable">newState</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">runState</span> <span class="token hvariable">getTwoRandoms</span> <span class="token hvariable">oldState</span>
  <span class="token hvariable">setStdGen</span> <span class="token hvariable">newState</span>
  <span class="token builtin">return</span> <span class="token hvariable">result</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç®¡ç†æ›´å¤šçš„çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#ç®¡ç†æ›´å¤šçš„çŠ¶æ€"><span>ç®¡ç†æ›´å¤šçš„çŠ¶æ€</span></a></h3><p>å¾ˆéš¾æƒ³è±¡é’ˆå¯¹å•ä¸ªçŠ¶æ€æˆ‘ä»¬ç«Ÿå†™äº†è¿™ä¹ˆå¤šæœ‰è¶£çš„ä»£ç ï¼Œå½“æˆ‘ä»¬æƒ³ä¸€æ¬¡æ€§çºªå½•å¤šä¸ªçŠ¶æ€çš„æ—¶å€™ï¼Œé€šå¸¸çš„åŠæ³•æ˜¯æŠŠè¿™äº›çŠ¶æ€æ”¾åœ¨ä¸€ä¸ªæ•°æ®ç»“æ„é‡Œé¢ç®¡ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªçºªå½•æˆ‘ä»¬ç”Ÿæˆéšæœºæ•°æ•°ç›®çš„ä¾‹å­ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token keyword">data</span> <span class="token constant">CountedRandom</span> <span class="token operator">=</span> <span class="token constant">CountedRandom</span> <span class="token punctuation">{</span>
      <span class="token hvariable">crGen</span> <span class="token operator">::</span> <span class="token constant">StdGen</span>
    <span class="token punctuation">,</span> <span class="token hvariable">crCount</span> <span class="token operator">::</span> <span class="token constant">Int</span>
    <span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token constant">CRState</span> <span class="token operator">=</span> <span class="token constant">State</span> <span class="token constant">CountedRandom</span>

<span class="token hvariable">getCountedRandom</span> <span class="token operator">::</span> <span class="token constant">Random</span> <span class="token hvariable">a</span> <span class="token operator">=&gt;</span> <span class="token constant">CRState</span> <span class="token hvariable">a</span>
<span class="token hvariable">getCountedRandom</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">st</span> <span class="token operator">&lt;-</span> <span class="token hvariable">get</span>
  <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token hvariable">val</span><span class="token punctuation">,</span> <span class="token hvariable">gen&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">random</span> <span class="token punctuation">(</span><span class="token hvariable">crGen</span> <span class="token hvariable">st</span><span class="token punctuation">)</span>
  <span class="token hvariable">put</span> <span class="token constant">CountedRandom</span> <span class="token punctuation">{</span> <span class="token hvariable">crGen</span> <span class="token operator">=</span> <span class="token hvariable">gen&#39;</span><span class="token punctuation">,</span> <span class="token hvariable">crCount</span> <span class="token operator">=</span> <span class="token hvariable">crCount</span> <span class="token hvariable">st</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
  <span class="token builtin">return</span> <span class="token hvariable">val</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„å‡½æ•°æ¯æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šå¤„ç†çŠ¶æ€çš„ä¸¤ä¸ªå…ƒç´ ç„¶åè¿”å›ä¸€ä¸ªå…¨æ–°çš„çŠ¶æ€ï¼›æ›´å¸¸è§çš„æƒ…å†µæ˜¯æˆ‘ä»¬åªéœ€è¦è¯»å†™æ•´ä¸ªçŠ¶æ€çš„æŸä¸€éƒ¨åˆ†ï¼›ä¸‹é¢çš„å‡½æ•°å¯ä»¥è·å–å½“å‰ç”Ÿæˆè¿‡çš„éšæœºæ•°çš„æ•°ç›®ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">getCount</span> <span class="token operator">::</span> <span class="token constant">CRState</span> <span class="token constant">Int</span>
<span class="token hvariable">getCount</span> <span class="token operator">=</span> <span class="token hvariable">crCount</span> <span class="token operator">`liftM`</span> <span class="token hvariable">get</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜äº†æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨çºªå½•è¯­æ³•å®šä¹‰ <code>CountedRandom</code> çŠ¶æ€ï¼›ä½¿ç”¨çºªå½•å‡½æ•°æä¾›çš„è®¿é—®å‡½æ•°ï¼ŒæŠŠå®ƒä¸ <code>get</code> å‡½æ•°ç»“åˆèµ·æ¥å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¯»å–çŠ¶æ€çš„ç‰¹å®šéƒ¨åˆ†ã€‚</p><p>å¦‚æœæƒ³è¦æ›´æ–°æ•´ä¸ªçŠ¶æ€çš„æŸä¸€éƒ¨åˆ†ï¼Œä¸‹é¢çš„ä»£ç å¯èƒ½ä¸æ˜¯å¾ˆå¸å¼•äººï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">putCount</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">CRState</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">putCount</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token keyword">do</span>
  <span class="token hvariable">st</span> <span class="token operator">&lt;-</span> <span class="token hvariable">get</span>
  <span class="token hvariable">put</span> <span class="token hvariable">st</span> <span class="token punctuation">{</span> <span class="token hvariable">crCount</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸€æ®µä»£ç æˆ‘ä»¬ä½¿ç”¨äº†çºªå½•æ›´æ–°è¯­æ³•è€Œä¸æ˜¯ç”¨ä¸€ä¸ªå‡½æ•°ã€‚è¡¨è¾¾å¼ <code>st { crCount = a }</code> ä¼šåˆ›å»ºä¸€ä¸ªå’Œ <code>st</code> å‡ ä¹å®Œå…¨ç›¸ç­‰çš„å€¼ï¼Œåªæ˜¯ä½¿ç”¨ç»™å®šçš„ <code>a</code> ä½œä¸º <code>crCount</code> å­—æ®µçš„å€¼ã€‚ç”±äºè¿™æ˜¯ä¸ªè¯­æ³•ä¸Šçš„å°æŠ€å·§ï¼Œå› æ­¤å®ƒæ²¡æœ‰ä½¿ç”¨å‡½æ•°é‚£ä¹ˆçµæ´»ã€‚çºªå½•è¯­æ³•å¯èƒ½å¹¶æ²¡æœ‰Haskellé€šå¸¸çš„è¯­æ³•é‚£ä¹ˆä¼˜é›…ï¼Œä½†æ˜¯è‡³å°‘å®ƒèƒ½å®Œæˆæˆ‘ä»¬çš„ç›®çš„ã€‚</p><p>å‡½æ•° <code>modify</code> ç»„åˆäº† <code>get</code> å’Œ <code>put</code> ï¼Œå®ƒæ¥å—ä¸€ä¸ªçŠ¶æ€è½¬æ¢å‡½æ•°ï¼Œä½†æ˜¯ä¾ç„¶ä¸å¤ªä»¤äººæ»¡æ„ï¼šè¿˜æ˜¯éœ€è¦ä½¿ç”¨çºªå½•è¯­æ³•ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/Random.hs</span>
<span class="token hvariable">putCountModify</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-&gt;</span> <span class="token constant">CRState</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token hvariable">putCountModify</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token hvariable">modify</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">st</span> <span class="token operator">-&gt;</span> <span class="token hvariable">st</span> <span class="token punctuation">{</span> <span class="token hvariable">crCount</span> <span class="token operator">=</span> <span class="token hvariable">a</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="monad-and-functors" tabindex="-1"><a class="header-anchor" href="#monad-and-functors"><span>Monadå’ŒFunctors</span></a></h2><p>Functorå’ŒMonadä¹‹é—´æœ‰éå¸¸ç´§å¯†çš„è”ç³»ï¼Œè¿™ä¸¤ä¸ªæœ¯è¯­æ˜¯ä»æ•°å­¦é‡Œé¢çš„èŒƒç•´è®ºå¼•å…¥çš„ï¼Œä½†æ˜¯åˆä¸æ•°å­¦å®šä¹‰ä¸å®Œå…¨ç›¸åŒã€‚</p><p>åœ¨èŒƒç•´è®ºé‡Œé¢ï¼Œmonadé€šè¿‡functoræ„å»ºå‡ºæ¥ã€‚ä½ å¯èƒ½å¸Œæœ›åœ¨Haskellé‡Œé¢ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¹Ÿå°±æ˜¯ <code>Monad</code> è¿™ä¸ªç±»å‹ç±»æ˜¯ <code>Functor</code> ç±»å‹ç±»çš„å­ç±»ï¼›ä½†æ˜¯åœ¨æ ‡å‡†åº“çš„Preludeé‡Œé¢å¹¶ä¸æ˜¯è¿™ä¹ˆå®šä¹‰çš„ã€‚è¿™æ˜¯ä¸ªå¾ˆä¸å¹¸çš„ç–å¿½ã€‚</p><p>ä½†æ˜¯ï¼ŒHaskellåº“çš„ä½œè€…ä»¬æä¾›äº†ä¸€ä¸ªå˜é€šæ–¹æ¡ˆï¼šä¸€æ—¦ä»–ä»¬å†™äº†ä¸€ä¸ª <code>Monad</code> çš„å®ä¾‹ï¼Œå‡ ä¹æ€»æ˜¯ä¹Ÿç»™ <code>Functor</code> å®šä¹‰ä¸€ä¸ªå®ä¾‹ã€‚æ‰€ä»¥å¯¹äºä»»ä½•monadä½ éƒ½å¯ä»¥ä½¿ç”¨ <code>Functor</code> ç±»å‹ç±»çš„ <code>fmap</code> å‡½æ•°ã€‚</p><p>å¦‚æœæŠŠ <code>fmap</code> å‡½æ•°çš„ç±»å‹ç­¾åä¸æˆ‘ä»¬å·²ç»è§åˆ°è¿‡æ ‡å‡†åº“é‡Œé¢Monadçš„ä¸€äº›å‡½æ•°åšæ¯”è¾ƒï¼Œå¤§è‡´å°±çŸ¥é“åœ¨monadé‡Œé¢ <code>fmap</code> å‡½æ•°æ˜¯å¹²ä»€ä¹ˆçš„äº†ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> :type fmap
fmap :: <span class="token punctuation">(</span>Functor f<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>a -<span class="token operator">&gt;</span> b<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> f a -<span class="token operator">&gt;</span> f b
ghci<span class="token operator">&gt;</span> :module +Control.Monad
ghci<span class="token operator">&gt;</span> :type liftM
liftM :: <span class="token punctuation">(</span>Monad m<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>a1 -<span class="token operator">&gt;</span> r<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> m a1 -<span class="token operator">&gt;</span> m r
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹å‡ºï¼Œ <code>fmap</code> å‡½æ•°ä½œç”¨å’Œ <code>liftM</code> ä¸€æ ·ï¼Œå®ƒæŠŠä¸€ä¸ªçº¯å‡½æ•°liftåˆ°monadé‡Œé¢ã€‚</p><h3 id="æ¢ä¸ªè§’åº¦çœ‹monad" tabindex="-1"><a class="header-anchor" href="#æ¢ä¸ªè§’åº¦çœ‹monad"><span>æ¢ä¸ªè§’åº¦çœ‹Monad</span></a></h3><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†monadå’Œfunctorä¹‹é—´çš„è”ç³»ï¼Œå¦‚æœå›å¤´å†çœ‹çœ‹Listè¿™ä¸ªmonadï¼Œä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼›å…·ä½“æ¥è¯´ï¼Œæ˜¯listçš„ <code>(&gt;&gt;=)</code> å®šä¹‰ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/ListMonad.hs</span>
<span class="token keyword">instance</span> <span class="token constant">Monad</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">where</span>
    <span class="token builtin">return</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">]</span>
    <span class="token hvariable">xs</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token builtin">concat</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>

<span class="token comment">-- ``f`` çš„ç±»å‹æ˜¯ ``a -&gt; [a]`` æˆ‘ä»¬è°ƒç”¨ ``map f xs`` çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹æ˜¯ ``[[a]]`` çš„å€¼ï¼Œç„¶åæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ ``concat`` æŠŠå®ƒâ€œæ‰å¹³åŒ–â€ï¼ˆflatten).</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æƒ³ä¸€æƒ³å¦‚æœ <code>Monad</code> æ˜¯ <code>Functor</code> çš„å­ç±»çš„æ—¶å€™æˆ‘ä»¬èƒ½åšä»€ä¹ˆï¼›ç”±äºlistçš„ <code>fmap</code> å®šä¹‰å°±æ˜¯ <code>map</code> , åœ¨ <code>(&gt;&gt;=)</code> å®šä¹‰é‡Œé¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>fmap</code> æ›¿æ¢ <code>map</code> .è¿™ä¸ªæ›¿æ¢æœ¬èº«å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šæ„ä¹‰ï¼Œæˆ‘ä»¬å†è¿›ä¸€æ­¥æ¢è®¨ä¸€ä¸‹ã€‚</p><blockquote><p><code>concat</code> å‡½æ•°çš„ç±»å‹æ˜¯ <code>[[a]] -&gt; [a]</code> :æ­£å¦‚æˆ‘ä»¬æåˆ°çš„ï¼Œå®ƒæŠŠä¸€ä¸ªåµŒå¥—çš„åˆ—è¡¨å‹å¹³ã€‚æˆ‘ä»¬å¯ä»¥æŠŠlistçš„è¿™å‡½æ•°çš„ç±»å‹ç­¾åä»listæ¨å¹¿åˆ°æ‰€æœ‰monadï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª&quot;ç§»é™¤ä¸€å±‚åµŒå¥—&quot;çš„ç±»å‹ <code>m (m a) -&gt; m a</code>; å…·æœ‰è¿™ç§ç±»å‹å‰é¢çš„å‡½æ•°é€šå¸¸å«åš <code>join</code> .</p></blockquote><p>å¦‚æœå·²ç»æœ‰äº† <code>join</code> å’Œ <code>fmap</code> çš„å®šä¹‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦ä¸ºæ¯ä¸€ä¸ªmonadå®šä¹‰ä¸€ä¸ª <code>(&gt;&gt;=)</code> å‡½æ•°äº†ï¼Œå› ä¸ºå®ƒå®Œå…¨å¯ä»¥ç”± <code>join</code> å’Œ <code>fmap</code> å®šä¹‰å‡ºæ¥ã€‚ä¸‹é¢æ˜¯ <code>Monad</code> ç±»å‹ç±»å¦å¤–ä¸€ç§å®šä¹‰æ–¹å¼ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/AltMonad.hs</span>
<span class="token import-statement"><span class="token keyword">import</span> Prelude <span class="token keyword">hiding</span></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&gt;&gt;=</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">return</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token constant">Functor</span> <span class="token hvariable">m</span> <span class="token operator">=&gt;</span> <span class="token constant">AltMonad</span> <span class="token hvariable">m</span> <span class="token keyword">where</span>
    <span class="token hvariable">join</span> <span class="token operator">::</span> <span class="token hvariable">m</span> <span class="token punctuation">(</span><span class="token hvariable">m</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span>
    <span class="token builtin">return</span> <span class="token operator">::</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span>

<span class="token punctuation">(</span><span class="token operator">&gt;&gt;=</span><span class="token punctuation">)</span> <span class="token operator">::</span> <span class="token constant">AltMonad</span> <span class="token hvariable">m</span> <span class="token operator">=&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">b</span>
<span class="token hvariable">xs</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token hvariable">join</span> <span class="token punctuation">(</span><span class="token builtin">fmap</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸èƒ½è¯´å“ªä¸€ç§å®šä¹‰æ¯”å¦å¤–ä¸€ç§æ›´å¥½ï¼Œå› ä¸ºæœ‰äº† <code>join</code> æˆ‘ä»¬å¯ä»¥å®šä¹‰ <code>(&gt;&gt;=)</code> ï¼Œåä¹‹äº¦ç„¶ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªä¸åŒçš„è§’åº¦ç»™äº†æˆ‘ä»¬å¯¹Monadå…¨æ–°çš„è®¤è¯†ã€‚</p><p>ç§»é™¤ä¸€å±‚monadicåŒ…è£…å®é™…ä¸Šæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œåœ¨ <code>Control.Monad</code> é‡Œé¢ç”±ä¸€ä¸ªæ ‡å‡†çš„ <code>join</code> å®šä¹‰ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadJoin.hs</span>
<span class="token hvariable">join</span> <span class="token operator">::</span> <span class="token constant">Monad</span> <span class="token hvariable">m</span> <span class="token operator">=&gt;</span> <span class="token hvariable">m</span> <span class="token punctuation">(</span><span class="token hvariable">m</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">m</span> <span class="token hvariable">a</span>
<span class="token hvariable">join</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">&gt;&gt;=</span> <span class="token builtin">id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨ <code>join</code> çš„ä¾‹å­ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>ghci<span class="token operator">&gt;</span> <span class="token function">join</span> <span class="token punctuation">(</span>Just <span class="token punctuation">(</span>Just <span class="token number">1</span><span class="token punctuation">))</span>
Just <span class="token number">1</span>
ghci<span class="token operator">&gt;</span> <span class="token function">join</span> Nothing
Nothing
ghci<span class="token operator">&gt;</span> <span class="token function">join</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">2,3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">1,2</span>,3<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="the-monad-laws-and-good-coding-style" tabindex="-1"><a class="header-anchor" href="#the-monad-laws-and-good-coding-style"><span>å•å­å¾‹ä»¥åŠä»£ç é£æ ¼</span></a></h2><p>åœ¨ <code class="interpreted-text" role="ref">thinking-more-about-functors</code> é‡Œé¢æˆ‘ä»¬ä»‹ç»äº†functorså¿…é¡»éµä»çš„ä¸¤æ¡è§„åˆ™ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token builtin">fmap</span> <span class="token builtin">id</span>        <span class="token operator">==</span>   <span class="token builtin">id</span> 
<span class="token builtin">fmap</span> <span class="token punctuation">(</span><span class="token hvariable">f</span> <span class="token operator">.</span> <span class="token hvariable">g</span><span class="token punctuation">)</span>   <span class="token operator">==</span>   <span class="token builtin">fmap</span> <span class="token hvariable">f</span> <span class="token operator">.</span> <span class="token builtin">fmap</span> <span class="token hvariable">g</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>monadsä¹Ÿæœ‰å®ƒä»¬å¿…é¡»éµä»çš„è§„åˆ™ã€‚ä¸‹é¢çš„ä¸‰æ¡è§„åˆ™è¢«ç§°ä¸ºå•å­å¾‹ã€‚Haskellå¹¶ä¸ä¼šå¼ºåˆ¶æ£€æŸ¥è¿™äº›è§„åˆ™ï¼šå®Œå…¨ç”±monadçš„ä½œè€…ä¿è¯ã€‚</p><p>å•å­å¾‹å°±æ˜¯ç®€å•è€Œæ­£å¼åœ°è¡¨è¾¾&quot;æŸä¸ªå•å­ä¸ä¼šè¡¨ç°å¾—è®©äººæƒŠè®¶&quot;çš„æ„æ€ã€‚åŸåˆ™ä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ä¸ç®¡è¿™äº›è§„åˆ™å®šä¹‰è‡ªå·±çš„monadï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™ä¹ˆå¹²ä¼šä¸ºäººæ‰€ä¸é½¿çš„ï¼›å› ä¸ºå•å­å¾‹æœ‰ä¸€äº›æˆ‘ä»¬å¯èƒ½å¿½è§†çš„å®è—ã€‚</p><div class="hint-container note"><p class="hint-container-title">Note</p><p>ä¸‹é¢çš„æ¯ä¸€æ¡è§„åˆ™ï¼Œ<code>==</code> å·¦è¾¹çš„è¡¨è¾¾å¼ç­‰ä»·äºå³è¾¹çš„è¡¨è¾¾å¼ã€‚</p></div><p>ç¬¬ä¸€æ¡è§„åˆ™è¯´çš„æ˜¯ <code>return</code> æ˜¯ <code>(&gt;&gt;=)</code> çš„ <em>Left identity</em>.</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token builtin">return</span> <span class="token hvariable">x</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span>            <span class="token operator">===</span>   <span class="token hvariable">f</span> <span class="token hvariable">x</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦å¤–ä¸€ç§ç†è§£è¿™æ¡è§„åˆ™çš„æ–¹å¼æ˜¯ï¼šå¦‚æœæˆ‘ä»¬ä»…ä»…æ˜¯æŠŠä¸€ä¸ªçº¯å€¼åŒ…è£…åˆ°monadé‡Œé¢ç„¶åä½¿ç”¨ <code>(&gt;&gt;=)</code> è°ƒç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦ä½¿ç”¨ <code>return</code> äº†ï¼›ä½¿ç”¨monadçš„æ–°æ‰‹é€šå¸¸æ‰€çŠ¯çš„é”™è¯¯å°±æ˜¯ä½¿ç”¨ <code>return</code> æŠŠä¸€ä¸ªçº¯å€¼åŒ…è£…ä¸ºmonadicçš„ï¼Œç„¶åæ¥ä¸‹æ¥ç”±ä½¿ç”¨ <code>(&gt;&gt;=)</code> æŠŠè¿™ä¸ªå€¼å–å‡ºæ¥ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨doè¡¨ç¤ºæ³•è¡¨è¾¾è¿™ä¸ªè§„å¾‹çš„ç­‰ä»·å½¢å¼ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token keyword">do</span> <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token builtin">return</span> <span class="token hvariable">x</span>
   <span class="token hvariable">f</span> <span class="token hvariable">y</span>                    <span class="token operator">===</span>   <span class="token hvariable">f</span> <span class="token hvariable">x</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡è§„åˆ™å¯¹äºæˆ‘ä»¬çš„ä»£ç é£æ ¼æœ‰ç€å®é™…ä¸Šçš„æŒ‡å¯¼æ„ä¹‰ï¼šæˆ‘ä»¬ä¸æƒ³å†™ä¸€äº›ä¸å¿…è¦çš„ä»£ç ï¼›è¿™æ¡è§„åˆ™ä¿è¯äº†ç®€çŸ­çš„å†™æ³•å’Œå†—ä½™çš„å†™æ³•æ˜¯ç­‰ä»·çš„ã€‚</p><p>å•å­å¾‹çš„ç¬¬äºŒæ¡è¯´çš„æ˜¯ <code>return</code> æ˜¯ <code>(&gt;&gt;=)</code> çš„ <em>Right identity</em>.</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token builtin">return</span>              <span class="token operator">===</span>   <span class="token hvariable">m</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä½ ä»¥å‰ä½¿ç”¨å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸€æ¡è§„åˆ™å¯¹é£æ ¼ä¹Ÿæœ‰å¥½å¤„ï¼šå¦‚æœåœ¨ä¸€ç³»åˆ—çš„actionå—é‡Œé¢ï¼Œå¦‚æœæœ€åä¸€å¥å°±æ˜¯éœ€è¦è¿”å›çš„æ­£ç¡®ç»“æœï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä½¿ç”¨ <code>return</code> äº†ï¼›çœ‹çœ‹ä½¿ç”¨ <code>do</code> è¡¨ç¤ºæ³•å¦‚ä½•è¡¨è¾¾è¿™æ¡è§„åˆ™ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token keyword">do</span> <span class="token hvariable">y</span> <span class="token operator">&lt;-</span> <span class="token hvariable">m</span>
   <span class="token builtin">return</span> <span class="token hvariable">y</span>               <span class="token operator">===</span>   <span class="token hvariable">m</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å’Œç¬¬ä¸€æ¡è§„åˆ™ä¸€æ ·ï¼Œè¿™æ¡è§„å¾‹ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç ã€‚</p><p>å•å­å¾‹æœ€åä¸€æ¡å’Œç»“åˆæ€§æœ‰å…³ã€‚</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">g</span><span class="token punctuation">)</span>   <span class="token operator">===</span>   <span class="token punctuation">(</span><span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">g</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡è§„åˆ™æœ‰ç‚¹éš¾ç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ç­‰å¼ä¸¤è¾¹æ‹¬å·é‡Œé¢çš„å†…å®¹ï¼›ç­‰å¼å·¦è¾¹å¯ä»¥é‡æ–°è¡¨ç¤ºæˆè¿™æ ·ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">s</span>
  <span class="token keyword">where</span> <span class="token hvariable">s</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">g</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç­‰å¼å³è¾¹ä¹Ÿåšç±»ä¼¼çš„å¤„ç†ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token hvariable">t</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">g</span>
  <span class="token keyword">where</span> <span class="token hvariable">t</span> <span class="token operator">=</span> <span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">f</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æŠŠä¸Šè¿°è§„å¾‹è¡¨è¾¾æˆå¦‚ä¸‹ç­‰ä»·å½¢å¼ï¼š</p><div class="language-haskell line-numbers-mode" data-ext="haskell" data-title="haskell"><pre class="language-haskell"><code><span class="token comment">-- file: ch14/MonadLaws.hs</span>
<span class="token hvariable">m</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">s</span>                   <span class="token operator">===</span>   <span class="token hvariable">t</span> <span class="token operator">&gt;&gt;=</span> <span class="token hvariable">g</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡è§„åˆ™çš„æ„æ€æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠä¸€ä¸ªå¤§çš„actionåˆ†è§£æˆä¸€ç³»åˆ—çš„å­actionï¼Œåªè¦æˆ‘ä»¬ä¿è¯å­actionçš„é¡ºåºï¼ŒæŠŠå“ªäº›å­actionæå–å‡ºæ¥ç»„åˆæˆä¸€ä¸ªæ–°actionå¯¹æ±‚å€¼ç»“æœæ˜¯æ²¡æœ‰å½±å“çš„ã€‚å¦‚æœæˆ‘ä»¬ç”±ä¸‰ä¸ªactionä¸²è”åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå‰ä¸¤ä¸ªactionæ›¿æ¢ä¸ºå®ƒä»¬çš„ç»„åˆç„¶åä¸²è”ç¬¬ä¸‰ä¸ªï¼Œä¹Ÿå¯ä»¥ç”¨ç¬¬ä¸€ä¸ªactionä¸²è”åé¢ä¸¤ä¸ªcationçš„ç»„åˆã€‚</p><p>è¿™æ¡è¾ƒä¸ºå¤æ‚çš„è§„å¾‹å¯¹æˆ‘ä»¬çš„ä»£ç é£æ ¼ä¹Ÿæœ‰ä¸€äº›æ„ä¹‰ã€‚åœ¨è½¯ä»¶é‡æ„é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªä¸“ä¸šæœ¯è¯­å«åš&quot;æå–æ–¹æ³•&quot;ï¼Œå®ƒè¯´çš„å°±æ˜¯åœ¨ä¸€å¤§æ®µä»£ç é‡Œé¢æå–å‡ºä¸€äº›ä»£ç ç‰‡æ®µç„¶åç»„åˆæˆä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨åŸå§‹ä»£ç é‡Œé¢è°ƒç”¨æ–°çš„å‡½æ•°æ¥å–ä»£æå–å‡ºæ¥çš„å†…å®¹ï¼›ç¬¬ä¸‰æ¡å•å­å¾‹ä¿è¯äº†è¿™ç§åšæ³•åœ¨Haskellçš„monadicä»£ç é‡Œé¢ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚</p><p>ä¸‰æ¡å•å­å¾‹éƒ½èƒ½å¸®åŠ©æˆ‘ä»¬å†™å‡ºæ›´å¥½çš„monadicä»£ç ï¼›å‰ä¸¤æ¡è§„åˆ™æŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•é¿å…ä½¿ç”¨ä¸å¿…è¦çš„ <code>return</code> ï¼Œç¬¬ä¸‰æ¡è§„åˆ™è®©æˆ‘ä»¬èƒ½å®‰å…¨åœ°æŠŠä¸€ä¸ªå¤æ‚çš„actionå†²æ„æˆä¸€ç³»åˆ—å°çš„actionã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ç®¡è¿™äº›ç»†èŠ‚ï¼Œé€šè¿‡ç›´è§‰æˆ‘ä»¬çŸ¥é“åœ¨ä¸€ä¸ªå®ç°è‰¯å¥½çš„monadé‡Œé¢ï¼Œè¿™äº›è§„åˆ™æ˜¯ä¸ä¼šè¢«è¿èƒŒçš„ã€‚</p><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒHaskellç¼–è¯‘å™¨å¹¶ä¸å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªmonadæ˜¯å¦éµå®ˆå•å­å¾‹ã€‚monadçš„å®ç°è€…å¿…é¡»ç¡®ä¿è‡ªå·±çš„ä»£ç æ»¡è¶³ï¼ˆæœ€å¥½æ˜¯è¯æ˜ï¼‰å•å­å¾‹ã€‚</p></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/å­¦ä¹ /Haskellä¸­æ–‡æ–‡æ¡£/14.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: 61403802+hahg2000@users.noreply.github.com">hahg2000</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/13.html" aria-label="ç¬¬ 13 ç« ï¼šæ•°æ®ç»“æ„"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->ç¬¬ 13 ç« ï¼šæ•°æ®ç»“æ„</div></a><a class="route-link nav-link next" href="/%E5%AD%A6%E4%B9%A0/Haskell%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/16.html" aria-label="ç¬¬ 16 ç« ï¼šä½¿ç”¨Parsec"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">ç¬¬ 16 ç« ï¼šä½¿ç”¨Parsec<!----></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2024 hahg </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Chw2KLnS.js" defer></script>
  </body>
</html>
